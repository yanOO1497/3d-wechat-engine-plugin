System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js"],(function(e,t){"use strict";var i,r,n,s,o,a,u,c,h,l,p,f,_,d,g,v,m,y,b,w,A,T,E,S,C,D,O,I,R,P,k,F,x,N,M,L,B,z,j,H,U,V,W,G,Y,q,X,Z,$,J,K,Q,ee,te,ie,re,ne,se,oe,ae,ue,ce,he,le,pe,fe,_e,de,ge,ve,me,ye,be,we,Ae,Te,Ee,Se,Ce,De,Oe,Ie,Re,Pe,ke,Fe,xe,Ne,Me,Le,Be,ze,je,He,Ue,Ve,We,Ge,Ye,qe,Xe,Ze,$e,Je,Ke,Qe,et,tt,it,rt,nt,st,ot,at,ut,ct,ht,lt,pt,ft,_t,dt,gt,vt,mt,yt,bt,wt,At,Tt,Et,St,Ct,Dt,Ot,It,Rt,Pt,kt,Ft,xt,Nt,Mt,Lt,Bt,zt,jt,Ht,Ut,Vt,Wt,Gt,Yt,qt,Xt,Zt,$t,Jt,Kt,Qt,ei,ti,ii,ri,ni,si,oi,ai,ui,ci,hi,li,pi,fi,_i,di,gi,vi,mi,yi,bi,wi,Ai,Ti,Ei,Si,Ci,Di,Oi,Ii,Ri,Pi,ki,Fi,xi,Ni,Mi,Li,Bi,zi,ji,Hi,Ui;return{setters:[function(e){i=e.c,r=e._,n=e.y,s=e.b,o=e.l,a=e.bn,u=e.bo,c=e.e,h=e.f,l=e.C,p=e.T,f=e.s,_=e.b2,d=e.aX,g=e.bp,v=e.aE,m=e.bq,y=e.br,b=e.bs,w=e.bt,A=e.bu,T=e.n,E=e.W,S=e.V,C=e.Z,D=e.a0,O=e.aa,I=e.a6,R=e.a8,P=e.a3,k=e.z,F=e.bv,x=e.a,N=e.o,M=e.A,L=e.Q,B=e.aF,z=e.bw,j=e.b8,H=e.bx,U=e.E,V=e.by,W=e.bz,G=e.G,Y=e.t,q=e.w,X=e.aK,Z=e.aB,$=e.aC,J=e.B,K=e.x,Q=e.aY,ee=e.b5,te=e.ah,ie=e.h,re=e.m,ne=e.b6,se=e.d,oe=e.aI,ae=e.bA,ue=e.aJ,ce=e.aH,he=e.bh,le=e.r,pe=e.bB,fe=e.b3,_e=e.bC,de=e.bD,ge=e.aG,ve=e.S,me=e.be,ye=e.j,be=e.i,we=e.R,Ae=e.P,Te=e.p,Ee=e.X,Se=e.a7,Ce=e.q,De=e.aM,Oe=e.bE,Ie=e.bF,Re=e.bG,Pe=e.bH,ke=e.bI,Fe=e.bJ,xe=e.bK,Ne=e.bb,Me=e.bL,Le=e.bM,Be=e.bN,ze=e.k,je=e.I,He=e.bO,Ue=e.bP,Ve=e.bQ,We=e.bR,Ge=e.bS,Ye=e.bT,qe=e.bU,Xe=e.bV,Ze=e.bW,$e=e.bX,Je=e.bY,Ke=e.K,Qe=e.aU,et=e.bZ,tt=e.J},function(e){it=e.bN,rt=e.bC,nt=e.bp,st=e.d_,ot=e.bM,at=e.J,ut=e.h,ct=e.q,ht=e.C,lt=e.r,pt=e.v,ft=e.t,_t=e.w,dt=e.cG,gt=e.dR,vt=e.d$,mt=e.e0,yt=e.bQ,bt=e.e1,wt=e.bI,At=e.e2,Tt=e.N,Et=e.O,St=e.o,Ct=e.dP,Dt=e.dQ,Ot=e.b_,It=e.e3,Rt=e.e4,Pt=e.e5,kt=e.e6,Ft=e.e7,xt=e.c0,Nt=e.cl,Mt=e.cm,Lt=e.co,Bt=e.bK,zt=e.e8,jt=e.dU,Ht=e.dW,Ut=e.A,Vt=e.a,Wt=e.F,Gt=e.cN,Yt=e.B,qt=e.b,Xt=e.M,Zt=e.I,$t=e.as,Jt=e.ap,Kt=e.aI,Qt=e.aH,ei=e.av,ti=e.e9,ii=e.K,ri=e.aG,ni=e.aF,si=e.ea,oi=e.ar,ai=e.H,ui=e.X,ci=e.aE,hi=e.aD,li=e.eb,pi=e.bJ,fi=e.ad,_i=e.c3,di=e.aU,gi=e.dx,vi=e.cs,mi=e.ct,yi=e.aT,bi=e.au,wi=e.c$,Ai=e.R,Ti=e.x,Ei=e.aS,Si=e.dj,Ci=e.dk,Di=e.cA,Oi=e.dm,Ii=e.dF,Ri=e.aR,Pi=e.L,ki=e.dE,Fi=e.bR,xi=e.b$,Ni=e.bw,Mi=e.bG,Li=e.bH,Bi=e.ec},function(e){zi=e.d,ji=e.a,Hi=e.b,Ui=e.A}],execute:function(){var Vi,Wi,Gi,Yi,qi;e({G:ih,H:th,I:void 0,K:void 0,Q:dl,d:pr,p:gl,s:void 0,z:void 0});var Xi=e("M",i("cc.MissingScript")(Vi=a()((qi=function(e){function t(){var t;return t=e.call(this)||this,c(t,"compiled",Gi,h(t)),c(t,"_$erialized",Yi,h(t)),t}return r(t,e),t.safeFindClass=function(e){var t=u(e);if(t)return t;o.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){n(4600,this.node.name)},t}(l),Gi=s((Wi=qi).prototype,"compiled",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yi=s(Wi.prototype,"_$erialized",[f,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vi=Wi))||Vi)||Vi);function Zi(e){var t,i,r,n=e.deserializedList,s=e._idPropList,o=e._idList,a=e._idObjList;for(e._classFinder&&e._classFinder.onDereferenced,t=0;t<o.length;t++)i=s[t],r=o[t],a[t][i]=n[r]}o._MissingScript=Xi;var $i=function(){function e(e,t,i){this.result=void 0,this.customEnv=void 0,this.deserializedList=void 0,this.deserializedData=void 0,this._classFinder=void 0,this._ignoreEditorOnly=void 0,this._idList=void 0,this._idObjList=void 0,this._idPropList=void 0,this.result=e,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=t,this._idList=[],this._idObjList=[],this._idPropList=[]}var t=e.prototype;return t.deserialize=function(e){if(Array.isArray(e)){var t=e,i=t.length;this.deserializedList.length=i;for(var r=0;r<i;r++)t[r]&&(this.deserializedList[r]=this._deserializeObject(t[r]));this.deserializedData=i>0?this.deserializedList[0]:[],Zi(this)}else{var n;this.deserializedList.length=1,n=e?this._deserializeObject(e):null,Zi(this),this.deserializedList[0]=n,this.deserializedData=n}return this.deserializedData},t._deserializeObject=function(e,t,i){var r,n=null,s=null,a=e.__type__;if("TypedArray"===a){var c=e.array;n=new window[e.ctor](c.length);for(var h=0;h<c.length;++h)n[h]=c[h];return n}if(a){if(!(s=this._classFinder(a,e,t,i)))return this._classFinder===u&&o.deserialize.reportMissingClass(a),null;(n=new s)._deserialize?n._deserialize(e.content,this):o.Class._isCCClass(s)?function(e,t,i,r){var n;r.hasOwnProperty("__deserialize__")?n=r.__deserialize__:(n=function(e,t){var i,r=b.test(w(t)),n=o.js.isChildClassOf(t,o._BaseNode)||o.js.isChildClassOf(t,o.Component),s=[],a=s,u=[],c=u,h=[];return function(){var e=t.__values__;i="_$erialized"===e[e.length-1];for(var n=g(t),l=m+"type",p=m+"default",f=m+"formerlySerializedAs",_=0;_<e.length;_++){var d=e[_],y=d;n[d+f]&&(y=n[d+f]);var b=v.getDefault(n[d+p]),w=!1;if(r){var T=n[d+l];if(void 0===b&&T)w=T instanceof A;else{var E=typeof b;w="string"===E||"number"===E||"boolean"===E}}r&&w?(y!==d&&a===s&&(a=s.slice()),s.push(d),a!==s&&a.push(y)):(y!==d&&c===u&&(c=u.slice()),u.push(d),c!==u&&c.push(y),h.push(b instanceof o.ValueType&&b.constructor))}}(),function(e,t,o){for(var l=0;l<s.length;++l){var p=o[a[l]];void 0!==p&&(t[s[l]]=p)}for(var f=0;f<u.length;++f){var _=u[f],d=o[c[f]];if(void 0!==d)if(r||"object"==typeof d){var g=h[f];g?r||d?e._deserializeTypedObject(t[_],d,g):t[_]=null:d?e._deserializeObjField(t,d,_):t[_]=null}else t[_]=d}n&&o._id&&(t._id=o._id),i&&(t._$erialized=JSON.parse(JSON.stringify(o)),e._deserializePrimitiveObject(t._$erialized,o))}}(0,r),y(r,"__deserialize__",n,!0)),n(e,t,i,r)}(this,n,e,s):this._deserializeTypedObject(n,e,s)}else if(Array.isArray(e)){n=new Array(e.length);for(var l=0;l<e.length;l++)"object"==typeof(r=e[l])&&r?this._deserializeObjField(n,r,""+l):n[l]=r}else n={},this._deserializePrimitiveObject(n,e);return n},t._deserializeObjField=function(e,t,i){var r=t.__id__;if(void 0===r){var n=t.__uuid__;n?this.result.push(e,i,n):e[i]=this._deserializeObject(t)}else{var s=this.deserializedList[r];s?e[i]=s:(this._idList.push(r),this._idObjList.push(e),this._idPropList.push(i))}},t._deserializePrimitiveObject=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];"object"!=typeof r?"__type__"!==i&&(e[i]=r):r?this._deserializeObjField(e,r,i):e[i]=null}},t._deserializeTypedObject=function(e,t,i){if(i===o.Vec2)return e.x=t.x||0,void(e.y=t.y||0);if(i===o.Vec3)return e.x=t.x||0,e.y=t.y||0,void(e.z=t.z||0);if(i!==o.Color){if(i===o.Size)return e.width=t.width||0,void(e.height=t.height||0);for(var r=m+"default",n=g(i),s=i.__props__||Object.keys(e),a=0;a<s.length;a++){var u=s[a],c=t[u];void 0!==c&&t.hasOwnProperty(u)||(c=v.getDefault(n[u+r])),"object"!=typeof c?e[u]=c:c?this._deserializeObjField(e,c,u):e[u]=null}}else{e.r=t.r||0,e.g=t.g||0,e.b=t.b||0;var h=t.a;e.a=void 0===h?255:h}},e}();$i.pool=void 0,$i.pool=new d((function(e){e.result=null,e.customEnv=null,e.deserializedList.length=0,e.deserializedData=null,e._classFinder=null,e._idList.length=0,e._idObjList.length=0,e._idPropList.length=0}),1),$i.pool.get=function(e,t,i,r){var n=this._get();return n?(n.result=e,n.customEnv=i,n._classFinder=t,n):new $i(e,t,i,r)};var Ji=[E,S,C,D,O,I,R,P];function Ki(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var Qi=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},Ki,Ki,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){P.fromArray(e,t,1)}],er=e("D",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var t=e.prototype;return t.init=function(e){this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]},t.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},t.push=function(e,t,i){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(i)},e}());function tr(e,t){for(var i=e[4][t[0]],r=i[0],n=new(0,r[0]),s=r[1],o=r[2],a=i[i.length-1],u=1;u<a;++u)n[s[i[u]]]=t[u];for(;u<t.length;++u){var c=s[i[u]],h=r[i[u]+o];(0,ar[h])(e,n,c,t[u])}return n}function ir(e,t,i){var r=new t;return r._deserialize?r._deserialize(i,e[0]):k(5303,F(t)),r}function rr(e,t,i,r){r>=0?t[i]=e[5][r]:e[7][3*~r]=t}function nr(e){return function(t,i,r,n){i[r]=n;for(var s=0;s<n.length;++s)e(t,n,s,n[s])}}function sr(e,t,i,r){t[i]=null,e[8][r]=t}function or(e,t,i,r){t[i]=tr(e,r)}er.pool=new d((function(e){e.reset()}),5),er.pool.get=function(){return this._get()||new er};var ar=new Array(13);function ur(e,t){return e||pr.reportMissingClass(t),Object}function cr(e,t,i,r,n,s){var o,a,u,c=e(t);if(!c){if(n)return void(i[r]=(o=i,a=r,u=t,function(){var t=e(u)||ur(s,u);return o[a]=t,new t}));c=ur(s,t)}i[r]=c}function hr(e,t,i){for(var r=i||u,n=e[3],s=0;s<n.length;++s){var o=n[s];"string"!=typeof o?cr(r,o[0],o,0,t,i):cr(r,o,n,s,t,i)}}function lr(e){var t=e[4];if(t)for(var i=e[3],r=0;r<t.length;++r){var n=t[r];n[0]=i[n[0]]}}function pr(e,t,i){"string"==typeof e&&(e=JSON.parse(e));var r,n=!t;(t=t||er.pool.get()).init(e),i=i||{};var s=e[0],a=!1;if("object"==typeof s&&(a=s.preprocessed,s=s.version),s<1)throw new Error(T(5304,s));i._version=s,i.result=t,e[0]=i,a||(hr(e,!1,i.classFinder),lr(e)),o.game._isCloning=!0;var u=e[5],c=function(e){var t=e[5],i=e[6],r=0===i?0:i.length,n=t[t.length-1],s=t.length-r;"number"!=typeof n?n=0:(n<0&&(n=~n),--s);for(var o=0;o<s;++o)t[o]=tr(e,t[o]);for(var a=e[3],u=0;u<r;++u,++o){var c=i[u],h=t[o];if(c>=0){var l=a[c];t[o]=ir(e,l,h)}else(0,ar[c=~c])(e,t,o,h)}return n}(e);return o.game._isCloning=!1,e[7]&&function(e,t,i){for(var r=e.length-1,n=0,s=3*e[r];n<s;n+=3){var o=e[n],a=t[e[n+2]],u=e[n+1];u>=0?o[i[u]]=a:o[~u]=a}for(;n<r;n+=3){var c=t[e[n]],h=t[e[n+2]],l=e[n+1];l>=0?c[i[l]]=h:c[~l]=h}}(e[7],u,e[2]),function(e){for(var t=e[5],i=e[2],r=e[1],n=e[8],s=e[9],o=e[10],a=0;a<n.length;++a){var u=n[a];"number"==typeof u&&(n[a]=t[u]);var c=s[a];"number"==typeof c&&(c=c>=0?i[c]:~c,s[a]=c);var h=o[a];"number"==typeof h&&(o[a]=r[h])}}(e),r=u[c],n&&er.pool.put(t),r}ar[0]=function(e,t,i,r){t[i]=r},ar[1]=rr,ar[2]=nr(rr),ar[3]=nr(sr),ar[4]=or,ar[5]=function(e,t,i,r){Qi[r[0]](t[i],r)},ar[6]=sr,ar[7]=function(e,t,i,r){t[i].set(r)},ar[8]=function(e,t,i,r){var n=new Ji[r[0]];Qi[r[0]](n,r),t[i]=n},ar[9]=nr(or),ar[10]=function(e,t,i,r){var n=e[3][r[0]];t[i]=ir(e,n,r[1])},ar[11]=function(e,t,i,r){var n=r[0];t[i]=n;for(var s=1;s<r.length;s+=3){var o=r[s],a=r[s+1],u=r[s+2];(0,ar[a])(e,n,o,u)}},ar[12]=function(e,t,i,r){var n=r[0];t[i]=n;for(var s=0;s<n.length;++s){var o=n[s],a=r[s+1];0!==a&&(0,ar[a])(e,n,s,o)}},pr.Details=er,pr.reportMissingClass=function(e){n(5302,e)};var fr,_r,dr,gr=function(e){this.preprocessed=!0,this.version=e};function vr(e,t,i){return[1,0,0,[e],0,i?[t,-1]:[t],[0],0,[],[],[]]}o.deserialize=pr;var mr=e("B",i("cc.BufferAsset")((dr=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this)._buffer=null,t}return r(t,e),t.prototype.buffer=function(){return this._buffer},x(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(M),s((_r=dr).prototype,"_nativeAsset",[N],Object.getOwnPropertyDescriptor(_r.prototype,"_nativeAsset"),_r.prototype),fr=_r))||fr);o.BufferAsset=mr;var yr=B.Flags.Destroyed,br=B.Flags.PersistentMask,wr=m+"default",Ar=v.IDENTIFIER_RE,Tr={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},Er=v.escapeForJS,Sr=function(){function e(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}return e.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},e}();function Cr(e,t){return t instanceof Sr?new Sr(t.varName,e+t.expression):e+t}function Dr(e,t,i){Array.isArray(i)?(i[0]=Cr(t,i[0]),e.push(i)):e.push(Cr(t,i)+";")}var Or=function(){function e(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}var t=e.prototype;return t.append=function(e,t){this._exps.push([e,t])},t.writeCode=function(e){var t;if(this._exps.length>1)e.push("t="+this._targetExp+";"),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(var i=0;i<this._exps.length;i++){var r=this._exps[i];Dr(e,t+Ir(r[0])+"=",r[1])}},e}();function Ir(e){return Ar.test(e)?"."+e:"["+Er(e)+"]"}Or.pool=void 0,Or.pool=new d((function(e){e._exps.length=0,e._targetExp=null}),1),Or.pool.get=function(e){var t=this._get()||new Or;return t._targetExp=e,t};var Rr,Pr,kr,Fr,xr,Nr,Mr,Lr=function(){function e(e,t){var i;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=z(),j(this.funcModuleCache,Tr),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(e.constructor,!0)+"();","}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(i="var "+this.globalVariables.join(",")+";");var r=function(e){var t=[];return function e(t,i){for(var r,n=L(i);!(r=n()).done;){var s=r.value;Array.isArray(s)?e(t,s):t.push(s)}}(t,e),t.join("")}(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",r)(this.objs,this.funcs);for(var n=0,s=this.objsToClear_iN$t.length;n<s;++n)this.objsToClear_iN$t[n]._iN$t=null;this.objsToClear_iN$t.length=0}var t=e.prototype;return t.getFuncModule=function(e,t){var i=F(e);if(i){var r=this.funcModuleCache[i];if(r)return r;if(void 0===r){var n=-1!==i.indexOf(".");if(n)try{if(n=e===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(e){}}}var s=this.funcs.indexOf(e);s<0&&(s=this.funcs.length,this.funcs.push(e));var o="F["+s+"]";return t&&(o="("+o+")"),this.funcModuleCache[i]=o,o},t.getObjRef=function(e){var t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),"O["+t+"]"},t.setValueType=function(e,t,i,r){var n=Or.pool.get(r),s=t.constructor.__props__;s||(s=Object.keys(t));for(var o=0;o<s.length;o++){var a=s[o],u=i[a];if(t[a]!==u){var c=this.enumerateField(i,a,u);n.append(a,c)}}n.writeCode(e),Or.pool.put(n)},t.enumerateCCClass=function(e,t,i){for(var r=i.__values__,n=g(i),s=0;s<r.length;s++){var a=r[s],u=t[a],c=n[a+wr];if(!Br(c,u))if("object"==typeof u&&u instanceof o.ValueType&&(c=v.getDefault(c))&&c.constructor===u.constructor){var h="o"+Ir(a);this.setValueType(e,c,u,h)}else this.setObjProp(e,t,a,u)}},t.instantiateArray=function(e){if(0===e.length)return"[]";var t="a"+ ++this.localVariableId,i=[new Sr(t,"new Array("+e.length+")")];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(var r=0;r<e.length;++r)Dr(i,t+"["+r+"]=",this.enumerateField(e,r,e[r]));return i},t.instantiateTypedArray=function(e){var t=e.constructor.name;if(0===e.length)return"new "+t;var i="a"+ ++this.localVariableId,r=[new Sr(i,"new "+t+"("+e.length+")")];e._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(e);for(var n=0;n<e.length;++n)0!==e[n]&&Dr(r,i+"["+n+"]=",e[n]);return r},t.enumerateField=function(e,t,i){if("object"==typeof i&&i){var r=i._iN$t;if(r){var n=r.globalVar;if(!n){n=r.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(n);var s=r.source[0];r.source[0]=Cr(n+"=",s)}return n}return ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?Er(i):("_objFlags"===t&&e instanceof B&&(i&=br),i)},t.setObjProp=function(e,t,i,r){Dr(e,"o"+Ir(i)+"=",this.enumerateField(t,i,r))},t.enumerateObject=function(e,t){var i=t.constructor;if(o.Class._isCCClass(i))this.enumerateCCClass(e,t,i);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var n=t[r];"object"==typeof n&&n&&n===t._iN$t||this.setObjProp(e,t,r,n)}},t.instantiateObj=function(e){if(e instanceof o.ValueType)return v.getNewValueTypeCode(e);if(e instanceof o.Asset)return this.getObjRef(e);if(e._objFlags&yr)return null;var t,i=e.constructor;if(o.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof o.Component){if(e instanceof o._BaseNode||e instanceof o.Component)return this.getObjRef(e)}else if(this.parent instanceof o._BaseNode)if(e instanceof o._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof o.Component&&!e.node.isChildOf(this.parent))return this.getObjRef(e);t=new Sr("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)t=new Sr("o","{}");else{if(i)return this.getObjRef(e);t=new Sr("o","Object.create(null)")}var r=[t];return e._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(e),this.enumerateObject(r,e),["(function(){",r,"return o;})();"]},e}();function Br(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof o.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return H(e)&&H(t)}return!1}var zr,jr,Hr,Ur,Vr,Wr=U({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Gr=e("P",i("cc.Prefab")((Mr=Nr=function(e){function t(){var t;return t=e.call(this)||this,c(t,"data",kr,h(t)),c(t,"optimizationPolicy",Fr,h(t)),c(t,"asyncLoadAssets",xr,h(t)),t._createFunction=void 0,t._instantiatedTimes=void 0,t._createFunction=null,t._instantiatedTimes=0,t}r(t,e);var i=t.prototype;return i.createNode=function(e){var t=o.instantiate(this);t.name=this.name,e(null,t)},i.compileCreateFunction=function(){var e,t;this._createFunction=(t=(e=this.data)instanceof o._BaseNode&&e,new Lr(e,t).result)},i._doInstantiate=function(e){return this.data._prefab?this.data._prefab._synced=!0:n(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)},i._instantiate=function(){var e;return this.data._prefab._synced=!0,e=this.data._instantiate(),++this._instantiatedTimes,e},t}(M),Nr.OptimizationPolicy=Wr,Nr.OptimizationPolicyThreshold=3,kr=s((Pr=Mr).prototype,"data",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fr=s(Pr.prototype,"optimizationPolicy",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wr.AUTO}}),xr=s(Pr.prototype,"asyncLoadAssets",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rr=Pr))||Rr);o.Prefab=Gr,V(o,"cc._Prefab","Prefab");var Yr,qr,Xr,Zr,$r=e("S",i("cc.SceneAsset")((Vr=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"scene",Hr,h(t)),c(t,"asyncLoadAssets",Ur,h(t)),t}return r(t,e),t}(M),Hr=s((jr=Vr).prototype,"scene",[p,f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ur=s(jr.prototype,"asyncLoadAssets",[p,f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zr=jr))||zr);o.SceneAsset=$r;var Jr,Kr,Qr,en,tn=e("a",i("cc.SpriteAtlas")((Zr=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"spriteFrames",Xr,h(t)),t}r(t,e);var i=t.prototype;return i.getTexture=function(){var e=Object.keys(this.spriteFrames);if(e.length>0){var t=this.spriteFrames[e[0]];return t&&t.texture}return null},i.getSpriteFrame=function(e){var t=this.spriteFrames[e];return t?(t.name||(t.name=e),t):null},i.getSpriteFrames=function(){for(var e=[],t=this.spriteFrames,i=0,r=Object.keys(t);i<r.length;i++){var n=r[i];e.push(t[n])}return e},i._serialize=function(){},i._deserialize=function(e,t){var i=e;this._name=i.name;var r=i.spriteFrames;this.spriteFrames=z();for(var n=0;n<r.length;n+=2)t.result.push(this.spriteFrames,r[n],r[n+1])},t}(M),Xr=s((qr=Zr).prototype,"spriteFrames",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return z()}}),Yr=qr))||Yr);o.SpriteAtlas=tn;var rn,nn,sn,on,an=e("T",i("cc.TextAsset")((en=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"text",Qr,h(t)),t}return r(t,e),t.prototype.toString=function(){return this.text},t}(M),Qr=s((Kr=en).prototype,"text",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Jr=Kr))||Jr);o.TextAsset=an;var un,cn=e("J",i("cc.JsonAsset")((on=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"json",sn,h(t)),t}return r(t,e),t}(M),sn=s((nn=on).prototype,"json",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rn=nn))||rn);o.JsonAsset=cn;var hn,ln,pn,fn,_n=e("F",i("cc.Font")(un=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(M))||un);o.Font=_n;var dn,gn,vn,mn,yn,bn,wn,An,Tn,En=e("b",i("cc.TTFFont")((fn=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"_fontFamily",pn,h(t)),t}return r(t,e),x(t,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(e){this._fontFamily=e||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:G(this._native),__isNative__:!0}}}]),t}(_n),pn=s((ln=fn).prototype,"_fontFamily",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s(ln.prototype,"_nativeAsset",[N,W],Object.getOwnPropertyDescriptor(ln.prototype,"_nativeAsset"),ln.prototype),s(ln.prototype,"_nativeDep",[N],Object.getOwnPropertyDescriptor(ln.prototype,"_nativeDep"),ln.prototype),hn=ln))||hn);o.TTFFont=En;var Sn,Cn=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},Dn=e("O",function(){function e(e){this.letterDefinitions={},this.texture=e}var t=e.prototype;return t.addLetterDefinitions=function(e,t){this.letterDefinitions[e]=t},t.cloneLetterDefinition=function(){for(var e={},t=0,i=Object.keys(this.letterDefinitions);t<i.length;t++){var r=i[t],n=new Cn;j(n,this.letterDefinitions[r]),e[r]=n}return e},t.getTexture=function(){return this.texture},t.getLetter=function(e){return this.letterDefinitions[e]},t.getLetterDefinitionForChar=function(e){var t=e.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(t)?this.letterDefinitions[t]:null},t.clear=function(){this.letterDefinitions={}},e}()),On=e("c",(dn=i("cc.BitmapFont"),gn=Y(it),dn((Tn=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"fntDataStr",yn,h(t)),c(t,"spriteFrame",bn,h(t)),c(t,"fontSize",wn,h(t)),c(t,"fntConfig",An,h(t)),t}return r(t,e),t.prototype.onLoaded=function(){var e=this.spriteFrame;!this.fontDefDictionary&&e&&(this.fontDefDictionary=new Dn(e.texture));var t=this.fntConfig;if(t){var i=t.fontDefDictionary;for(var r in i){var n=new Cn,s=i[r].rect;n.offsetX=i[r].xOffset,n.offsetY=i[r].yOffset,n.w=s.width,n.h=s.height,n.u=s.x,n.v=s.y,n.textureID=0,n.valid=!0,n.xAdvance=i[r].xAdvance,this.fontDefDictionary.addLetterDefinitions(r,n)}}else q("The fnt config is not exists!")},t}(_n),yn=s((mn=Tn).prototype,"fntDataStr",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bn=s(mn.prototype,"spriteFrame",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wn=s(mn.prototype,"fontSize",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),An=s(mn.prototype,"fntConfig",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vn=mn))||vn));o.BitmapFont=On;var In,Rn,Pn,kn,Fn,xn,Nn,Mn,Ln,Bn=e("L",i("cc.LabelAtlas")(Sn=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(On))||Sn);o.LabelAtlas=Bn;var zn=e("e",(In=i("cc.Skeleton"),Rn=Y([X]),Pn=Y([P]),In((Ln=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"_joints",xn,h(t)),c(t,"_bindposes",Nn,h(t)),c(t,"_hash",Mn,h(t)),t._invBindposes=null,t}return r(t,e),t.prototype.destroy=function(){return o.director.root.dataPoolManager.releaseSkeleton(this),e.prototype.destroy.call(this)},x(t,[{key:"joints",get:function(){return this._joints},set:function(e){this._joints=e}},{key:"bindposes",get:function(){return this._bindposes},set:function(e){this._bindposes=e}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var e=0;e<this._bindposes.length;e++){var t=new P;P.invert(t,this._bindposes[e]),this._invBindposes.push(t)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var e="",t=0;t<this._bindposes.length;t++){var i=this._bindposes[t];e+=i.m00.toPrecision(2)+" "+i.m01.toPrecision(2)+" "+i.m02.toPrecision(2)+" "+i.m03.toPrecision(2)+" "+i.m04.toPrecision(2)+" "+i.m05.toPrecision(2)+" "+i.m06.toPrecision(2)+" "+i.m07.toPrecision(2)+" "+i.m08.toPrecision(2)+" "+i.m09.toPrecision(2)+" "+i.m10.toPrecision(2)+" "+i.m11.toPrecision(2)+" "+i.m12.toPrecision(2)+" "+i.m13.toPrecision(2)+" "+i.m14.toPrecision(2)+" "+i.m15.toPrecision(2)+"\n"}this._hash=rt(e,666)}return this._hash}}]),t}(M),xn=s((Fn=Ln).prototype,"_joints",[Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nn=s(Fn.prototype,"_bindposes",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mn=s(Fn.prototype,"_hash",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kn=Fn))||kn));o.Skeleton=zn,Z(nt.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),$(nt.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]),$(st.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),Z(ot.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var jn=e("n",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},x(e,[{key:"priority",set:function(e){this._priority=e},get:function(){return this._priority}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}()),Hn=new Q("Scheduler"),Un=function(e,t,i,r){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=i,this.markedForDeletion=r};Un.get=function(e,t,i,r){var n=Un._listEntries.pop();return n?(n.target=e,n.priority=t,n.paused=i,n.markedForDeletion=r):n=new Un(e,t,i,r),n},Un.put=function(e){Un._listEntries.length<20&&(e.target=null,Un._listEntries.push(e))},Un._listEntries=[];var Vn=function(e,t,i,r){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=i,this.callback=r};Vn.get=function(e,t,i,r){var n=Vn._hashUpdateEntries.pop();return n?(n.list=e,n.entry=t,n.target=i,n.callback=r):n=new Vn(e,t,i,r),n},Vn.put=function(e){Vn._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,Vn._hashUpdateEntries.push(e))},Vn._hashUpdateEntries=[];var Wn=function(e,t,i,r,n,s){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=i,this.currentTimer=r,this.currentTimerSalvaged=n,this.paused=s};Wn.get=function(e,t,i,r,n,s){var o=Wn._hashTimerEntries.pop();return o?(o.timers=e,o.target=t,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=n,o.paused=s):o=new Wn(e,t,i,r,n,s),o},Wn.put=function(e){Wn._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,Wn._hashTimerEntries.push(e))},Wn._hashTimerEntries=[];var Gn=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,i,r,n,s){return this._lock=!1,this._scheduler=e,this._target=i,this._callback=t,this._elapsed=-1,this._interval=r,this._delay=s,this._useDelay=this._delay>0,this._repeat=n,this._runForever=this._repeat===o.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();Gn._timers=[],Gn.get=function(){return Gn._timers.pop()||new Gn},Gn.put=function(e){Gn._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,Gn._timers.push(e))};var Yn=e("f",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=z(!0),t._hashForTimers=z(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}r(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?n(1513):e.id=Hn.getNewId())};var i=t.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.getTimeScale=function(){return this._timeScale},i.update=function(e){var t,i,r,n,s;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,r=(i=this._updatesNegList).length;t<r;t++)(n=i[t]).paused||n.markedForDeletion||n.target.update(e);for(t=0,r=(i=this._updates0List).length;t<r;t++)(n=i[t]).paused||n.markedForDeletion||n.target.update(e);for(t=0,r=(i=this._updatesPosList).length;t<r;t++)(n=i[t]).paused||n.markedForDeletion||n.target.update(e);var o=this._arrayForTimers;for(t=0;t<o.length;t++){if(s=o[t],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(e),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(n=i[t]).markedForDeletion?this._removeUpdateFromHash(n):t++;for(t=0,i=this._updates0List;t<i.length;)(n=i[t]).markedForDeletion?this._removeUpdateFromHash(n):t++;for(t=0,i=this._updatesPosList;t<i.length;)(n=i[t]).markedForDeletion?this._removeUpdateFromHash(n):t++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(e,t,i,r,s,a){if("function"!=typeof e){var u=e;e=t,t=u}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!r,r=o.macro.REPEAT_FOREVER,s=0),J(t,1502);var c=t.uuid||t.id;if(c){var h,l,p=this._hashForTimers[c];if(p?p.paused!==a&&n(1511):(p=Wn.get(null,t,0,null,null,a),this._arrayForTimers.push(p),this._hashForTimers[c]=p),null==p.timers)p.timers=[];else for(l=0;l<p.timers.length;++l)if((h=p.timers[l])&&e===h._callback)return K(1507,h.getInterval(),i),void(h._interval=i);(h=Gn.get()).initWithCallback(this,e,t,i,r,s),p.timers.push(h),this._currentTarget===p&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else k(1510)},i.scheduleUpdate=function(e,t,i){var r=e.uuid||e.id;if(r){var n=this._hashForUpdates[r];if(n&&n.entry){if(n.entry.priority===t)return n.entry.markedForDeletion=!1,void(n.entry.paused=i);if(this._updateHashLocked)return K(1506),n.entry.markedForDeletion=!1,void(n.entry.paused=i);this.unscheduleUpdate(e)}var s,o=Un.get(e,t,i,!1);0===t?(s=this._updates0List,this._appendIn(s,o)):(s=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,o,t)),this._hashForUpdates[r]=Vn.get(s,o,e,null)}else k(1510)},i.unschedule=function(e,t){if(t&&e){var i=t.uuid||t.id;if(i){var r=this._hashForTimers[i];if(r)for(var n=r.timers,s=0,o=n.length;s<o;s++){var a=n[s];if(e===a._callback)return a!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),n.splice(s,1),Gn.put(a),r.timerIndex>=s&&r.timerIndex--,void(0===n.length&&(this._currentTarget===r?this._currentTargetSalvaged=!0:this._removeHashElement(r)))}}else k(1510)}},i.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForUpdates[t];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else k(1510)}},i.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];if(i){var r=i.timers;r.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var n=0,s=r.length;n<s;n++)Gn.put(r[n]);r.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(e)}else k(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(o.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(e){var t,i,r,n=this._arrayForTimers;for(t=n.length-1;t>=0;t--)i=n[t],this.unscheduleAllForTarget(i.target);var s=0;if(e<0)for(t=0;t<this._updatesNegList.length;)s=this._updatesNegList.length,(r=this._updatesNegList[t])&&r.priority>=e&&this.unscheduleUpdate(r.target),s===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)s=this._updates0List.length,(r=this._updates0List[t])&&this.unscheduleUpdate(r.target),s===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)s=this._updatesPosList.length,(r=this._updatesPosList[t])&&r.priority>=e&&this.unscheduleUpdate(r.target),s===this._updatesPosList.length&&t++},i.isScheduled=function(e,t){J(e,1508),J(t,1509);var i=t.uuid||t.id;if(i){var r=this._hashForTimers[i];if(!r)return!1;if(null==r.timers)return!1;for(var n=r.timers,s=0;s<n.length;++s)if(e===n[s]._callback)return!0;return!1}k(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(o.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(e){var t,i,r,n,s=[],o=this._arrayForTimers;for(i=0,r=o.length;i<r;i++)(t=o[i])&&(t.paused=!0,s.push(t.target));if(e<0)for(i=0;i<this._updatesNegList.length;i++)(n=this._updatesNegList[i])&&n.priority>=e&&(n.paused=!0,s.push(n.target));if(e<=0)for(i=0;i<this._updates0List.length;i++)(n=this._updates0List[i])&&(n.paused=!0,s.push(n.target));for(i=0;i<this._updatesPosList.length;i++)(n=this._updatesPosList[i])&&n.priority>=e&&(n.paused=!0,s.push(n.target));return s},i.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},i.pauseTarget=function(e){J(e,1503);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!0);var r=this._hashForUpdates[t];r&&(r.entry.paused=!0)}else k(1510)},i.resumeTarget=function(e){J(e,1504);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!1);var r=this._hashForUpdates[t];r&&(r.entry.paused=!1)}else k(1510)},i.isTargetPaused=function(e){J(e,1505);var t=e.uuid||e.id;if(!t)return k(1510),!1;var i=this._hashForTimers[t];if(i)return i.paused;var r=this._hashForUpdates[t];return!!r&&r.entry.paused},i._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var i=this._arrayForTimers,r=0,n=i.length;r<n;r++)if(i[r]===e){i.splice(r,1);break}Wn.put(e)},i._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,i=this._hashForUpdates[t];if(i){for(var r=i.list,n=i.entry,s=0,o=r.length;s<o;s++)if(r[s]===n){r.splice(s,1);break}delete this._hashForUpdates[t],Un.put(n),Vn.put(i)}},i._priorityIn=function(e,t,i){for(var r=0;r<e.length;r++)if(i<e[r].priority)return void e.splice(r,0,t);e.push(t)},i._appendIn=function(e,t){e.push(t)},t}(jn));Yn.PRIORITY_SYSTEM=1<<31,Yn.PRIORITY_NON_SYSTEM=Yn.PRIORITY_SYSTEM+1,Yn.ID="scheduler",o.Scheduler=Yn;var qn,Xn,Zn,$n,Jn,Kn,Qn,es,ts,is,rs,ns,ss,os,as,us,cs,hs,ls,ps,fs,_s,ds,gs,vs,ms,ys,bs,ws,As,Ts,Es,Ss,Cs,Ds,Os,Is,Rs,Ps,ks,Fs,xs,Ns,Ms,Ls,Bs,zs,js,Hs,Us,Vs,Ws,Gs,Ys,qs,Xs,Zs,$s,Js,Ks,Qs,eo,to,io,ro,no,so,oo,ao,uo,co,ho,lo,po,fo,_o,go,vo=function(){function e(e){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new at(e),this.jointAnimationInfo=new ut(e)}var t=e.prototype;return t.releaseSkeleton=function(e){this.jointTexturePool.releaseSkeleton(e)},t.releaseAnimationClip=function(e){this.jointTexturePool.releaseAnimationClip(e)},t.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},e}(),mo=new S,yo=U(ct),bo=U(ht),wo=U(lt),Ao=U(pt),To=U(ft),Eo=U({SKYBOX:_t|dt.DEPTH_STENCIL,SOLID_COLOR:dt.ALL,DEPTH_ONLY:dt.DEPTH_STENCIL,DONT_CLEAR:dt.NONE}),So=e("o",(qn=i("cc.Camera"),Xn=ie(),Zn=re(),$n=ne(),Jn=se(),Kn=Y(gt.BitMask),Qn=ne(),es=se(),ts=Y(Eo),is=ne(),rs=se(),ns=ne(),ss=se(),os=ne(),as=se(),us=ne(),cs=se(),hs=Y(yo),ls=ne(),ps=se(),fs=Y(bo),_s=ne(),ds=se(),gs=ne(),vs=se(),ms=ne(),ys=se(),bs=ne(),ws=se(),As=ne(),Ts=se(),Es=Y(wo),Ss=ne(),Cs=se(),Ds=Y(Ao),Os=ne(),Is=se(),Rs=Y(To),Ps=ne(),ks=se(),Fs=ne(),xs=se(),Ns=Y(ot),Ms=ne(),Ls=se(),qn(Bs=Xn(Bs=Zn(Bs=ee((so=no=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"_projection",js,h(t)),c(t,"_priority",Hs,h(t)),c(t,"_fov",Us,h(t)),c(t,"_fovAxis",Vs,h(t)),c(t,"_orthoHeight",Ws,h(t)),c(t,"_near",Gs,h(t)),c(t,"_far",Ys,h(t)),c(t,"_color",qs,h(t)),c(t,"_depth",Xs,h(t)),c(t,"_stencil",Zs,h(t)),c(t,"_clearFlags",$s,h(t)),c(t,"_rect",Js,h(t)),c(t,"_aperture",Ks,h(t)),c(t,"_shutter",Qs,h(t)),c(t,"_iso",eo,h(t)),c(t,"_screenScale",to,h(t)),c(t,"_visibility",io,h(t)),c(t,"_targetTexture",ro,h(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}r(t,e);var i=t.prototype;return i.onLoad=function(){this._createCamera()},i.onEnable=function(){this.node.hasChangedFlags|=vt.POSITION,this._camera&&this._attachToScene()},i.onDisable=function(){this._camera&&this._detachFromScene()},i.onDestroy=function(){this._camera&&(o.director.root.destroyCamera(this._camera),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},i.screenPointToRay=function(e,t,i){return i||(i=mt.create()),this._camera&&this._camera.screenPointToRay(i,e,t),i},i.worldToScreen=function(e,t){return t||(t=new S),this._camera&&this._camera.worldToScreen(t,e),t},i.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},i.convertToUINode=function(e,t,i){if(i||(i=new S),!this._camera)return i;this.worldToScreen(e,mo);var r=t.getComponent("cc.UITransform"),n=yt.getVisibleSize(),s=mo.x-.5*this._camera.width,a=mo.y-.5*this._camera.height;return mo.x=s/o.view.getScaleX()+.5*n.width,mo.y=a/o.view.getScaleY()+.5*n.height,r&&r.convertToNodeSpaceAR(mo,i),i},i._createCamera=function(){this._camera=o.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?o.director.root&&o.director.root.mainWindow:o.director.root&&o.director.root.tempWindow,priority:this._priority,flows:this._flows}),this._camera&&(this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=te(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},i._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},i._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},i._chechTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},i._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},x(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===ht.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=te(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&(this._camera.viewport=e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._chechTargetTextureEvent(t),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?o.director.root&&o.director.root.mainWindow:o.director.root&&o.director.root.tempWindow)}},{key:"flows",set:function(e){this._camera&&(this._camera.flows=e),this._flows=e}}]),t}(l),no.ProjectionType=yo,no.FOVAxis=bo,no.ClearFlag=Eo,no.Aperture=wo,no.Shutter=Ao,no.ISO=To,js=s((zs=so).prototype,"_projection",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yo.PERSPECTIVE}}),Hs=s(zs.prototype,"_priority",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Us=s(zs.prototype,"_fov",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),Vs=s(zs.prototype,"_fovAxis",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bo.VERTICAL}}),Ws=s(zs.prototype,"_orthoHeight",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Gs=s(zs.prototype,"_near",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ys=s(zs.prototype,"_far",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),qs=s(zs.prototype,"_color",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O("#333333")}}),Xs=s(zs.prototype,"_depth",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Zs=s(zs.prototype,"_stencil",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$s=s(zs.prototype,"_clearFlags",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Eo.SOLID_COLOR}}),Js=s(zs.prototype,"_rect",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new R(0,0,1,1)}}),Ks=s(zs.prototype,"_aperture",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wo.F16_0}}),Qs=s(zs.prototype,"_shutter",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ao.D125}}),eo=s(zs.prototype,"_iso",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return To.ISO100}}),to=s(zs.prototype,"_screenScale",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),io=s(zs.prototype,"_visibility",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bt}}),ro=s(zs.prototype,"_targetTexture",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s(zs.prototype,"priority",[$n,Jn],Object.getOwnPropertyDescriptor(zs.prototype,"priority"),zs.prototype),s(zs.prototype,"visibility",[Kn,Qn,es],Object.getOwnPropertyDescriptor(zs.prototype,"visibility"),zs.prototype),s(zs.prototype,"clearFlags",[ts,is,rs],Object.getOwnPropertyDescriptor(zs.prototype,"clearFlags"),zs.prototype),s(zs.prototype,"clearColor",[ns,ss],Object.getOwnPropertyDescriptor(zs.prototype,"clearColor"),zs.prototype),s(zs.prototype,"clearDepth",[os,as],Object.getOwnPropertyDescriptor(zs.prototype,"clearDepth"),zs.prototype),s(zs.prototype,"clearStencil",[us,cs],Object.getOwnPropertyDescriptor(zs.prototype,"clearStencil"),zs.prototype),s(zs.prototype,"projection",[hs,ls,ps],Object.getOwnPropertyDescriptor(zs.prototype,"projection"),zs.prototype),s(zs.prototype,"fovAxis",[fs,_s,ds],Object.getOwnPropertyDescriptor(zs.prototype,"fovAxis"),zs.prototype),s(zs.prototype,"fov",[gs,vs],Object.getOwnPropertyDescriptor(zs.prototype,"fov"),zs.prototype),s(zs.prototype,"orthoHeight",[ms,ys],Object.getOwnPropertyDescriptor(zs.prototype,"orthoHeight"),zs.prototype),s(zs.prototype,"near",[bs,ws],Object.getOwnPropertyDescriptor(zs.prototype,"near"),zs.prototype),s(zs.prototype,"far",[As,Ts],Object.getOwnPropertyDescriptor(zs.prototype,"far"),zs.prototype),s(zs.prototype,"aperture",[Es,Ss,Cs],Object.getOwnPropertyDescriptor(zs.prototype,"aperture"),zs.prototype),s(zs.prototype,"shutter",[Ds,Os,Is],Object.getOwnPropertyDescriptor(zs.prototype,"shutter"),zs.prototype),s(zs.prototype,"iso",[Rs,Ps,ks],Object.getOwnPropertyDescriptor(zs.prototype,"iso"),zs.prototype),s(zs.prototype,"rect",[Fs,xs],Object.getOwnPropertyDescriptor(zs.prototype,"rect"),zs.prototype),s(zs.prototype,"targetTexture",[Ns,Ms,Ls],Object.getOwnPropertyDescriptor(zs.prototype,"targetTexture"),zs.prototype),Bs=zs))||Bs)||Bs)||Bs)||Bs));o.Camera=So;var Co,Do,Oo,Io,Ro,Po,ko,Fo,xo,No,Mo,Lo,Bo,zo,jo,Ho,Uo,Vo,Wo,Go,Yo,qo,Xo,Zo,$o,Jo,Ko,Qo,ea,ta,ia,ra,na,sa,oa,aa,ua,ca,ha,la,pa,fa,_a,da,ga,va,ma,ya,ba,wa,Aa,Ta,Ea,Sa,Ca,Da,Oa,Ia,Ra,Pa,ka,Fa,xa,Na,Ma,La,Ba,za,ja,Ha,Ua,Va,Wa,Ga,Ya,qa,Xa,Za,$a,Ja,Ka,Qa,eu,tu,iu,ru,nu,su,ou,au,uu,cu,hu,lu,pu,fu,_u,du,gu,vu,mu,yu,bu,wu,Au,Tu,Eu,Su=e("E",(oo=i("cc.ClickEvent"),ao=Y(o.Node),oo((go=function(){function e(){c(this,"target",ho,this),c(this,"component",lo,this),c(this,"_componentId",po,this),c(this,"handler",fo,this),c(this,"customEventData",_o,this)}e.emitEvents=function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(var s=0,o=t.length;s<o;s++){var a=t[s];a instanceof e&&a.emit(r)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(o.isValid(t)){this._genCompIdIfNeeded();var i=o.js._getClassById(this._componentId),r=t.getComponent(i);if(o.isValid(r)){var n=r[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),n.apply(r,e))}}},t._compName2Id=function(e){var t=o.js.getClassByName(e);return o.js._getClassId(t)},t._compId2Name=function(e){var t=o.js._getClassById(e);return o.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},x(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),ho=s((co=go).prototype,"target",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lo=s(co.prototype,"component",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),po=s(co.prototype,"_componentId",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fo=s(co.prototype,"handler",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_o=s(co.prototype,"customEventData",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),uo=co))||uo));o.Component.EventHandler=Su;var Cu=new S(0,1,0),Du=new S,Ou=new D,Iu=(Co=i("cc.AmbientInfo"),Do=Y(oe),Co((Fo=function(){function e(){c(this,"_skyColor",Ro,this),c(this,"_skyIllum",Po,this),c(this,"_groundAlbedo",ko,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},x(e,[{key:"skyColor",set:function(e){this._skyColor.set(e),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(e){this._skyIllum=e,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(e){this._groundAlbedo.set(e),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),e}(),Ro=s((Io=Fo).prototype,"_skyColor",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(51,128,204,1)}}),Po=s(Io.prototype,"_skyIllum",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return St.SKY_ILLUM}}),ko=s(Io.prototype,"_groundAlbedo",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(51,51,51,255)}}),s(Io.prototype,"skyColor",[p],Object.getOwnPropertyDescriptor(Io.prototype,"skyColor"),Io.prototype),s(Io.prototype,"skyIllum",[p,Do],Object.getOwnPropertyDescriptor(Io.prototype,"skyIllum"),Io.prototype),s(Io.prototype,"groundAlbedo",[p],Object.getOwnPropertyDescriptor(Io.prototype,"groundAlbedo"),Io.prototype),Oo=Io))||Oo);o.AmbientInfo=Iu;var Ru=(xo=i("cc.SkyboxInfo"),No=Y(wt),Mo=Y(wt),xo((Vo=function(){function e(){c(this,"_envmap",zo,this),c(this,"_isRGBE",jo,this),c(this,"_enabled",Ho,this),c(this,"_useIBL",Uo,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},x(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(e){this._envmap=e,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(e){this._isRGBE=e,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),e}(),zo=s((Bo=Vo).prototype,"_envmap",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jo=s(Bo.prototype,"_isRGBE",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ho=s(Bo.prototype,"_enabled",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uo=s(Bo.prototype,"_useIBL",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s(Bo.prototype,"enabled",[p],Object.getOwnPropertyDescriptor(Bo.prototype,"enabled"),Bo.prototype),s(Bo.prototype,"useIBL",[p],Object.getOwnPropertyDescriptor(Bo.prototype,"useIBL"),Bo.prototype),s(Bo.prototype,"envmap",[p,Mo],Object.getOwnPropertyDescriptor(Bo.prototype,"envmap"),Bo.prototype),s(Bo.prototype,"isRGBE",[p],Object.getOwnPropertyDescriptor(Bo.prototype,"isRGBE"),Bo.prototype),Lo=Bo))||Lo);o.SkyboxInfo=Ru;var Pu=(Wo=i("cc.FogInfo"),Go=Y(At),Yo=he(),qo=Y(oe),Xo=le(),Zo=pe(),$o=ne(),Jo=he(),Ko=Y(oe),Qo=pe(),ea=ne(),ta=he(),ia=Y(oe),ra=pe(),na=ne(),sa=he(),oa=Y(oe),aa=fe(),ua=pe(),ca=ne(),ha=he(),la=Y(oe),pa=pe(),fa=ne(),_a=he(),da=Y(oe),ga=pe(),va=ne(),Wo((Ra=Ia=function(){function e(){c(this,"_type",ba,this),c(this,"_fogColor",wa,this),c(this,"_enabled",Aa,this),c(this,"_fogDensity",Ta,this),c(this,"_fogStart",Ea,this),c(this,"_fogEnd",Sa,this),c(this,"_fogAtten",Ca,this),c(this,"_fogTop",Da,this),c(this,"_fogRange",Oa,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},x(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}(),Ia.FogType=At,ba=s((ya=Ra).prototype,"_type",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return At.LINEAR}}),wa=s(ya.prototype,"_fogColor",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O("#C8C8C8")}}),Aa=s(ya.prototype,"_enabled",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ta=s(ya.prototype,"_fogDensity",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Ea=s(ya.prototype,"_fogStart",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Sa=s(ya.prototype,"_fogEnd",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),Ca=s(ya.prototype,"_fogAtten",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Da=s(ya.prototype,"_fogTop",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),Oa=s(ya.prototype,"_fogRange",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),s(ya.prototype,"enabled",[p],Object.getOwnPropertyDescriptor(ya.prototype,"enabled"),ya.prototype),s(ya.prototype,"fogColor",[p],Object.getOwnPropertyDescriptor(ya.prototype,"fogColor"),ya.prototype),s(ya.prototype,"type",[p,Go],Object.getOwnPropertyDescriptor(ya.prototype,"type"),ya.prototype),s(ya.prototype,"fogDensity",[Yo,qo,Xo,Zo,ae,$o],Object.getOwnPropertyDescriptor(ya.prototype,"fogDensity"),ya.prototype),s(ya.prototype,"fogStart",[Jo,Ko,Qo,ea],Object.getOwnPropertyDescriptor(ya.prototype,"fogStart"),ya.prototype),s(ya.prototype,"fogEnd",[ta,ia,ra,na],Object.getOwnPropertyDescriptor(ya.prototype,"fogEnd"),ya.prototype),s(ya.prototype,"fogAtten",[sa,oa,aa,ua,ca],Object.getOwnPropertyDescriptor(ya.prototype,"fogAtten"),ya.prototype),s(ya.prototype,"fogTop",[ha,la,pa,fa],Object.getOwnPropertyDescriptor(ya.prototype,"fogTop"),ya.prototype),s(ya.prototype,"fogRange",[_a,da,ga,va],Object.getOwnPropertyDescriptor(ya.prototype,"fogRange"),ya.prototype),ma=ya))||ma),ku=(Pa=i("cc.ShadowsInfo"),ka=Y(Tt),Fa=he(),xa=Y(oe),Na=he(),Ma=Y(Et),La=he(),Ba=Y(ue),za=he(),ja=Y(oe),Ha=he(),Ua=Y(oe),Va=he(),Wa=Y(oe),Ga=he(),Ya=Y(ce),qa=he(),Xa=he(),Za=Y(oe),$a=he(),Ja=Y(oe),Ka=he(),Pa((du=function(){function e(){c(this,"_type",tu,this),c(this,"_enabled",iu,this),c(this,"_normal",ru,this),c(this,"_distance",nu,this),c(this,"_shadowColor",su,this),c(this,"_autoAdapt",ou,this),c(this,"_pcf",au,this),c(this,"_bias",uu,this),c(this,"_near",cu,this),c(this,"_far",hu,this),c(this,"_aspect",lu,this),c(this,"_orthoSize",pu,this),c(this,"_maxReceived",fu,this),c(this,"_size",_u,this),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(Ou),this.normal=S.transformQuat(Du,Cu,Ou),e.getWorldPosition(Du),this.distance=S.dot(this._normal,Du)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},x(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(e){this._type=e,this._resource&&(this._resource.type=e)},get:function(){return this._type}},{key:"shadowColor",set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)},get:function(){return this._shadowColor}},{key:"normal",set:function(e){S.copy(this._normal,e),this._resource&&(this._resource.normal=e)},get:function(){return this._normal}},{key:"distance",set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)},get:function(){return this._distance}},{key:"pcf",set:function(e){this._pcf=e,this._resource&&(this._resource.pcf=e)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(e){this._autoAdapt=e,this._resource&&(this._resource.autoAdapt=e)},get:function(){return this._autoAdapt}},{key:"near",set:function(e){this._near=e,this._resource&&(this._resource.near=e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this._resource&&(this._resource.far=e)},get:function(){return this._far}},{key:"orthoSize",set:function(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(e){this._size.set(e),this._resource&&(this._resource.size=e,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(e){this._aspect=e,this._resource&&(this._resource.aspect=e)},get:function(){return this._aspect}},{key:"bias",set:function(e){this._bias=e,this._resource&&(this._resource.bias=e)},get:function(){return this._bias}}]),e}(),tu=s((eu=du).prototype,"_type",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tt.Planar}}),iu=s(eu.prototype,"_enabled",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ru=s(eu.prototype,"_normal",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new S(0,1,0)}}),nu=s(eu.prototype,"_distance",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),su=s(eu.prototype,"_shadowColor",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0,76)}}),ou=s(eu.prototype,"_autoAdapt",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),au=s(eu.prototype,"_pcf",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Et.HARD}}),uu=s(eu.prototype,"_bias",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),cu=s(eu.prototype,"_near",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hu=s(eu.prototype,"_far",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),lu=s(eu.prototype,"_aspect",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),pu=s(eu.prototype,"_orthoSize",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),fu=s(eu.prototype,"_maxReceived",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),_u=s(eu.prototype,"_size",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new E(512,512)}}),s(eu.prototype,"enabled",[p],Object.getOwnPropertyDescriptor(eu.prototype,"enabled"),eu.prototype),s(eu.prototype,"type",[p,ka],Object.getOwnPropertyDescriptor(eu.prototype,"type"),eu.prototype),s(eu.prototype,"shadowColor",[p],Object.getOwnPropertyDescriptor(eu.prototype,"shadowColor"),eu.prototype),s(eu.prototype,"normal",[Fa],Object.getOwnPropertyDescriptor(eu.prototype,"normal"),eu.prototype),s(eu.prototype,"distance",[xa,Na],Object.getOwnPropertyDescriptor(eu.prototype,"distance"),eu.prototype),s(eu.prototype,"pcf",[Ma,La],Object.getOwnPropertyDescriptor(eu.prototype,"pcf"),eu.prototype),s(eu.prototype,"autoAdapt",[Ba,za],Object.getOwnPropertyDescriptor(eu.prototype,"autoAdapt"),eu.prototype),s(eu.prototype,"near",[ja,Ha],Object.getOwnPropertyDescriptor(eu.prototype,"near"),eu.prototype),s(eu.prototype,"far",[Ua,Va],Object.getOwnPropertyDescriptor(eu.prototype,"far"),eu.prototype),s(eu.prototype,"orthoSize",[Wa,Ga],Object.getOwnPropertyDescriptor(eu.prototype,"orthoSize"),eu.prototype),s(eu.prototype,"maxReceived",[Ya,qa],Object.getOwnPropertyDescriptor(eu.prototype,"maxReceived"),eu.prototype),s(eu.prototype,"shadowMapSize",[Xa],Object.getOwnPropertyDescriptor(eu.prototype,"shadowMapSize"),eu.prototype),s(eu.prototype,"aspect",[Za,$a],Object.getOwnPropertyDescriptor(eu.prototype,"aspect"),eu.prototype),s(eu.prototype,"bias",[Ja,Ka],Object.getOwnPropertyDescriptor(eu.prototype,"bias"),eu.prototype),Qa=eu))||Qa);o.ShadowsInfo=ku;var Fu,xu,Nu,Mu,Lu,Bu=(gu=i("cc.SceneGlobals"),vu=Y(Ru),gu((Eu=function(){function e(){c(this,"ambient",bu,this),c(this,"shadows",wu,this),c(this,"_skybox",Au,this),c(this,"fog",Tu,this)}return e.prototype.activate=function(){var e=o.director.root.pipeline;this.ambient.activate(e.ambient),this.skybox.activate(e.skybox),this.shadows.activate(e.shadows),this.fog.activate(e.fog)},x(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),bu=s((yu=Eu).prototype,"ambient",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Iu}}),wu=s(yu.prototype,"shadows",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ku}}),Au=s(yu.prototype,"_skybox",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ru}}),Tu=s(yu.prototype,"fog",[p,f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pu}}),s(yu.prototype,"skybox",[p,vu],Object.getOwnPropertyDescriptor(yu.prototype,"skybox"),yu.prototype),mu=yu))||mu);o.SceneGlobals=Bu;var zu,ju=e("k",i("cc.Scene")((Lu=function(e){function t(t){var i;return i=e.call(this,t)||this,c(i,"autoReleaseAssets",Nu,h(i)),c(i,"_globals",Mu,h(i)),i._renderScene=null,i.dependAssets=null,i._inited=void 0,i._prefabSyncedInLiveReload=!1,i._pos=S.ZERO,i._rot=D.IDENTITY,i._scale=S.ONE,i._mat=P.IDENTITY,i._dirtyFlags=0,i._activeInHierarchy=!1,o.director&&o.director.root&&(i._renderScene=o.director.root.createScene({})),i._inited=!o.game||!o.game._isCloning,i}r(t,e),x(t,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]);var i=t.prototype;return i.destroy=function(){var e=B.prototype.destroy.call(this);if(e)for(var t=this._children,i=0;i<t.length;++i)t[i].active=!1;return o.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},i.addComponent=function(){throw new Error(T(3822))},i._onHierarchyChanged=function(){},i._onBatchCreated=function(){e.prototype._onBatchCreated.call(this);for(var t=this._children.length,i=0;i<t;++i)this._children[i]._onBatchCreated()},i._onBatchRestored=function(){this._onBatchCreated()},i.getPosition=function(e){return S.copy(e||new S,S.ZERO)},i.getRotation=function(e){return D.copy(e||new D,D.IDENTITY)},i.getScale=function(e){return S.copy(e||new S,S.ONE)},i.getWorldPosition=function(e){return S.copy(e||new S,S.ZERO)},i.getWorldRotation=function(e){return D.copy(e||new D,D.IDENTITY)},i.getWorldScale=function(e){return S.copy(e||new S,S.ONE)},i.getWorldMatrix=function(e){return P.copy(e||new P,P.IDENTITY)},i.getWorldRS=function(e){return P.copy(e||new P,P.IDENTITY)},i.getWorldRT=function(e){return P.copy(e||new P,P.IDENTITY)},i.updateWorldTransform=function(){},i._instantiate=function(){},i._load=function(){this._inited||(this._onBatchCreated(),this._inited=!0),this.walk(Ct._setScene)},i._activate=function(e){e=!1!==e,o.director._nodeActivator.activateNode(this,e),this._globals.activate()},x(t,[{key:"position",get:function(){return S.ZERO}},{key:"worldPosition",get:function(){return S.ZERO}},{key:"rotation",get:function(){return D.IDENTITY}},{key:"worldRotation",get:function(){return D.IDENTITY}},{key:"scale",get:function(){return S.ONE}},{key:"worldScale",get:function(){return S.ONE}},{key:"eulerAngles",get:function(){return S.ZERO}},{key:"worldMatrix",get:function(){return P.IDENTITY}}]),t}(Ct),s((xu=Lu).prototype,"globals",[p],Object.getOwnPropertyDescriptor(xu.prototype,"globals"),xu.prototype),Nu=s(xu.prototype,"autoReleaseAssets",[f,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mu=s(xu.prototype,"_globals",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bu}}),Fu=xu))||Fu);o.Scene=ju,B.Flags.HideInHierarchy;var Hu=e("m",i("cc.PrivateNode")(zu=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(Dt))||zu);o.PrivateNode=Hu;var Uu=_e.fastRemoveAt,Vu=B.Flags.IsStartCalled,Wu=B.Flags.IsOnEnableCalled;function Gu(e,t){for(var i=t.constructor._executionOrder,r=t._id,n=0,s=e.length-1,o=s>>>1;n<=s;o=n+s>>>1){var a=e[o],u=a.constructor._executionOrder;if(u>i)s=o-1;else if(u<i)n=o+1;else{var c=a._id;if(c>r)s=o-1;else{if(!(c<r))return o;n=o+1}}}return~n}function Yu(e,t){for(var i=e.array,r=e.i+1;r<i.length;){var n=i[r];n._enabled&&n.node._activeInHierarchy?++r:(e.removeAt(r),t&&(n._objFlags&=~t))}}B.Flags.IsEditorOnEnableCalled;var qu=function(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var t=de;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e};function Xu(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}qu.stableRemoveInactive=Yu;var Zu=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var i=t.prototype;return i.add=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)},i.remove=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)},i.cancelInactive=function(e){Yu(this._zero,e),Yu(this._neg,e),Yu(this._pos,e)},i.invoke=function(){var e=this._neg;e.array.length>0&&(e.array.sort(Xu),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var t=this._pos;t.array.length>0&&(t.array.sort(Xu),this._invoke(t),t.array.length=0)},t}(qu),$u=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var i=t.prototype;return i.add=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{var i=t<0?this._neg.array:this._pos.array,r=Gu(i,e);r<0&&i.splice(~r,0,e)}},i.remove=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{var i=t<0?this._neg:this._pos,r=Gu(i.array,e);r>=0&&i.removeAt(r)}},i.invoke=function(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)},t}(qu);function Ju(e,t,i){return function(r,n){try{t(r,n)}catch(t){o._throw(t);var s=r.array;for(i&&(s[r.i]._objFlags|=i),++r.i;r.i<s.length;++r.i)try{e(s[r.i],n)}catch(e){o._throw(e),i&&(s[r.i]._objFlags|=i)}}}}var Ku=Ju((function(e){e.start(),e._objFlags|=Vu}),(function(e){var t=e.array;for(e.i=0;e.i<t.length;++e.i){var i=t[e.i];i.start(),i._objFlags|=Vu}}),Vu),Qu=Ju((function(e,t){e.update(t)}),(function(e,t){var i=e.array;for(e.i=0;e.i<i.length;++e.i)i[e.i].update(t)})),ec=Ju((function(e,t){e.lateUpdate(t)}),(function(e,t){var i=e.array;for(e.i=0;e.i<i.length;++e.i)i[e.i].lateUpdate(t)})),tc=function(e){var t=o.director._compScheduler,i=e.array;for(e.i=0;e.i<i.length;++e.i){var r=i[e.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||t._onEnabled(r))}},ic=function(){function e(){this._deferredComps=[],this.unscheduleAll()}var t=e.prototype;return t.unscheduleAll=function(){this.startInvoker=new Zu(Ku),this.updateInvoker=new $u(Qu),this.lateUpdateInvoker=new $u(ec),this._updating=!1},t._onEnabled=function(e){o.director.getScheduler().resumeTarget(e),e._objFlags|=Wu,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)},t._onDisabled=function(e){o.director.getScheduler().pauseTarget(e),e._objFlags&=~Wu;var t=this._deferredComps.indexOf(e);t>=0?Uu(this._deferredComps,t):(!e.start||e._objFlags&Vu||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))},t.enableComp=function(e,t){if(!(e._objFlags&Wu)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}},t.disableComp=function(e){e._objFlags&Wu&&(e.onDisable&&e.onDisable(),this._onDisabled(e))},t.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},t.updatePhase=function(e){this.updateInvoker.invoke(e)},t.lateUpdatePhase=function(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()},t._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},t._scheduleImmediate=function(e){"function"!=typeof e.start||e._objFlags&Vu||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)},t._deferredSchedule=function(){for(var e=this._deferredComps,t=0,i=e.length;t<i;t++)this._scheduleImmediate(e[t]);e.length=0},e}(),rc=B.Flags.IsPreloadStarted,nc=B.Flags.IsOnLoadStarted,sc=B.Flags.IsOnLoadCalled,oc=B.Flags.Deactivating,ac=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var i=t.prototype;return i.add=function(e){this._zero.array.push(e)},i.remove=function(e){this._zero.fastRemove(e)},i.cancelInactive=function(e){qu.stableRemoveInactive(this._zero,e)},i.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},t}(qu),uc=Ju((function(e){e.__preload()}),(function(e){var t=e.array;for(e.i=0;e.i<t.length;++e.i)t[e.i].__preload()})),cc=Ju((function(e){e.onLoad(),e._objFlags|=sc}),(function(e){var t=e.array;for(e.i=0;e.i<t.length;++e.i){var i=t[e.i];i.onLoad(),i._objFlags|=sc}}),sc),hc=new d(4);function lc(e,t,i){t?e._removeComponent(t):_e.removeAt(e._components,i)}hc.get=function(){var e=this._get()||{preload:new ac(uc),onLoad:new Zu(cc),onEnable:new Zu(tc)};e.preload._zero.i=-1;var t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,(t=e.onEnable)._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};var pc,fc,_c,dc,gc,vc,mc,yc,bc,wc,Ac,Tc,Ec,Sc,Cc,Dc,Oc,Ic,Rc,Pc,kc,Fc,xc,Nc,Mc,Lc,Bc,zc,jc,Hc,Uc,Vc,Wc,Gc,Yc,qc,Xc,Zc,$c,Jc=e("N",function(){function e(){this.resetComp=void 0,this.reset()}var t=e.prototype;return t.reset=function(){this._activatingStack=[]},t.activateNode=function(e,t){if(t){var i=hc.get();this._activatingStack.push(i),this._activateNodeRecursively(e,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),hc.put(i)}else{this._deactivateNodeRecursively(e);for(var r,n=this._activatingStack,s=L(n);!(r=s()).done;){var o=r.value;o.preload.cancelInactive(rc),o.onLoad.cancelInactive(nc),o.onEnable.cancelInactive()}}e.emit("active-in-hierarchy-changed",e)},t.activateComp=function(e,t,i,r){if(ge(e,!0)&&(e._objFlags&rc||(e._objFlags|=rc,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&nc||(e._objFlags|=nc,e.onLoad?i?i.add(e):(e.onLoad(),e._objFlags|=sc):e._objFlags|=sc),e._enabled)){if(!e.node._activeInHierarchy)return;o.director._compScheduler.enableComp(e,r)}},t.destroyComp=function(e){o.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&sc&&e.onDestroy()},t._activateNodeRecursively=function(e,t,i,r){if(e._objFlags&oc)k(3816,e.name);else{e._activeInHierarchy=!0;for(var n=e._components.length,s=0;s<n;++s){var a=e._components[s];a instanceof o.Component?this.activateComp(a,t,i,r):(lc(e,a,s),--s,--n)}e._childArrivalOrder=e._children.length;for(var u=0,c=e._children.length;u<c;++u){var h=e._children[u];h._active&&this._activateNodeRecursively(h,t,i,r)}e._onPostActivated(!0)}},t._deactivateNodeRecursively=function(e){e._objFlags|=oc,e._activeInHierarchy=!1;for(var t=e._components.length,i=0;i<t;++i){var r=e._components[i];if(r._enabled&&(o.director._compScheduler.disableComp(r),e._activeInHierarchy))return void(e._objFlags&=~oc)}for(var n=0,s=e._children.length;n<s;++n){var a=e._children[n];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),e._activeInHierarchy))return void(e._objFlags&=~oc)}e._onPostActivated(!1),e._objFlags&=~oc},e}());Z(Ct.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),Z(Dt.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new E),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new I),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setContentSize(e,t)}}]),$(Dt.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),$(gt,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),Z(gt,"Layers",[{name:"Default",newName:"DEFAULT",target:gt.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:gt.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:gt.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:gt.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:gt.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:gt.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:gt.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:gt.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:gt,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:gt,targetName:"Layers"}]),$(gt.Enum,"Layers.Enum",[{name:"ALWAYS"}]),$(gt.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var Kc,Qc,eh=new S;function th(e){return e instanceof ju?It:e._uiProps.uiTransformComp?e._uiProps.uiTransformComp.contentSize:I.ZERO}function ih(e,t,i,r){for(var n=e.parent?e.parent.getScale():eh,s=n.x,o=n.y,a=0,u=0,c=e.parent;;){if(!c)return i.x=i.y=0,void(r.x=r.y=1);var h=c.getPosition();if(a+=h.x,u+=h.y,(c=c.parent)===t)break;var l=(n=c?c.getScale():eh).x,p=n.y;a*=l,u*=p,s*=l,o*=p}r.x=0!==s?1/s:1,r.y=0!==o?1/o:1,i.x=-a,i.y=-u}!function(e){e[e.ONCE=0]="ONCE",e[e.ALWAYS=1]="ALWAYS",e[e.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(Kc||(Kc=e("z",{}))),ve(Kc),function(e){e[e.TOP=1]="TOP",e[e.MID=2]="MID",e[e.BOT=4]="BOT",e[e.LEFT=8]="LEFT",e[e.CENTER=16]="CENTER",e[e.RIGHT=32]="RIGHT",e[e.HORIZONTAL=56]="HORIZONTAL",e[e.VERTICAL=7]="VERTICAL"}(Qc||(Qc=e("K",{})));var rh,nh,sh,oh,ah,uh,ch,hh,lh,ph,fh,_h,dh,gh,vh,mh,yh,bh,wh,Ah,Th,Eh,Sh,Ch=Qc.TOP|Qc.BOT,Dh=Qc.LEFT|Qc.RIGHT,Oh=e("W",(pc=i("cc.Widget"),fc=ie(),_c=Pt(110),dc=re(),gc=kt(Rt),vc=Y(Dt),mc=se(),yc=se(),bc=se(),wc=se(),Ac=se(),Tc=se(),Ec=se(),Sc=he(),Cc=he(),Dc=Y(Kc),Oc=se(),pc(Ic=fc(Ic=_c(Ic=dc(Ic=gc(Ic=ee(($c=Zc=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this)._lastPos=new S,t._lastSize=new I,t._dirty=!0,c(t,"_alignFlags",Pc,h(t)),c(t,"_target",kc,h(t)),c(t,"_left",Fc,h(t)),c(t,"_right",xc,h(t)),c(t,"_top",Nc,h(t)),c(t,"_bottom",Mc,h(t)),c(t,"_horizontalCenter",Lc,h(t)),c(t,"_verticalCenter",Bc,h(t)),c(t,"_isAbsLeft",zc,h(t)),c(t,"_isAbsRight",jc,h(t)),c(t,"_isAbsTop",Hc,h(t)),c(t,"_isAbsBottom",Uc,h(t)),c(t,"_isAbsHorizontalCenter",Vc,h(t)),c(t,"_isAbsVerticalCenter",Wc,h(t)),c(t,"_originalWidth",Gc,h(t)),c(t,"_originalHeight",Yc,h(t)),c(t,"_alignMode",qc,h(t)),c(t,"_lockFlags",Xc,h(t)),t}r(t,e);var i=t.prototype;return i.updateAlignment=function(){o._widgetManager.updateAlignment(this.node)},i._validateTargetInDEV=function(){},i.setDirty=function(){this._recursiveDirty()},i.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),o._widgetManager.add(this),this._registerEvent(),this._registerTargetEvents()},i.onDisable=function(){o._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},i.onDestroy=function(){this._removeParentEvent()},i._adjustWidgetToAllowMovingInEditor=function(){},i._adjustWidgetToAllowResizingInEditor=function(){},i._adjustWidgetToAnchorChanged=function(){this.setDirty()},i._adjustTargetToParentChanged=function(e){e&&this._unregisterOldParentEvents(e),this.node.getParent()&&this._registerTargetEvents()},i._registerEvent=function(){this.node.on(Ot.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(Ot.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._unregisterEvent=function(){this.node.off(Ot.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},i._removeParentEvent=function(){this.node.off(Ot.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._autoChangedValue=function(e,t){if((this._alignFlags&e)>0){var i=this.node.parent&&this.node.parent._uiProps,r=i&&i.uiTransformComp,n=r?r.contentSize:It;this.isAlignLeft&&e===Qc.LEFT?this._left=t?this._left*n.width:this._left/n.width:this.isAlignRight&&e===Qc.RIGHT?this._right=t?this._right*n.width:this._right/n.width:this.isAlignHorizontalCenter&&e===Qc.CENTER?this._horizontalCenter=t?this._horizontalCenter*n.width:this._horizontalCenter/n.width:this.isAlignTop&&e===Qc.TOP?this._top=t?this._top*n.height:this._top/n.height:this.isAlignBottom&&e===Qc.BOT?this._bottom=t?this._bottom*n.height:this._bottom/n.height:this.isAbsoluteVerticalCenter&&e===Qc.MID&&(this._verticalCenter=this._verticalCenter/n.height),this._recursiveDirty()}},i._registerTargetEvents=function(){var e=this._target||this.node.parent;e&&e.getComponent(Rt)&&(e.on(Ot.TRANSFORM_CHANGED,this._targetChangedOperation,this),e.on(Ot.SIZE_CHANGED,this._targetChangedOperation,this))},i._unregisterTargetEvents=function(){var e=this._target||this.node.parent;e&&(e.off(Ot.TRANSFORM_CHANGED,this._targetChangedOperation,this),e.off(Ot.SIZE_CHANGED,this._targetChangedOperation,this))},i._unregisterOldParentEvents=function(e){var t=this._target||e;t&&(t.off(Ot.TRANSFORM_CHANGED,this._targetChangedOperation,this),t.off(Ot.SIZE_CHANGED,this._targetChangedOperation,this))},i._targetChangedOperation=function(){this.alignMode===Kc.ALWAYS&&this._recursiveDirty()},i._setAlign=function(e,t){if(t!==(this._alignFlags&e)>0){var i=(e&Dh)>0,r=this.node._uiProps.uiTransformComp;t?(this._alignFlags|=e,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=r.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=r.height))):(i?this.isStretchWidth&&(r.width=this._originalWidth):this.isStretchHeight&&(r.height=this._originalHeight),this._alignFlags&=~e)}},i._recursiveDirty=function(){this._dirty||(this._dirty=!0)},x(t,[{key:"target",get:function(){return this._target},set:function(e){this._target!==e&&(this._unregisterTargetEvents(),this._target=e,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&Qc.TOP)>0},set:function(e){this._setAlign(Qc.TOP,e),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&Qc.BOT)>0},set:function(e){this._setAlign(Qc.BOT,e),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&Qc.LEFT)>0},set:function(e){this._setAlign(Qc.LEFT,e),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&Qc.RIGHT)>0},set:function(e){this._setAlign(Qc.RIGHT,e),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&Qc.MID)>0},set:function(e){e?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=Qc.MID):this._alignFlags&=~Qc.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&Qc.CENTER)>0},set:function(e){e?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=Qc.CENTER):this._alignFlags&=~Qc.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&Dh)===Dh}},{key:"isStretchHeight",get:function(){return(this._alignFlags&Ch)===Ch}},{key:"top",get:function(){return this._top},set:function(e){this._top=e,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(e){this._top=this._isAbsTop?e:e/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(e){this._bottom=e,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(e){this._bottom=this._isAbsBottom?e:e/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(e){this._left=e,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(e){this._left=this._isAbsLeft?e:e/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(e){this._right=e,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(e){this._right=this._isAbsRight?e:e/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(e){this._horizontalCenter=e,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(e){this._horizontalCenter=this._isAbsHorizontalCenter?e:e/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(e){this._verticalCenter=e,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(e){this._verticalCenter=this._isAbsVerticalCenter?e:e/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(e){this._isAbsTop!==e&&(this._isAbsTop=e,this._autoChangedValue(Qc.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(e){this._isAbsBottom!==e&&(this._isAbsBottom=e,this._autoChangedValue(Qc.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(e){this._isAbsLeft!==e&&(this._isAbsLeft=e,this._autoChangedValue(Qc.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(e){this._isAbsRight!==e&&(this._isAbsRight=e,this._autoChangedValue(Qc.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(e){this._isAbsHorizontalCenter!==e&&(this._isAbsHorizontalCenter=e,this._autoChangedValue(Qc.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(e){this._isAbsVerticalCenter!==e&&(this._isAbsVerticalCenter=e,this._autoChangedValue(Qc.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(e){this._alignMode=e,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(e){this._alignFlags!==e&&(this._alignFlags=e,this._recursiveDirty())}}]),t}(l),Zc.AlignMode=Kc,s((Rc=$c).prototype,"target",[vc,mc],Object.getOwnPropertyDescriptor(Rc.prototype,"target"),Rc.prototype),s(Rc.prototype,"isAlignTop",[yc],Object.getOwnPropertyDescriptor(Rc.prototype,"isAlignTop"),Rc.prototype),s(Rc.prototype,"isAlignBottom",[bc],Object.getOwnPropertyDescriptor(Rc.prototype,"isAlignBottom"),Rc.prototype),s(Rc.prototype,"isAlignLeft",[wc],Object.getOwnPropertyDescriptor(Rc.prototype,"isAlignLeft"),Rc.prototype),s(Rc.prototype,"isAlignRight",[Ac],Object.getOwnPropertyDescriptor(Rc.prototype,"isAlignRight"),Rc.prototype),s(Rc.prototype,"isAlignVerticalCenter",[Tc],Object.getOwnPropertyDescriptor(Rc.prototype,"isAlignVerticalCenter"),Rc.prototype),s(Rc.prototype,"isAlignHorizontalCenter",[Ec],Object.getOwnPropertyDescriptor(Rc.prototype,"isAlignHorizontalCenter"),Rc.prototype),s(Rc.prototype,"isStretchWidth",[Sc],Object.getOwnPropertyDescriptor(Rc.prototype,"isStretchWidth"),Rc.prototype),s(Rc.prototype,"isStretchHeight",[Cc],Object.getOwnPropertyDescriptor(Rc.prototype,"isStretchHeight"),Rc.prototype),s(Rc.prototype,"editorTop",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"editorTop"),Rc.prototype),s(Rc.prototype,"editorBottom",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"editorBottom"),Rc.prototype),s(Rc.prototype,"editorLeft",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"editorLeft"),Rc.prototype),s(Rc.prototype,"editorRight",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"editorRight"),Rc.prototype),s(Rc.prototype,"editorHorizontalCenter",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"editorHorizontalCenter"),Rc.prototype),s(Rc.prototype,"editorVerticalCenter",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"editorVerticalCenter"),Rc.prototype),s(Rc.prototype,"isAbsoluteTop",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"isAbsoluteTop"),Rc.prototype),s(Rc.prototype,"isAbsoluteBottom",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"isAbsoluteBottom"),Rc.prototype),s(Rc.prototype,"isAbsoluteLeft",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"isAbsoluteLeft"),Rc.prototype),s(Rc.prototype,"isAbsoluteRight",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"isAbsoluteRight"),Rc.prototype),s(Rc.prototype,"isAbsoluteHorizontalCenter",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"isAbsoluteHorizontalCenter"),Rc.prototype),s(Rc.prototype,"isAbsoluteVerticalCenter",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"isAbsoluteVerticalCenter"),Rc.prototype),s(Rc.prototype,"alignMode",[Dc,Oc],Object.getOwnPropertyDescriptor(Rc.prototype,"alignMode"),Rc.prototype),s(Rc.prototype,"alignFlags",[p],Object.getOwnPropertyDescriptor(Rc.prototype,"alignFlags"),Rc.prototype),Pc=s(Rc.prototype,"_alignFlags",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kc=s(Rc.prototype,"_target",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fc=s(Rc.prototype,"_left",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xc=s(Rc.prototype,"_right",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nc=s(Rc.prototype,"_top",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mc=s(Rc.prototype,"_bottom",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lc=s(Rc.prototype,"_horizontalCenter",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bc=s(Rc.prototype,"_verticalCenter",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zc=s(Rc.prototype,"_isAbsLeft",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),jc=s(Rc.prototype,"_isAbsRight",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Hc=s(Rc.prototype,"_isAbsTop",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Uc=s(Rc.prototype,"_isAbsBottom",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Vc=s(Rc.prototype,"_isAbsHorizontalCenter",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Wc=s(Rc.prototype,"_isAbsVerticalCenter",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Gc=s(Rc.prototype,"_originalWidth",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yc=s(Rc.prototype,"_originalHeight",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qc=s(Rc.prototype,"_alignMode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kc.ON_WINDOW_RESIZE}}),Xc=s(Rc.prototype,"_lockFlags",[f,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ic=Rc))||Ic)||Ic)||Ic)||Ic)||Ic)||Ic));o.internal.computeInverseTransForTarget=ih,o.internal.getReadonlyNodeSize=th;var Ih,Rh=new S,Ph=U({SOLID_COLOR:dt.ALL,DEPTH_ONLY:dt.DEPTH_STENCIL,DONT_CLEAR:dt.NONE}),kh=U({OVERLAY:0,INTERSPERSE:1}),Fh=e("R",(rh=i("cc.Canvas"),nh=ie(),sh=Pt(100),oh=kt(Rt),ah=re(),uh=Y(Ph),ch=se(),hh=se(),lh=Y(kh),ph=se(),fh=se(),_h=Y(ot),dh=se(),gh=Y(Ph),vh=Y(kh),rh(mh=nh(mh=sh(mh=oh(mh=ah(mh=ee(mh=Ft((Sh=function(e){function t(){var t;return t=e.call(this)||this,c(t,"_priority",bh,h(t)),c(t,"_targetTexture",wh,h(t)),c(t,"_clearFlag",Ah,h(t)),c(t,"_color",Th,h(t)),c(t,"_renderMode",Eh,h(t)),t._thisOnCameraResized=void 0,t._fitDesignResolution=void 0,t._camera=null,t._pos=new S,t._thisOnCameraResized=t._onResizeCamera.bind(h(t)),t}r(t,e),x(t,[{key:"clearFlag",get:function(){return this._clearFlag},set:function(e){this._clearFlag=e,this._camera&&(this._camera.clearFlag=this._clearFlag)}},{key:"color",get:function(){return this._color},set:function(e){O.copy(this._color,e),this._camera&&(this._camera.clearColor=e)}},{key:"renderMode",get:function(){return this._renderMode},set:function(e){this._renderMode=e,this._camera&&(this._camera.priority=this._getViewPriority())}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=this._getViewPriority()),o.director.root&&o.director.root.ui&&o.director.root.ui.sortScreens()}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._checkTargetTextureEvent(t),this._updateTargetTexture()}}},{key:"visibility",get:function(){return this._camera?this._camera.view.visibility:-1}},{key:"camera",get:function(){return this._camera}}]);var i=t.prototype;return i.__preload=function(){var e=this.getComponent(Oh);e&&e.updateAlignment();var t=new Dt("UICamera_"+this.node.name);t.setPosition(0,0,1e3),this._camera=o.director.root.createCamera(),this._camera.initialize({name:"ui_"+this.node.name,node:t,projection:So.ProjectionType.ORTHO,priority:this._getViewPriority(),flows:["UIFlow"]}),this._camera.fov=45,this._camera.clearFlag=this.clearFlag,this._camera.farClip=2e3,this._camera.viewport=new R(0,0,1,1),this.color=this._color,this._checkTargetTextureEvent(null),this._updateTargetTexture(),this.node.on(Ot.TRANSFORM_CHANGED,this._thisOnCameraResized),o.director.root.ui.addScreen(this)},i.onEnable=function(){this._camera&&o.director.root.ui.renderScene.addCamera(this._camera)},i.onDisable=function(){this._camera&&o.director.root.ui.renderScene.removeCamera(this._camera)},i.onDestroy=function(){o.director.root.ui.removeScreen(this),this._camera&&o.director.root.destroyCamera(this._camera),this._targetTexture&&this._targetTexture.off("resize"),this.node.off(Ot.TRANSFORM_CHANGED,this._thisOnCameraResized)},i._onResizeCamera=function(){var e=this._camera;if(e){if(this._targetTexture){var t=this._targetTexture.window;e.setFixedSize(t.width,t.height),e.orthoHeight=It.height/2}else{var i=xt.canvas;e.resize(i.width,i.height),e.orthoHeight=xt.canvas.height/yt.getScaleY()/2}this.node.getWorldPosition(Rh),e.node.setPosition(Rh.x,Rh.y,1e3),e.update()}},i._checkTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},i._updateTargetTexture=function(){if(this._camera){var e=this._camera;if(this._targetTexture){var t=this._targetTexture.window;e.changeTargetWindow(t),e.orthoHeight=It.height/2,e.isWindowSize=!1}else e.changeTargetWindow(),e.orthoHeight=xt.canvas.height/yt.getScaleY()/2,e.isWindowSize=!0}},i._getViewPriority=function(){return this._renderMode===kh.OVERLAY?this._priority|1<<30:this._priority},t}(l),s((yh=Sh).prototype,"clearFlag",[uh,ch],Object.getOwnPropertyDescriptor(yh.prototype,"clearFlag"),yh.prototype),s(yh.prototype,"color",[hh],Object.getOwnPropertyDescriptor(yh.prototype,"color"),yh.prototype),s(yh.prototype,"renderMode",[lh,ph],Object.getOwnPropertyDescriptor(yh.prototype,"renderMode"),yh.prototype),s(yh.prototype,"priority",[fh],Object.getOwnPropertyDescriptor(yh.prototype,"priority"),yh.prototype),s(yh.prototype,"targetTexture",[_h,dh],Object.getOwnPropertyDescriptor(yh.prototype,"targetTexture"),yh.prototype),bh=s(yh.prototype,"_priority",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wh=s(yh.prototype,"_targetTexture",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ah=s(yh.prototype,"_clearFlag",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ph.DEPTH_ONLY}}),Th=s(yh.prototype,"_color",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0,255)}}),Eh=s(yh.prototype,"_renderMode",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kh.OVERLAY}}),mh=yh))||mh)||mh)||mh)||mh)||mh)||mh)||mh));o.Canvas=Fh;var xh,Nh=e("t",i("cc.UIComponent")(Ih=kt(Rt)(Ih=Pt(110)(Ih=Ft(Ih=ee(Ih=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this)._lastParent=null,t}r(t,e);var i=t.prototype;return i.__preload=function(){this.node._uiProps.uiComp=this},i.onEnable=function(){},i.onDisable=function(){},i.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},i.updateAssembler=function(){},i.postUpdateAssembler=function(){},t}(l))||Ih)||Ih)||Ih)||Ih)||Ih);!function(e){e[e.DISABLED=0]="DISABLED",e[e.CLEAR=1]="CLEAR",e[e.ENTER_LEVEL=2]="ENTER_LEVEL",e[e.ENABLED=3]="ENABLED",e[e.EXIT_LEVEL=4]="EXIT_LEVEL"}(xh||(xh=e("s",{})));var Mh,Lh,Bh,zh,jh,Hh,Uh,Vh,Wh,Gh,Yh,qh,Xh,Zh,$h,Jh,Kh,Qh,el,tl,il,rl,nl,sl,ol,al,ul,cl=e("V",function(){function e(){this.stage=xh.DISABLED,this.stageOld=xh.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Nt.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Mt.KEEP,zFailOp:Mt.KEEP,passOp:Mt.KEEP,ref:1}}var t=e.prototype;return t.pushMask=function(e){this._maskStack.push(e)},t.clear=function(){this.stage=xh.CLEAR},t.enterLevel=function(){this.stage=xh.ENTER_LEVEL},t.enableMask=function(){this.stage=xh.ENABLED},t.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=xh.DISABLED:this.stage=xh.ENABLED)},t.handleMaterial=function(e,t){if(this.stage!==this.stageOld){var i=this._stencilPattern;if(this.stage===xh.DISABLED)i.stencilTest=!1,i.func=Nt.ALWAYS,i.failOp=Mt.KEEP,i.stencilMask=i.writeMask=65535,i.ref=1;else if(i.stencilTest=!0,this.stage===xh.ENABLED)i.func=Nt.EQUAL,i.failOp=Mt.KEEP,i.stencilMask=i.ref=this.getStencilRef(),i.writeMask=this.getWriteMask();else if(this.stage===xh.CLEAR){var r=this._maskStack[this._maskStack.length-1];i.func=Nt.NEVER,i.failOp=r.inverted?Mt.REPLACE:Mt.ZERO,i.writeMask=i.stencilMask=i.ref=this.getWriteMask()}else if(this.stage===xh.ENTER_LEVEL){var n=this._maskStack[this._maskStack.length-1];i.func=Nt.NEVER,i.failOp=n.inverted?Mt.ZERO:Mt.REPLACE,i.writeMask=i.stencilMask=i.ref=this.getWriteMask()}this.stageOld=this.stage}return this._changed(e.passes[0],t)},t.applyStencil=function(e,t){e.overridePipelineStates({depthStencilState:{stencilTestFront:t.stencilTest,stencilFuncFront:t.func,stencilReadMaskFront:t.stencilMask,stencilWriteMaskFront:t.writeMask,stencilFailOpFront:t.failOp,stencilZFailOpFront:t.zFailOp,stencilPassOpFront:t.passOp,stencilRefFront:t.ref,stencilTestBack:t.stencilTest,stencilFuncBack:t.func,stencilReadMaskBack:t.stencilMask,stencilWriteMaskBack:t.writeMask,stencilFailOpBack:t.failOp,stencilZFailOpBack:t.zFailOp,stencilPassOpBack:t.passOp,stencilRefBack:t.ref}})},t.getWriteMask=function(){return 1<<this._maskStack.length-1},t.getExitWriteMask=function(){return 1<<this._maskStack.length},t.getStencilRef=function(){for(var e=0,t=0;t<this._maskStack.length;++t)e+=1<<t;return e},t.reset=function(){this._maskStack.length=0,this.stage=xh.DISABLED},t._changed=function(e,t){if(t)return t.stencilStage!==this.stage&&(t.stencilStage=this.stage,!0);var i=e.depthStencilState,r=this._stencilPattern;return r.stencilTest!==i.stencilTestFront||r.func!==i.stencilFuncFront||r.failOp!==i.stencilFailOpFront||r.stencilMask!==i.stencilReadMaskFront||r.writeMask!==i.stencilWriteMaskFront||r.ref!==i.stencilRefFront},x(e,[{key:"pattern",get:function(){return this._stencilPattern}}]),e}());cl.sharedManager=null,cl.sharedManager=new cl,ve(Lt),function(e){e[e.ADD_COLOR=0]="ADD_COLOR",e[e.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",e[e.GRAYSCALE=2]="GRAYSCALE",e[e.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",e[e.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(ul||(ul=e("I",{})));var hl=e("U",(Mh=i("cc.UIRenderable"),Lh=kt(Rt),Bh=he(),zh=Y(Bt),jh=Y(Bt),Hh=ne(),Uh=me(),Vh=he(),Wh=Y(Lt),Gh=ne(),Yh=se(),qh=he(),Xh=Y(Lt),Zh=ne(),$h=se(),Jh=ne(),Kh=se(),Mh(Qh=Lh(Qh=Ft(Qh=ee((al=ol=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t=e.call.apply(e,[this].concat(r))||this,c(t,"_materials",tl,h(t)),c(t,"_customMaterial",il,h(t)),t.stencilStage=xh.DISABLED,c(t,"_srcBlendFactor",rl,h(t)),c(t,"_dstBlendFactor",nl,h(t)),c(t,"_color",sl,h(t)),t._assembler=null,t._postAssembler=null,t._renderData=null,t._renderDataFlag=!0,t._renderFlag=!0,t._delegateSrc=null,t._instanceMaterialType=ul.ADD_COLOR_AND_TEXTURE,t._blendTemplate={blendState:{targets:[{blendSrc:Lt.SRC_ALPHA,blendDst:Lt.ONE_MINUS_SRC_ALPHA}]}},t._lastParent=null,t._materialUniformHash=0,t}r(t,e);var i=t.prototype;return i.updateMaterial=function(){if(this._customMaterial)this.setMaterial(this._customMaterial,0);else{var e=this._updateBuiltinMaterial();this.setMaterial(e,0),this._updateBlendFunc()}},i.updateMaterialUniformHash=function(e,t){for(var i,r,n=e.passes,s="",o=!1,a=0;a<n.length;a++)if(i=n[a],t||i.rootBufferDirty){o=!0;for(var u=i.blocks,c=0;c<i.blocks.length;c++){r=u[c];for(var h=0;h<r.length;h++)s+=r[h]+","}}return o&&(this._materialUniformHash=rt(s,666)),this._materialUniformHash},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(Ot.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(Ot.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender(),this.updateMaterialUniformHash(this.getMaterial(0),!0)},i.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender(),this.updateMaterialUniformHash(this.getMaterial(0),!0)},i.onDisable=function(){this.node.off(Ot.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(Ot.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},i.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var e=0;e<this._materialInstances.length;e++)this._materialInstances[e].destroy();this._renderData=null},i.markForUpdateRenderData=function(e){if(void 0===e&&(e=!0),this._renderFlag=this._canRender(),e&&this._renderFlag){var t=this._renderData;t&&(t.vertDirty=!0),this._renderDataFlag=e}else e||(this._renderDataFlag=e)},i.requestRenderData=function(){var e=zt.add();return this._renderData=e,e},i.destroyRenderData=function(){this._renderData&&(zt.remove(this._renderData),this._renderData=null)},i.updateAssembler=function(e){this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(e))},i.postUpdateAssembler=function(e){this._renderFlag&&this._postRender(e)},i._render=function(){},i._postRender=function(){},i._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},i._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},i._postCanRender=function(){},i._updateColor=function(){this._assembler&&this._assembler.updateColor&&this._assembler.updateColor(this)},i._updateBlendFunc=function(){var e=this.getMaterial(0),t=this._blendTemplate.blendState.targets[0];if(e)return t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(e=this.material,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor,e.overridePipelineStates(this._blendTemplate,0)),e},i._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var e=0;e<this.node.children.length;++e){var i=this.node.children[e].getComponent(t);i&&i.markForUpdateRenderData()}},i._updateBuiltinMaterial=function(){var e;switch(this._instanceMaterialType){case ul.ADD_COLOR:e=jt.get("ui-base-material");break;case ul.GRAYSCALE:e=jt.get("ui-sprite-gray-material");break;case ul.USE_ALPHA_SEPARATED:e=jt.get("ui-sprite-alpha-sep-material");break;case ul.USE_ALPHA_SEPARATED_AND_GRAY:e=jt.get("ui-sprite-gray-alpha-sep-material");break;default:e=jt.get("ui-sprite-material")}return e},x(t,[{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var i=e.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(e.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(e){this._customMaterial=e,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&n(12001),this._srcBlendFactor},set:function(e){this._customMaterial?n(12001):this._srcBlendFactor!==e&&(this._srcBlendFactor=e,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&n(12001),this._dstBlendFactor},set:function(e){this._customMaterial?n(12001):this._dstBlendFactor!==e&&(this._dstBlendFactor=e,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(e){this._color.equals(e)||(this._color.set(e),this._updateColor(),this.markForUpdateRenderData())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(e){this._delegateSrc=e}},{key:"materialUniformHash",get:function(){return this._materialUniformHash}}]),t}(Ht),ol.BlendState=Lt,ol.Assembler=null,ol.PostAssembler=null,tl=s((el=al).prototype,"_materials",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),s(el.prototype,"sharedMaterials",[N,Bh],Object.getOwnPropertyDescriptor(el.prototype,"sharedMaterials"),el.prototype),il=s(el.prototype,"_customMaterial",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s(el.prototype,"customMaterial",[jh,Hh,Uh],Object.getOwnPropertyDescriptor(el.prototype,"customMaterial"),el.prototype),s(el.prototype,"srcBlendFactor",[Vh,Wh,Gh,Yh],Object.getOwnPropertyDescriptor(el.prototype,"srcBlendFactor"),el.prototype),s(el.prototype,"dstBlendFactor",[qh,Xh,Zh,$h],Object.getOwnPropertyDescriptor(el.prototype,"dstBlendFactor"),el.prototype),s(el.prototype,"color",[Jh,Kh],Object.getOwnPropertyDescriptor(el.prototype,"color"),el.prototype),rl=s(el.prototype,"_srcBlendFactor",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Lt.SRC_ALPHA}}),nl=s(el.prototype,"_dstBlendFactor",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Lt.ONE_MINUS_SRC_ALPHA}}),sl=s(el.prototype,"_color",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O.WHITE.clone()}}),Qh=el))||Qh)||Qh)||Qh)||Qh));$(Nh.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),o.UITransformComponent=Rt,ye.setClassAlias(Rt,"cc.UITransformComponent"),ye.setClassAlias(hl,"cc.RenderComponent"),o.CanvasComponent=Fh,ye.setClassAlias(Fh,"cc.CanvasComponent");var ll=e("q",[new Ut(Vt.ATTR_POSITION,Wt.RGB32F)]),pl=e("v",[new Ut(Vt.ATTR_POSITION,Wt.RGB32F),new Ut(Vt.ATTR_COLOR,Wt.RGBA32F)]),fl=e("w",[new Ut(Vt.ATTR_POSITION,Wt.RGB32F),new Ut(Vt.ATTR_TEX_COORD,Wt.RG32F),new Ut(Vt.ATTR_COLOR,Wt.RGBA32F)]),_l=e("Y",[new Ut(Vt.ATTR_POSITION,Wt.RGB32F),new Ut(Vt.ATTR_TEX_COORD,Wt.RG32F),new Ut(Vt.ATTR_COLOR,Wt.RGBA32F),new Ut(Vt.ATTR_COLOR2,Wt.RGBA32F)]);function dl(e){for(var t=0,i=0;i<e.length;i++){var r=e[i];t+=Gt[r.format].count}return t}function gl(e){for(var t=0,i=0;i<e.length;i++){var r=e[i];t+=Gt[r.format].size}return t}e("X",Object.freeze({__proto__:null,vfmt:ll,vfmtPosColor:pl,vfmtPosUvColor:fl,vfmtPosUvTwoColor:_l,getAttributeFormatBytes:dl,getAttributeStride:gl}));var vl=e("x",function(){function e(e){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=e}x(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}}]);var t=e.prototype;return t.initialize=function(e,t){this._outOfCallback=t;var i=dl(e);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var r=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new Yt(qt.VERTEX|qt.TRANSFER_DST,Xt.HOST|Xt.DEVICE,r,r)));var n=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new Yt(qt.INDEX|qt.TRANSFER_DST,Xt.HOST|Xt.DEVICE,n,n))),this._attributes=e,this._iaInfo=new Zt(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},t.request=function(e,t){void 0===e&&(e=4),void 0===t&&(t=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+e*this._vertexFormatBytes,r=this.indicesOffset+t;if(e+this.vertexOffset>65535)return this._batcher.autoMergeBatches(),this._outOfCallback&&this._outOfCallback.call(this._batcher,e,t),!1;var n=this.vData.byteLength,s=this.iData.length;if(i>n||r>s){for(;n<i||s<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=e,this.indicesOffset+=t,this.byteOffset=i,this._dirty=!0,!0},t.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},t.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var e=0;e<this._hInputAssemblers.length;e++)$t.free(this._hInputAssemblers[e]);this._hInputAssemblers.length=0},t.recordBatch=function(){var e=this.indicesOffset-this.indicesStart;if(!e)return Jt;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push($t.alloc(this._batcher.device,this._iaInfo));var t=this._hInputAssemblers[this._nextFreeIAHandle++],i=$t.get(t);return i.firstIndex=this.indicesStart,i.indexCount=e,t},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var e=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),t=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(e),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(t)}},t._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},t._reallocVData=function(e){var t;if(this.vData&&(t=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),t&&e)for(var i=new Uint8Array(this.vData.buffer),r=0,n=t.length;r<n;r++)i[r]=t[r]},t._reallocIData=function(e){var t=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),t&&e)for(var i=this.iData,r=0,n=t.length;r<n;r++)i[r]=t[r]},x(e,[{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),e}());vl.OPACITY_OFFSET=8,new P;var ml=function(e){function t(){var t;return(t=e.call(this)||this).type=ai.UI_BATCH,t}r(t,e);var i=t.prototype;return i.initialize=function(){e.prototype.initialize.call(this);var t=new yl;t.initialize(),this._subModels[0]=t;var i=Kt.get(this._handle,Qt.SUB_MODEL_ARRAY);ei.assign(i,0,t.handle)},i.updateTransform=function(){if(this.transform){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._transformUpdated=!0)}},i.updateUBOs=function(e){for(var t=this._subModels,i=0;i<t.length;i++)t[i].update();if(this._updateStamp=e,this._transformUpdated){if(this.transform){var r=this.transform._mat;P.toArray(this._localData,r,ti.MAT_WORLD_OFFSET),this._localBuffer.update(this._localData)}this._transformUpdated=!1}},i.directInitialize=function(e){this._subModels[0].directInitialize(e.material.passes,e.hInputAssembler,e.hDescriptorSet),e.useLocalData&&(this.node=this.transform=e.useLocalData,this._updateAttributesAndBinding(0))},t}(ii),yl=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var i=t.prototype;return i.initialize=function(){this._handle=ri.alloc(),ri.set(this._handle,ni.PRIORITY,si.DEFAULT)},i.directInitialize=function(e,t,i){this._passes=e,this._flushPassInfo(),ri.set(this._handle,ni.INPUT_ASSEMBLER,t),ri.set(this._handle,ni.DESCRIPTOR_SET,i),this._inputAssembler=$t.get(t),this._descriptorSet=oi.get(i)},i.destroy=function(){ri.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=si.DEFAULT,this._handle=Jt,this._patches=null,this._subMesh=null,this._passes=null},t}(ui),bl=e("y",function(){function e(){this.bufferBatch=null,this.camera=null,this.model=null,this.material=null,this.texture=null,this.sampler=null,this.hInputAssembler=Jt,this.hDescriptorSet=Jt,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0}var t=e.prototype;return t.destroy=function(){this.hDescriptorSet&&(this.hDescriptorSet=Jt)},t.clear=function(){this.bufferBatch=null,this.hInputAssembler=Jt,this.camera=null,this.material=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null},e}()),wl=function(){function e(){this._material=null,this._pass=null,this._hDescriptorSet=Jt,this._refCount=0}var t=e.prototype;return t.initialize=function(e){return!!e.material&&(this._material=new Bt,this._material.copy(e.material),this._pass=this._material.passes[0],this._pass.update(),this._hDescriptorSet=ci.get(this._pass.handle,hi.DESCRIPTOR_SET),!0)},t.increase=function(){return this._refCount++,this._refCount},t.decrease=function(){return this._refCount--,0===this._refCount&&this.destroy(),this._refCount},t.destroy=function(){this._material&&(this._material.destroy(),this._material=null),this._refCount=0},x(e,[{key:"material",get:function(){return this._material}},{key:"pass",get:function(){return this._pass}},{key:"hDescriptorSet",get:function(){return this._hDescriptorSet}}]),e}(),Al=be.os===be.OS_IOS&&be.isBrowser&&/(iPhone OS 1[4-9])|(Version\/1[4-9][\.\d]*)|(iOS 1[4-9])/.test(window.navigator.userAgent),Tl=new _i(null),El=function(){var e=t.prototype;function t(e){var t=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new we((function(){return new vl(t)}),128),this._drawBatchPool=void 0,this._scene=void 0,this._meshBuffers=new Map,this._meshBufferUseCount=new Map,this._uiMaterials=new Map,this._canvasMaterials=new Map,this._batches=void 0,this._uiModelPool=null,this._modelInUse=void 0,this._emptyMaterial=new Bt,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currCanvas=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0,this._parentOpacity=1,this._descriptorSetCacheMap=new Map,this._root=e,this.device=e.device,this._scene=this._root.createScene({name:"GUIScene"}),this._uiModelPool=new Ae((function(){var e=o.director.root.createModel(ml);return e.enabled=!0,e.visFlags|=gt.Enum.UI_3D,e}),2),this._modelInUse=new Te(10),this._batches=new Te(64),this._drawBatchPool=new Ae((function(){return new bl}),128)}return e.acquireBufferBatch=function(e){void 0===e&&(e=fl);var t=e===fl?36:gl(e);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===t||this._requireBufferBatch(e),this._currMeshBuffer},x(t,[{key:"renderScene",get:function(){return this._scene}},{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(e){e&&(this._currMeshBuffer=e)}},{key:"currStaticRoot",set:function(e){this._currStaticRoot=e}}]),e.initialize=function(){return!0},e.destroy=function(){for(var e=this,t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy();for(var i,r=L(this._meshBuffers.keys());!(i=r()).done;){var n=i.value,s=this._meshBuffers.get(n);s&&s.forEach((function(e){return e.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(t){t.destroy(e)})),this._uiModelPool&&this._uiModelPool.destroy((function(e){e.destroy()})),this._descriptorSetCacheMap&&this._destoryDescriptorSet(),this._meshBuffers.clear(),o.director.root.destroyScene(this._scene)},e.getRenderSceneGetter=function(){return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),"renderScene").get.bind(this)},e._getUIMaterial=function(e){if(this._uiMaterials.has(e.hash))return this._uiMaterials.get(e.hash);var t=new wl;return t.initialize({material:e}),this._uiMaterials.set(e.hash,t),t},e._removeUIMaterial=function(e){this._uiMaterials.has(e)&&0===this._uiMaterials.get(e).decrease()&&this._uiMaterials.delete(e)},e.addScreen=function(e){for(var t=this._screens,i=0;i<t.length;i++){var r=t[i];if(r.camera){var n=r.camera.view.visibility,s=this._canvasMaterials.get(n);if(s){for(var o=s.keys(),a=o.next();!a.done;)this._removeUIMaterial(a.value),a=o.next();s.clear()}}}this._screens.push(e),this._screens.sort(this._screenSort);for(var u=0;u<t.length;u++){var c=t[u];c.camera&&(c.camera.view.visibility=gt.BitMask.UI_2D|u+1,this._canvasMaterials.has(c.camera.view.visibility)||this._canvasMaterials.set(c.camera.view.visibility,new Map))}},e.getScreen=function(e){for(var t=this._screens,i=0;i<t.length;++i){var r=t[i];if(r.camera&&r.camera.view.visibility===e)return r}return null},e.removeScreen=function(e){var t=this,i=this._screens.indexOf(e);if(-1!==i){if(this._screens.splice(i,1),e.camera){for(var r=this._canvasMaterials.get(e.camera.view.visibility),n=r.keys(),s=n.next();!s.done;)this._removeUIMaterial(s.value),s=n.next();r.clear()}for(var o,a=i;a<this._screens.length;a++)(o=this._screens[a].camera)&&function(){var e=t._canvasMaterials.get(o.view.visibility);o.view.visibility=gt.BitMask.UI_2D|a+1;var i=t._canvasMaterials.get(o.view.visibility);e.forEach((function(e,t){i.set(t,e)})),e.clear()}()}},e.sortScreens=function(){this._screens.sort(this._screenSort)},e.update=function(){for(var e=this._screens,t=0;t<e.length;++t){var i=e[t];i.enabledInHierarchy&&(this._currCanvas=i,this._recursiveScreenNode(i.node))}for(var r=0,n=0;n<this._modelInUse.length;n++)this._scene.removeModel(this._modelInUse.get(n)),this._uiModelPool.free(this._modelInUse.get(n));if(this._modelInUse.clear(),this._batches.length)for(var s=0;s<this._batches.length;++s){var o=this._batches.array[s];if(o.model){var a=o.camera||this._scene.cameras[0];if(a){var u=a.view.visibility;o.model.visFlags=u,o.model.node.layer=u}for(var c=o.model.subModels,h=0;h<c.length;h++)c[h].priority=r++}else{var l=this._descriptorSetCacheMap.get(o.textureHash);if(l&&l.has(o.samplerHash))o.hDescriptorSet=l.get(o.samplerHash);else{this._initDescriptorSet(o);var p=oi.get(o.hDescriptorSet),f=li.SAMPLER_SPRITE;p.bindTexture(f,o.texture),p.bindSampler(f,o.sampler),p.update(),l?this._descriptorSetCacheMap.get(o.textureHash).set(o.samplerHash,o.hDescriptorSet):this._descriptorSetCacheMap.set(o.textureHash,new Map([[o.samplerHash,o.hDescriptorSet]]))}var _=this._uiModelPool.alloc();if(_.directInitialize(o),this._scene.addModel(_),_.subModels[0].priority=r++,o.camera){var d=o.camera.view.visibility;_.visFlags=d,null==this._canvasMaterials.get(d).get(o.material.hash)&&this._canvasMaterials.get(d).set(o.material.hash,1)}this._modelInUse.push(_)}}},e.uploadBuffers=function(){if(this._batches.length>0)for(var e,t=this._meshBuffers,i=L(t.keys());!(e=i()).done;){var r=e.value,n=t.get(r);n&&n.forEach((function(e){e.uploadBuffers(),e.reset()}))}for(var s=0;s<this._batches.length;++s){var o=this._batches.array[s];o.isStatic||(o.clear(),this._drawBatchPool.free(o))}this._parentOpacity=1,this._batches.clear(),this._currMaterial=this._emptyMaterial,this._currCanvas=null,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._meshBufferUseCount.clear(),this._currMaterialHash=0,this._currMaterialUniformHash=0,cl.sharedManager.reset()},e.commitComp=function(e,t,i,r){var n,s,o=e,a=0,u=0;t?(n=t.getGFXTexture(),s=t.getGFXSampler(),a=t.getHash(),u=t.getSamplerHash()):(n=null,s=null);var c=o.getRenderMaterial(0),h=c.hash,l=o.updateMaterialUniformHash(c);this._currMaterialHash===h&&this._currMaterialUniformHash===l&&this._currTextureHash===a&&this._currSamplerHash===u&&this._currTransform===r||(this.autoMergeBatches(this._currComponent),this._currComponent=o,this._currTransform=r,this._currMaterial=c,this._currTexture=n,this._currSampler=s,this._currTextureHash=a,this._currSamplerHash=u,this._currMaterialHash=o.getRenderMaterial(0).hash,this._currMaterialUniformHash=o.materialUniformHash),i&&(i.fillBuffers(o,this),this._applyOpacity(o))},e.commitModel=function(e,t,i){if(this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent),i){var r;if(r=e instanceof hl?cl.sharedManager.handleMaterial(i,e):cl.sharedManager.handleMaterial(i)){var n=cl.sharedManager.pattern;cl.sharedManager.applyStencil(i,n)}if(r&&t)for(var s=0;s<t.subModels.length;s++)t.setSubModelMaterial(s,i)}var o=this._currCanvas,a=this._drawBatchPool.alloc();a.camera=o&&o.camera,a.model=t,a.bufferBatch=null,a.material=i,a.texture=null,a.sampler=null,a.useLocalData=null,this._currMaterial=this._emptyMaterial,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0,this._batches.push(a)},e.commitStaticBatch=function(e){this._batches.concat(e.drawBatchList),this.finishMergeBatches()},e.autoMergeBatches=function(e){var t=this.currBufferBatch,i=this._currCanvas,r=null==t?void 0:t.recordBatch(),n=this._currMaterial;if(r&&n){if(e){if(cl.sharedManager.handleMaterial(n,e)){this._currMaterial=n=e.material;var s=cl.sharedManager.pattern;cl.sharedManager.applyStencil(n,s)}e.updateMaterialUniformHash(n)}var o=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();o.camera=i&&i.camera,o.bufferBatch=t,o.material=n,o.texture=this._currTexture,o.sampler=this._currSampler,o.hInputAssembler=r,o.useLocalData=this._currTransform,o.textureHash=this._currTextureHash,o.samplerHash=this._currSamplerHash,this._batches.push(o),t.vertexStart=t.vertexOffset,t.indicesStart=t.indicesOffset,t.byteStart=t.byteOffset,Al&&(this._currMeshBuffer=null)}},e.forceMergeBatches=function(e,t,i){this._currMaterial=e,t?(this._currTexture=t.getGFXTexture(),this._currSampler=t.getGFXSampler(),this._currTextureHash=t.getHash(),this._currSamplerHash=t.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this.autoMergeBatches(i)},e.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0},e.flushMaterial=function(e){this._currMaterial=e},e._destroyUIMaterials=function(){for(var e=this._uiMaterials.values(),t=e.next();!t.done;)t.value.destroy(),t=e.next();this._uiMaterials.clear()},e.walk=function(e,t){void 0===t&&(t=0);var i=e.children.length,r=this._parentOpacity;if(this._parentOpacity*=e._uiProps.opacity,this._preprocess(e),i>0&&!e._static)for(var n=e.children,s=0;s<n.length;++s){var o=n[s];this.walk(o,t)}this._postprocess(e),this._parentOpacity=r,t+=1},e._preprocess=function(e){if(e._uiProps.uiTransformComp){e._uiProps.uiTransformComp._canvas=this._currCanvas;var t=e._uiProps.uiComp;t&&t.enabledInHierarchy&&t.updateAssembler(this)}},e._postprocess=function(e){var t=e._uiProps.uiComp;t&&t.enabledInHierarchy&&t.postUpdateAssembler(this)},e._recursiveScreenNode=function(e){this.walk(e),this.autoMergeBatches(this._currComponent)},e._createMeshBuffer=function(e){var t=this._bufferBatchPool.add();t.initialize(e,this._requireBufferBatch.bind(this,e));var i=gl(e),r=this._meshBuffers.get(i);return r||(r=[],this._meshBuffers.set(i,r)),r.push(t),t},e._requireBufferBatch=function(e){var t=gl(e),i=this._meshBuffers.get(t);i||(i=[],this._meshBuffers.set(t,i));var r=this._meshBufferUseCount.get(t)||0;r>=i.length?this._currMeshBuffer=this._createMeshBuffer(e):this._currMeshBuffer=i[r],this._meshBufferUseCount.set(t,r+1),2===arguments.length&&this._currMeshBuffer.request(arguments[0],arguments[1])},e._screenSort=function(e,t){var i=e.priority-t.priority;return 0===i?e.node.getSiblingIndex()-t.node.getSiblingIndex():i},e._applyOpacity=function(e){for(var t=e.color.a/255,i=this._parentOpacity*=t,r=this.currBufferBatch,n=r.byteOffset>>2,s=r.vData,o=r.lastByteOffset>>2,a=r.vertexFormatBytes/4,u=o;u<n;u+=a)s[u+vl.OPACITY_OFFSET]*=i;r.lastByteOffset=r.byteOffset},e._initDescriptorSet=function(e){var t=o.director.root,i=pi.get("sprite").shaders[0].name;Tl.layout=fi.getDescriptorSetLayout(t.device,i,!0),e.hDescriptorSet=oi.alloc(t.device,Tl)},e._releaseDescriptorSetCache=function(e){this._descriptorSetCacheMap.has(e)&&(this._descriptorSetCacheMap.get(e).forEach((function(e){oi.free(e)})),this._descriptorSetCacheMap.delete(e))},e._destoryDescriptorSet=function(){this._descriptorSetCacheMap.forEach((function(e){e.forEach((function(e){oi.free(e)}))})),this._descriptorSetCacheMap.clear()},t}(),Sl=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=Jt}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}},x(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return bi.get(di.get(this._poolHandle,yi.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===di.get(this._poolHandle,yi.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===di.get(this._poolHandle,yi.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}}]);var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=di.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=t.renderPassInfo,r=i.colorAttachments,n=i.depthStencilAttachment,s=0;s<r.length;s++)r[s].format===Wt.UNKNOWN&&(r[s].format=e.colorFormat);n&&n.format===Wt.UNKNOWN&&(n.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var o=0;o<r.length;o++){var a=null;this._swapchainBufferIndices&1<<o?di.set(this._poolHandle,yi.HAS_ON_SCREEN_ATTACHMENTS,1):(a=e.createTexture(new gi(vi.TEX2D,mi.COLOR_ATTACHMENT|mi.SAMPLED,r[o].format,this._width,this._height)),di.set(this._poolHandle,yi.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(a)}n&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new gi(vi.TEX2D,mi.DEPTH_STENCIL_ATTACHMENT|mi.SAMPLED,n.format,this._width,this._height)),di.set(this._poolHandle,yi.HAS_OFF_SCREEN_ATTACHMENTS,1)):di.set(this._poolHandle,yi.HAS_ON_SCREEN_ATTACHMENTS,1));var u=bi.alloc(e,new wi(this._renderPass,this._colorTextures,this._depthStencilTexture));return di.set(this._poolHandle,yi.FRAMEBUFFER,u),!0},t.destroy=function(){this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(bi.get(di.get(this._poolHandle,yi.FRAMEBUFFER)).destroy(),this._poolHandle=Jt)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),i=!0);for(var r=0;r<this._colorTextures.length;r++){var n=this._colorTextures[r];n&&(n.resize(e,t),i=!0)}var s=bi.get(di.get(this._poolHandle,yi.FRAMEBUFFER));i&&s&&(s.destroy(),s.initialize(new wi(this._renderPass,this._colorTextures,this._depthStencilTexture)))}},e}(),Cl=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._ui=null,this._dataPoolMgr=void 0,this._scenes=[],this._cameras=[],this._views=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=Jt,this._device=e,this._dataPoolMgr=new vo(e),Ai.registerCreateFunc(this),Sl.registerCreateFunc(this),this._cameraPool=new Ae((function(){return new Ti(t._device)}),4)}x(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(e){this._curWindow=e},get:function(){return this._curWindow}},{key:"tempWindow",set:function(e){this._tempWindow=e},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"ui",get:function(){return this._ui}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Ei.get(this._poolHandle,Ri.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Ei.get(this._poolHandle,Ri.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=Ei.alloc();var t=new Si,i=new Ci;i.depthStoreOp=Di.DISCARD,i.stencilStoreOp=Di.DISCARD;var r=new Oi([t],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:r,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(jt.initBuiltinRes(this._device)).then((function(){o.view.on("design-resolution-changed",(function(){var t=o.game.canvas.width,i=o.game.canvas.height;e.resize(t,i)}),e)}))},t.destroy=function(){this.clearCameras(),this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._ui&&(this._ui.destroy(),this._ui=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Ei.free(this._poolHandle),this._poolHandle=Jt)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var i,r=L(this._windows);!(i=r()).done;){var n=i.value;n.shouldSyncSizeWithSwapchain&&n.resize(e,t)}for(var s,o=L(this._cameras);!(s=o()).done;){var a=s.value;a.isWindowSize&&a.resize(e,t)}},t.setRenderPipeline=function(e){if(e||(e=this.createDefaultPipeline()),this._pipeline=e,!this._pipeline.activate())return!1;var t=o.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._ui&&(this._ui=new El(this),!this._ui.initialize())&&(this.destroy(),1))},t.createDefaultPipeline=function(){var e=new Ii;return e.initialize({flows:[]}),e},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._cameras.length;e++)this._cameras[e].view.onGlobalPipelineStateChanged();for(var t=0;t<this._scenes.length;t++)this._scenes[t].onGlobalPipelineStateChanged()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){Ei.set(this._poolHandle,Ri.CUMULATIVE_TIME,0)},t.frameMove=function(e){if(Ei.set(this._poolHandle,Ri.FRAME_TIME,e),++this._frameCount,Ei.set(this._poolHandle,Ri.CUMULATIVE_TIME,Ei.get(this._poolHandle,Ri.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0),this._ui&&this._ui.update(),this._pipeline){this._device.acquire(),this._views.length=0;var t=this._cameras,i=o.director.getTotalFrames();this._ui&&this._ui.uploadBuffers();for(var r=0;r<t.length;r++){var n=this._cameras[r],s=n.view;s.isEnable&&s.window&&(n.update(),n.scene.update(i),this._views.push(s))}this._pipeline.render(this._views),this._device.present()}},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=L(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=L(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createView=function(e){var t=new ki;return t.initialize(e),t},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortViews()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new Ae((function(){return new e}),10)),t=this._modelPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):console.warn("'"+e.constructor.name+"'is not in the model pool and cannot be destroyed by destroyModel.")},t.createCamera=function(){return this._cameraPool.alloc()},t.destroyCamera=function(e){this._cameraPool.free(e),e.destroy(),e.scene&&e.scene.removeCamera(e),e.isWindowSize=!0},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new Ae((function(){return new e}),4)),t=this._lightPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case Pi.SPHERE:e.scene.removeSphereLight(e);break;case Pi.SPOT:e.scene.removeSpotLight(e)}},t.sortViews=function(){this._cameras.sort((function(e,t){return e.view.priority-t.view.priority}))},e}();o.Root=Cl;var Dl=e("g",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new Yn,t._compScheduler=new ic,t._nodeActivator=new Jc,t._systems=[],o.game.once(xi.EVENT_RENDERER_INITED,t._initOnRendererInitialized,h(t)),t}r(t,e);var i=t.prototype;return i.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},i.convertToGL=function(e){var t=o.game.container,i=o.view,r=t.getBoundingClientRect(),n=r.left+window.pageXOffset-t.clientLeft,s=r.top+window.pageYOffset-t.clientTop,a=i._devicePixelRatio*(e.x-n),u=i._devicePixelRatio*(s+r.height-e.y);return i._isRotated?Ee(i._viewportRect.width-u,a):Ee(a,u)},i.convertToUI=function(e){var t=o.game.container,i=o.view,r=t.getBoundingClientRect(),n=r.left+window.pageXOffset-t.clientLeft,s=r.top+window.pageYOffset-t.clientTop,a=Ee(0,0);return i._isRotated?(a.x=n+e.y/i._devicePixelRatio,a.y=s+r.height-(i._viewportRect.width-e.x)/i._devicePixelRatio):(a.x=n+e.x*i._devicePixelRatio,a.y=s+r.height-e.y*i._devicePixelRatio),a},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return Se(o.winSize)},i.getWinSizeInPixels=function(){return Se(o.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){o.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Fi&&Fi.setEnabled(!1),o.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),o.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),Fi&&Fi.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(e,t,i){e instanceof $r&&(e=e.scene),J(e instanceof ju,1216),e._load();for(var r=Object.keys(o.game._persistRootNodes).map((function(e){return o.game._persistRootNodes[e]})),n=0;n<r.length;n++){var s=r[n];s.emit(o.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.getChildByUuid(s.uuid);if(a){var u=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(s,u)}else s.parent=e}var c=this._scene;o.isValid(c)&&c.destroy(),o.assetManager._releaseManager._autoRelease(c,e,r),this._scene=null,B._deferredDestroy(),t&&t(),this.emit(o.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,e),this.emit(o.Director.EVENT_AFTER_SCENE_LAUNCH,e)},i.runScene=function(e,t,i){var r=this;e instanceof $r&&(e=e.scene),J(e,1205),J(e instanceof ju,1216),e._load(),this.once(o.Director.EVENT_AFTER_DRAW,(function(){r.runSceneImmediate(e,t,i)}))},i.loadScene=function(e,t,i){var r=this;if(this._loadingScene)return n(1208,e,this._loadingScene),!1;var s=o.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));return s?(this.emit(o.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),s.loadScene(e,(function(n,s){console.timeEnd("LoadScene "+e),r._loadingScene="",n?(Ce(n),t&&t(n)):r.runSceneImmediate(s,i,t)})),!0):(k(1209,e),!1)},i.preloadScene=function(e,t,i){var r=o.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));if(r)r.preloadScene(e,null,t,i);else{var n='Can not preload the scene "'+e+'" because it is not in the build settings.';i&&i(new Error(n)),Ce("preloadScene: "+n)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||K(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(e){o.Camera.main&&(o.Camera.main.depth=!!e)},i.setClearColor=function(e){o.Camera.main&&(o.Camera.main.backgroundColor=e)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/o.game.getFrameRate()},i.setAnimationInterval=function(e){o.game.setFrameRate(Math.round(1e3/e))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(Yn.ID,e,200))},i.registerSystem=function(e,t,i){t.id=e,t.priority=i,t.init(),this._systems.push(t),this._systems.sort(jn.sortByPriority)},i.unregisterSystem=function(e){_e.fastRemove(this._systems,e),this._systems.sort(jn.sortByPriority)},i.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},i.getAnimationManager=function(){return this.getSystem(o.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var i=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var r=0;r<this._systems.length;++r)this._systems[r].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(t.EVENT_AFTER_UPDATE),B._deferredDestroy();for(var n=0;n<this._systems.length;++n)this._systems[n].postUpdate(i)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),Fi.frameUpdateListeners(),Dt.bookOfChange.clear(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,Fi&&Fi.setEnabled(!0),this.registerSystem(Yn.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},i._init=function(){return this._root=new Cl(o.game._gfxDevice),this._root.initialize({}).catch((function(e){return k(1217),Promise.reject(e)}))},x(t,[{key:"root",get:function(){return this._root}}]),t}(De));Dl.EVENT_INIT="director_init",Dl.EVENT_RESET="director_reset",Dl.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",Dl.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",Dl.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",Dl.EVENT_BEFORE_UPDATE="director_before_update",Dl.EVENT_AFTER_UPDATE="director_after_update",Dl.EVENT_BEFORE_DRAW="director_before_draw",Dl.EVENT_AFTER_DRAW="director_after_draw",Dl.EVENT_BEFORE_PHYSICS="director_before_physics",Dl.EVENT_AFTER_PHYSICS="director_after_physics",Dl.instance=void 0,o.Director=Dl;var Ol=e("h",Dl.instance=o.director=new Dl),Il=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Oe,this.scenes=new Oe,this.paths=new Oe}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,i=e.paths,r=e.types,n=e.deps,s=e.paths=Object.create(null);if(!1===e.debug){for(var o=0,a=t.length;o<a;o++)t[o]=Re(t[o]);for(var u in i){var c=i[u],h=c[1];c[1]=r[h]}}else{for(var l=Object.create(null),p=0,f=t.length;p<f;p++){var _=t[p];t[p]=l[_]=Re(_)}t=l}for(var d in i){var g=i[d];s[t[d]]=g}var v=e.scenes;for(var m in v){var y=v[m];v[m]=t[y]}var b=e.packs;for(var w in b)for(var A=b[w],T=0;T<A.length;++T)A[T]=t[A[T]];var E=e.versions;if(E)for(var S in E)for(var C=E[S],D=0;D<C.length;D+=2){var O=C[D];C[D]=t[O]||O}var I=e.redirect;if(I)for(var R=0;R<I.length;R+=2)I[R]=t[I[R]],I[R+1]=n[I[R+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=Ie(e);var i=this.paths.get(e);if(i){if(!t)return i[0];for(var r=0,n=i.length;r<n;r++){var s=i[r];if(ye.isChildClassOf(s.ctor,t))return s}}return null},t.getDirWithPath=function(e,t,i){"/"===(e=Ie(e))[e.length-1]&&(e=e.slice(0,-1));var r=i||[];return this.paths.forEach((function(i,n){if(n.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(n,e)||!e)for(var s=0,o=i.length;s<o;s++){var a=i[s];t&&!ye.isChildClassOf(a.ctor,t)||r.push(a)}})),r},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,i){return i.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,i=e.length;t<i;t++){var r=e[t];this.assetInfos.add(r,{uuid:r})}}},t._initPath=function(e){if(e){var t=this.paths;for(var i in t.clear(),e){var r=e[i],n=r[0],s=r[1],o=3===r.length,a=this.assetInfos.get(i);a.path=n,a.ctor=ye._getClassById(s),t.has(n)?o?t.get(n).push(a):t.get(n).splice(0,0,a):t.add(n,[a])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var i=this.assetInfos;for(var r in e){var n=e[r],s=i.get(n);s.url=r,t.add(r,s)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var i in e){var r=e[i],n={uuid:i,packedUuids:r,ext:".json"};t.add(i,n);for(var s=0,o=r.length;s<o;s++){var a=r[s],u=t.get(a),c=u.packs;c?1===o?c.splice(0,0,n):c.push(n):u.packs=[n]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,i=e.import;if(i)for(var r=0,n=i.length;r<n;r+=2){var s=i[r];t.get(s).ver=i[r+1]}if(i=e.native)for(var o=0,a=i.length;o<a;o+=2){var u=i[o];t.get(u).nativeVer=i[o+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,i=0,r=e.length;i<r;i+=2){var n=e[i];t.get(n).redirect=e[i+1]}},e}();function Rl(e,t){var i;i=Xi.safeFindClass;var r,n=er.pool.get();try{r=pr(e,n,{classFinder:i,customEnv:t})}catch(e){throw console.error(e),er.pool.put(n),e}r._uuid=t.__uuid__||"";for(var s=n.uuidList,o=n.uuidObjList,a=n.uuidPropList,u=[],c=0;c<s.length;c++){var h=s[c];u[c]={uuid:Re(h),owner:o[c],prop:a[c]}}return r.__depends__=u,r._native&&(r.__nativeDepend__=!0),er.pool.put(n),r}var Pl=new(function(){function e(){this._depends=new Oe}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?Object.assign({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),i=[];return this._descend(e,t,i),i},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var i,r,n=null;if(Array.isArray(t)||t.__type__){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(r=(i=t[5])[i.length-1])&&r<0)try{var s=Rl(t,{__uuid__:e});(n=this._parseDepsFromAsset(s)).nativeDep&&(n.nativeDep.uuid=e),Pe.add(e+"@import",s)}catch(t){ke.remove(e+"@import"),n={deps:[]}}else n={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(n=this._depends.get(e)).parsedFromExistAsset)return n;n=this._parseDepsFromAsset(t)}return this._depends.add(e,n),n},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:e.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:e.constructor.preventDeferredLoadDependents},i=e.__depends__,r=0,n=i.length;r<n;r++)t.deps.push(i[r].uuid);return e.__nativeDepend__&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=null;return(t=function(e){var t=e[1];return e[10].map((function(e){return t[e]}))}(e)).forEach((function(e,i){return t[i]=Re(e)})),t},t._descend=function(e,t,i){for(var r=this.getDeps(e),n=0;n<r.length;n++){var s=r[n];t[s]||(t[s]=!0,i.push(s),this._descend(s,t,i))}},e}());function kl(e,t){e._uuid&&t.push(e._uuid)}function Fl(e,t){for(var i=Object.getOwnPropertyNames(e),r=0;r<i.length;r++){var n=i[r];if("node"!==n&&"__eventTargets"!==n){var s=e[n];if("object"==typeof s&&s)if(Array.isArray(s))for(var o=0;o<s.length;o++){var a=s[o];a instanceof M&&kl(a,t)}else if(s.constructor&&s.constructor!==Object)s instanceof M&&kl(s,t);else for(var u=Object.getOwnPropertyNames(s),c=0;c<u.length;c++){var h=s[u[c]];h instanceof M&&kl(h,t)}}}}function xl(e,t,i,r){i.push(e._uuid);for(var n=Pl.getDeps(e._uuid),s=0,o=n.length;s<o;s++){var a=Fe.get(n[s]);if(a){var u=a._uuid;u in t?t[u]+=r:t[u]=a.refCount+r,i.includes(u)||xl(a,t,i,r)}}}var Nl=[],Ml=new(function(){function e(){this._persistNodeDeps=new Oe,this._toDelete=new Oe,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];!function e(t,i){for(var r=0;r<t._components.length;r++)Fl(t._components[r],i);for(var n=0;n<t._children.length;n++)e(t._children[n],i)}(e,t);for(var i=0,r=t.length;i<r;i++){var n=Fe.get(t[i]);n&&n.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),i=0,r=t.length;i<r;i++){var n=Fe.get(t[i]);n&&n.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,i){for(var r=0,n=i.length;r<n;r++){for(var s,o,a=i[r],u=Pl._depends.get(t._id),c=this._persistNodeDeps.get(a.uuid),h=L(c);!(o=h()).done;){var l=o.value,p=Fe.get(l);p&&p.addRef()}u&&(u.persistDeps||(u.persistDeps=[]),(s=u.persistDeps).push.apply(s,c))}if(e){for(var f=Pl.getDeps(e._id),_=0,d=f.length;_<d;_++){var g=Fe.get(f[_]);g&&g.decRef(e.autoReleaseAssets)}var v=Pl._depends.get(e._id);if(v&&v.persistDeps)for(var m=v.persistDeps,y=0,b=m.length;y<b;y++){var w=Fe.get(m[y]);w&&w.decRef(e.autoReleaseAssets)}Pl.remove(e._id)}},t.tryRelease=function(e,t){if(void 0===t&&(t=!1),e instanceof M){if(t)return this._free(e,t);this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,o.director.once(o.Director.EVENT_AFTER_DRAW,this._freeAssets,this))}},t.removeFromDeleteQueue=function(e){this._toDelete.remove(e._uuid)},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var i=e._uuid;if(this._toDelete.remove(i),ge(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,xl(e,t,Nl,-1),Nl.length=0,0!==t[e._uuid])return t[e._uuid];for(var i in t)0!==t[i]&&xl(Fe.get(i),t,Nl,1);return Nl.length=0,t[e._uuid]}(e)>0)){Fe.remove(i);for(var r=Pl.getDeps(i),n=0,s=r.length;n<s;n++){var o=Fe.get(r[n]);o&&(o.decRef(!1),this._free(o,!1))}e.destroy(),Pl.remove(i)}},e}()),Ll=null;function Bl(e,t){for(var i=0,r=e.input.length;i<r;i++){var n=e.input[i];t&&!n.isNative&&n.content instanceof M&&n.content.decRef(!1),n.recycle()}e.input=null}function zl(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function jl(e,t,i,r,n,s,o){try{var a=Pl.parse(e,t),u=!0;if(t instanceof M&&!t.__nativeDepend__&&(u=!1),n){for(var c=0,h=a.deps.length;c<h;c++){var l=a.deps[c];l in i||(i[l]=!0,r.push({uuid:l,bundle:o&&o.name}))}u&&a.nativeDep&&(o&&(a.nativeDep.bundle=o.name),r.push(Object.assign({},a.nativeDep)))}else{s=!Ne&&(!!t.asyncLoadAssets||s&&!a.preventDeferredLoadDependents);for(var p=0,f=a.deps.length;p<f;p++){var _=a.deps[p];_ in i||(i[_]=!0,r.push({uuid:_,__asyncLoadAssets__:s,bundle:o&&o.name}))}u&&!s&&!a.preventPreloadNativeObject&&a.nativeDep&&(o&&(a.nativeDep.bundle=o.name),r.push(Object.assign({},a.nativeDep)))}}catch(e){Ce(e.message,e.stack)}}function Hl(e,t,i){t&&(i=void 0!==i?i:o.assetManager.cacheAsset,!Me(t)&&i&&Fe.add(e,t))}function Ul(e,t,i){var r=!1,n=t.__depends__;if(n){for(var s=0,o=n.length;s<o;s++){var a=n[s],u=i[a.uuid+"@import"];u?a.owner[a.prop]=u.addRef():(Ce("The asset "+a.uuid+" is missing!"),r=!0)}t.__depends__=null}return t.__nativeDepend__&&(i[e+"@native"]?t._nativeAsset=i[e+"@native"]:r=!0,t.__nativeDepend__=!1),r}function Vl(e,t,i){var r=0,n=[];0===e.length&&i&&i(n);for(var s=function(s,o){t(e[s],(function(e){e&&n.push(e),++r===o&&i&&i(n)}))},o=0,a=e.length;o<a;o++)s(o,a)}function Wl(e,t,i){var r=e,n=t,s=i;if(void 0===i){var o="function"==typeof e;t?(s=t,o||(n=null)):void 0===t&&o&&(s=e,r=null,n=null),void 0!==t&&o&&(n=e,r=null)}return{options:r||Object.create(null),onProgress:n,onComplete:s}}function Gl(e,t,i){var r=e,n=t,s=i;if(void 0===i){var o=ye.isChildClassOf(e,M);t?(s=t,o&&(n=null)):void 0!==t||o||(s=e,n=null,r=null),void 0===t||o||(n=e,r=null)}return{type:r,onProgress:n||Ll,onComplete:s}}function Yl(e){return function(t,i){if(e){var r=[];Array.isArray(i)?i.forEach((function(e){return e instanceof M&&r.push(e.addRef())})):i instanceof M&&r.push(i.addRef()),xe((function(){r.forEach((function(e){return e.decRef(!1)})),e(t,i)}))}}}var ql=function(){function e(){this._config=new Il}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,i){return this._config.getDirWithPath(e,t,i)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),Le.add(e.name,this)},t.load=function(e,t,i,r){var n=Gl(t,i,r),s=n.type,a=n.onProgress,u=n.onComplete,c={__requestType__:Be.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(e)};o.assetManager.loadAny(e,c,a,u)},t.preload=function(e,t,i,r){var n=Gl(t,i,r),s=n.type,a=n.onProgress,u=n.onComplete;o.assetManager.preloadAny(e,{__requestType__:Be.PATH,type:s,bundle:this.name},a,u)},t.loadDir=function(e,t,i,r){var n=Gl(t,i,r),s=n.type,a=n.onProgress,u=n.onComplete;o.assetManager.loadAny(e,{__requestType__:Be.DIR,type:s,bundle:this.name,__outputAsArray__:!0},a,u)},t.preloadDir=function(e,t,i,r){var n=Gl(t,i,r),s=n.type,a=n.onProgress,u=n.onComplete;o.assetManager.preloadAny(e,{__requestType__:Be.DIR,type:s,bundle:this.name},a,u)},t.loadScene=function(e,t,i,r){var n=Wl(t,i,r),s=n.options,a=n.onProgress,u=n.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,o.assetManager.loadAny({scene:e},s,a,(function(e,t){if(e)Ce(e.message,e.stack),u&&u(e);else if(t instanceof $r&&t.scene){var i=t.scene;i._id=t._uuid,i.name=t.name,u&&u(null,t)}else u&&u(new Error("The asset "+t._uuid+" is not a scene"))}))},t.preloadScene=function(e,t,i,r){var n=Wl(t,i,r),s=n.options,a=n.onProgress,u=n.onComplete;s.bundle=this.name,o.assetManager.preloadAny({scene:e},s,a,(function(t){t&&k(1210,e,t.message),u&&u(t)}))},t.get=function(e,t){var i=this.getInfoWithPath(e,t);return i&&Fe.get(i.uuid)||null},t.release=function(e,t){var i=this.get(e,t);i&&Ml.tryRelease(i,!0)},t.releaseUnusedAssets=function(){var e=this;Fe.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&Ml.tryRelease(t)}))},t.releaseAll=function(){var e=this;Fe.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&Ml.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},x(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),Xl=e("r",new ql);o.resources=Xl;var Zl=be.__videoSupport,$l=Zl&&Zl.format;function Jl(e,t,i){if(!$l||0===$l.length)return i(new Error(T(7703)));var r=document.createElement("video"),n=document.createElement("source");r.appendChild(n);var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="blob",s.onload=function(){200===this.status||0===this.status?(n.src=URL.createObjectURL(this.response),i(null,r)):i(new Error(s.status+"(no response)"))},s.onerror=function(){var t="load video failure - "+e;ze(t),i(new Error(t))},s.send()}function Kl(e,t,i){var r=new Image;function n(){r.removeEventListener("load",n),r.removeEventListener("error",s),i&&i(null,r)}function s(){r.removeEventListener("load",n),r.removeEventListener("error",s),i&&i(new Error(T(4930,e)))}return"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.addEventListener("load",n),r.addEventListener("error",s),r.src=e,r}var Ql={};function ep(e,t,i){if(Ql[e])return i&&i(null),null;var r=document.createElement("script");function n(){r.parentNode.removeChild(r),r.removeEventListener("load",n,!1),r.removeEventListener("error",s,!1),Ql[e]=!0,i&&i(null)}function s(){r.parentNode.removeChild(r),r.removeEventListener("load",n,!1),r.removeEventListener("error",s,!1),i&&i(new Error(T(4928,e)))}return"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.async=t.scriptAsyncLoading||!1,r.src=e,r.addEventListener("load",n,!1),r.addEventListener("error",s,!1),document.body.appendChild(r),r}var tp,ip=null,rp=-1,np=Object.create(null),sp=[];function op(){for(var e=!0,t=Date.now(),i=sp.length-1;i>=0;i--){var r=sp[i],s=r.fontFamilyName;if(t-r.startTime>3e3)n(4933,s),r.onComplete(null,s),sp.splice(i,1);else{var o=r.refWidth,a="40px "+s;ip.font=a,o!==Ni(ip,"BES bswy:->@123",a)?(sp.splice(i,1),r.onComplete(null,s)):e=!1}}e&&(clearInterval(rp),rp=-1)}function ap(e,t,i){var r=function(e){var t=e.lastIndexOf(".ttf");if(-1===t)return e;var i,r=e.lastIndexOf("/");return-1!==(i=-1===r?e.substring(0,t)+"_LABEL":e.substring(r+1,t)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}(e);if(np[r])return i(null,r);if(!ip){var s=document.createElement("canvas");s.width=100,s.height=100,ip=s.getContext("2d")}var o=Ni(ip,"BES bswy:->@123","40px "+r),a=document.createElement("style");a.type="text/css";var u="";isNaN(Number(r))?u+="@font-face { font-family:"+r+"; src:":u+='@font-face { font-family:"'+r+'"; src:',u+='url("'+e+'");',a.textContent=u+"}",document.body.appendChild(a);var c=document.createElement("div"),h=c.style;if(h.fontFamily=r,c.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",document.body.appendChild(c),function(){if(void 0===tp)if("FontFace"in window){var e=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),t=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);tp=e?parseInt(e[1],10)>42:!t}else tp=!1;return tp}())!function(e,t,i){var r=new Promise((function(i,r){!function n(){Date.now()-e>=3e3?r():document.fonts.load("40px "+t).then((function(e){e.length>=1?i():setTimeout(n,100)}),(function(){r()}))}()})),s=null,o=new Promise((function(e,t){s=setTimeout(t,3e3)}));Promise.race([o,r]).then((function(){s&&(clearTimeout(s),s=null),i(null,t)}),(function(){n(4933,t),i(null,t)}))}(Date.now(),r,i);else{var l={fontFamilyName:r,refWidth:o,onComplete:i,startTime:Date.now()};sp.push(l),-1===rp&&(rp=setInterval(op,100))}np[r]=a}var up,cp,hp,lp,pp=/^\w+:\/\/.*/,fp=function(e,t,i){(be.capabilities.imageBitmap&&o.assetManager.allowImageBitmap?_p:Kl)(e,t,i)},_p=function(e,t,i){t.xhrResponseType="blob",ji(e,t,t.onFileProgress,i)},dp=function(e,t,i){t.xhrResponseType="json",ji(e,t,t.onFileProgress,i)},gp=function(e,t,i){t.xhrResponseType="arraybuffer",ji(e,t,t.onFileProgress,i)},vp=function(e,t,i){t.xhrResponseType="text",ji(e,t,t.onFileProgress,i)},mp=function(e,t,i){var r=je(e),n=e;pp.test(n)||(n=-1!==yp.remoteBundles.indexOf(r)?yp.remoteServerAddress+"remote/"+r:"assets/"+r);var s=t.version||yp.bundleVers[r],o=0,a=null,u=null;dp(n+"/config."+(s?s+".":"")+"json",t,(function(e,t){e&&(u=e),(a=t)&&(a.base=n+"/"),2==++o&&i(u,a)})),ep(n+"/index."+(s?s+".":"")+"js",t,(function(e){e?(u=e,2==++o&&i(e)):yp.importBundleEntry(r).then((function(){2==++o&&i(u,a)})).catch((function(e){u=e,2==++o&&i(u)}))}))},yp=new(function(){function e(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=Kl,this.downloadDomAudio=zi,this.downloadFile=ji,this.downloadScript=ep,this._downloaders={".png":fp,".jpg":fp,".bmp":fp,".jpeg":fp,".gif":fp,".ico":fp,".tiff":fp,".webp":fp,".image":fp,".pvr":gp,".pkm":gp,".astc":gp,".mp3":Hi,".ogg":Hi,".wav":Hi,".m4a":Hi,".txt":vp,".xml":vp,".vsh":vp,".fsh":vp,".atlas":vp,".tmx":vp,".tsx":vp,".json":dp,".ExportJson":dp,".plist":vp,".fnt":vp,".font":ap,".eot":ap,".ttf":ap,".woff":ap,".svg":ap,".ttc":ap,".mp4":Jl,".avi":Jl,".mov":Jl,".mpg":Jl,".mpeg":Jl,".rm":Jl,".rmvb":Jl,".binary":gp,".bin":gp,".dbbin":gp,".skel":gp,".js":ep,bundle:mp,default:vp},this._downloading=new Oe,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress=""}var i=e.prototype;return i.init=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=i},i.register=function(e,t){"object"==typeof e?j(this._downloaders,e):this._downloaders[e]=t},i.importBundleEntry=function(e){return t.import("virtual:///prerequisite-imports/"+e)},i.download=function(e,t,i,r,n){var s=this,o=ke.get(e);if(o)return n(null,o);var a=this._downloading.get(e);if(a){a.push(n);var u=this._queue.find((function(t){return t.id===e}));if(!u)return;var c=r.priority||0;u.priority<c&&(u.priority=c,this._queueDirty=!0)}else{var h=void 0!==r.maxRetryCount?r.maxRetryCount:this.maxRetryCount,l=void 0!==r.maxConcurrency?r.maxConcurrency:this.maxConcurrency,p=void 0!==r.maxRequestsPerFrame?r.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[i]||this._downloaders.default;!function e(t,i,r,n,s){void 0===s&&(s=0),t(s,(function(o,a){s++,!o||s>i?n&&n(o,a):setTimeout((function(){e(t,i,r,n,s)}),r)}))}((function(i,o){if(0===i&&s._downloading.add(e,[n]),!s.limited)return f(zl(t,s.appendTimeStamp),r,o);s._updateTime();var a=function(e,t){s._totalNum--,s._handleQueueInNextFrame(l,p),o(e,t)};s._totalNum<l&&s._totalNumThisPeriod<p?(f(zl(t,s.appendTimeStamp),r,a),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:e,priority:r.priority||0,url:t,options:r,done:a,handler:f}),s._queueDirty=!0,s._totalNum<l&&s._handleQueueInNextFrame(l,p))}),h,this.retryInterval,(function(t,i){t||ke.add(e,i);for(var r=s._downloading.remove(e),n=0,o=r.length;n<o;n++)r[n](t,i)}))}},i.loadSubpackage=function(e,t){o.assetManager.loadBundle(e,null,t)},i._updateTime=function(){var e=Date.now();e-this._lastDate>1e3*o.director.getDeltaTime()&&(this._totalNumThisPeriod=0,this._lastDate=e)},i._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(zl(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(e,t)},i._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(xe(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},x(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}()),bp=e("_",i("cc.VideoClip")((lp=function(e){function t(){var t;return t=e.call(this)||this,c(t,"_duration",hp,h(t)),t._video=null,t.loaded=!1,t}return r(t,e),x(t,[{key:"_nativeAsset",set:function(e){this._video=e,e?(this._duration=e.duration,this.loaded=!0):(this._duration=0,this.loaded=!1)},get:function(){return this._video}}]),t}(M),hp=s((cp=lp).prototype,"_duration",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),up=cp))||up);function wp(e,t,i,r){var n=null,s=null;try{(n=new Mi)._nativeUrl=e,n._nativeAsset=t}catch(e){s=e}r(s,n)}function Ap(e,t,i,r){var n=new Ui;n._nativeUrl=e,n._nativeAsset=t,n._duration=t.duration,r(null,n)}function Tp(e,t,i,r){var n=new cn;n.json=t,r(null,n)}function Ep(e,t,i,r){var n=new an;n.text=t,r(null,n)}function Sp(e,t,i,r){var n=new En;n._nativeUrl=e,n._nativeAsset=t,r(null,n)}function Cp(e,t,i,r){var n=new mr;n._nativeUrl=e,n._nativeAsset=t,r(null,n)}function Dp(e,t,i,r){var n=new M;n._nativeUrl=e,n._nativeAsset=t,r(null,n)}function Op(e,t,i,r){var n=Le.get(t.name);n||(n=t.name===He.RESOURCES?Xl:new ql,t.base=t.base||e+"/",n.init(t)),r(null,n)}function Ip(e,t,i,r){var n=new bp;n._nativeUrl=e,n._nativeAsset=t,r(null,n)}var Rp=new(function(){function e(){this._creating=new Oe,this._producers={".png":wp,".jpg":wp,".bmp":wp,".jpeg":wp,".gif":wp,".ico":wp,".tiff":wp,".webp":wp,".image":wp,".pvr":wp,".pkm":wp,".mp3":Ap,".ogg":Ap,".wav":Ap,".m4a":Ap,".mp4":Ip,".avi":Ip,".mov":Ip,".mpg":Ip,".mpeg":Ip,".rm":Ip,".rmvb":Ip,".txt":Ep,".xml":Ep,".vsh":Ep,".fsh":Ep,".atlas":Ep,".tmx":Ep,".tsx":Ep,".fnt":Ep,".json":Tp,".ExportJson":Tp,".font":Sp,".eot":Sp,".ttf":Sp,".woff":Sp,".svg":Sp,".ttc":Sp,".binary":Cp,".bin":Cp,".dbbin":Cp,".skel":Cp,bundle:Op,default:Dp}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?ye.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,i,r,n){var s=this,o=this._producers[i]||this._producers.default,a=Fe.get(e);if(r.reloadAsset||!a){var u=this._creating.get(e);u?u.push(n):(this._creating.add(e,[n]),o(e,t,r,(function(t,i){!t&&i instanceof M&&(i._uuid=e,Hl(e,i,r.cacheAsset));for(var n=s._creating.remove(e),o=0,a=n.length;o<a;o++)n[o](t,i)})))}else n(null,a)},e}()),Pp=new(function(){function e(){this._loading=new Oe,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,r){var n=ye.createMap(!0),s=null;if(Array.isArray(t)){(t=function(e,t){if(e[0]<1)throw new Error(T(5304,e[0]));hr(e,!0,t),lr(e);for(var i=new gr(e[0]),r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=0;u<a.length;++u)a[u].unshift(i,r,n,s,o);return a}(t,Xi.safeFindClass)).length!==e.length&&k(4915);for(var o=0;o<e.length;o++)n[e[o]+"@import"]=t[o]}else{var a=ye._getClassId(Li);if(t.type===a&&t.data){var u=t.data;u.length!==e.length&&k(4915);for(var c=0;c<e.length;c++)n[e[c]+"@import"]=vr(a,{base:u[c][0],mipmaps:u[c][1]},!0)}else s=new Error("unmatched type pack!"),n=null}r(s,n)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?ye.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,r,n){t?(0,this._unpackers[i])(e,t,r,n):n(new Error("package data is wrong!"))},t.load=function(e,t,i){var r=this;if(e.isNative||!e.info||!e.info.packs)return yp.download(e.id,e.url,e.ext,e.options,i);if(ke.has(e.id))return i(null,ke.get(e.id));var n=e.info.packs,s=n.find((function(e){return r._loading.has(e.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:e.id});else{s=n[0],this._loading.add(s.uuid,[{onComplete:i,id:e.id}]);var o=Ue(s.uuid,{ext:s.ext,bundle:e.config.name});yp.download(s.uuid,o,s.ext,e.options,(function(t,i){ke.remove(s.uuid),t&&Ce(t.message,t.stack),r.unpack(s.packedUuids,i,s.ext,e.options,(function(e,i){if(!e)for(var n in i)ke.add(n,i[n]);for(var o=r._loading.remove(s.uuid),a=0,u=o.length;a<u;a++){var c=o[a];if(t||e)c.onComplete(t||e);else{var h=i[c.id];h?c.onComplete(null,h):c.onComplete(new Error("can not retrieve data from package"))}}}))}))}},e}());function kp(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var r=e.options,n=e.progress,s=[],a=n.total;r.__exclude__=r.__exclude__||Object.create(null),e.output=[],Vl(e.input,(function(r,u){if(!r.isNative&&Fe.has(r.uuid)){var c=Fe.get(r.uuid);return c.addRef(),xp(r,e,c,null,c.__asyncLoadAssets__,s,a),u()}Pp.load(r,e.options,(function(c,h){c?e.isFinish||(!o.assetManager.force||i?(Ce(c.message,c.stack),n.canInvoke=!1,t(c)):xp(r,e,null,null,!1,s,a)):e.isFinish||xp(r,e,null,h,!r.isNative,s,a),u()}))}),(function(){if(e.isFinish)return Bl(e,!0),e.dispatch("error");if(s.length>0){var o=Ve.create({input:s,progress:n,options:r,onProgress:e.onProgress,onError:Ve.prototype.recycle,onComplete:function(r){var n;r||((n=e.output).push.apply(n,o.output),o.recycle()),i&&Fp(e),t(r)}});We.async(o)}else i&&Fp(e),t()}))}function Fp(e){for(var t=e.output,i=0,r=t.length;i<r;i++)t[i].content&&t[i].content.decRef(!1)}function xp(e,t,i,r,n,s,o){var a=t.options.__exclude__,u=t.progress;e.content=i,e.file=r,t.output.push(e),n&&(a[e.uuid]=!0,jl(e.uuid,r||i,a,s,!0,!1,e.config),u.total=o+s.length),u.canInvoke&&t.dispatch("progress",++u.finish,u.total,e)}var Np=new(function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return n(5100),{};for(var i=null,r=0,s=t.childNodes.length;r<s&&1!==(i=t.childNodes[r]).nodeType;r++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var r=0;r<e.childNodes.length;r++)t+=e.childNodes[r].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];1===n.nodeType&&t.push(this._parseNode(n))}return t},i._parseDict=function(e){for(var t={},i="",r=0,n=e.childNodes.length;r<n;r++){var s=e.childNodes[r];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:t[i]=this._parseNode(s))}return t},t}(e("Z",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){var t;return this._parser&&(t=this._parser.parseFromString(e,"text/xml")),t},e}())));function Mp(e,t){return e[t]<<8|e[t+1]}var Lp=new(function(){function e(){this._parsing=new Oe,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parseAudio=function(e,t,i){e instanceof ArrayBuffer?be.__audioSupport.context.decodeAudioData(e,(function(e){i(null,e)}),(function(e){i(new Error("Error with decoding audio data"+e.err),null)})):i(null,e)},t.parsePVRTex=function(e,t,i){var r=null,n=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,o=new Int32Array(s,0,13);if(55727696===o[0]){var a=o[7],u=o[6],c=o[12]+52;n={_data:new Uint8Array(s,c),_compressed:!0,width:a,height:u,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var h=o[0],l=o[1],p=o[2];n={_data:new Uint8Array(s,h),_compressed:!0,width:p,height:l,format:0}}}catch(e){r=e}i(r,n)},t.parsePKMTex=function(e,t,i){var r=null,n=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,o=new Uint8Array(s),a=Mp(o,6);if(0!==a&&1!==a&&3!==a)throw new Error("Invalid magic number in ETC header");var u=Mp(o,12),c=Mp(o,14);Mp(o,8),Mp(o,10),n={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:c,format:0}}catch(e){r=e}i(r,n)},t.parseASTCTex=function(e,t,i){var r=null,n=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,o=new Uint8Array(s);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var a=o[4],u=o[5],c=o[6];if((a<3||a>6||u<3||u>6||c<3||c>6)&&(a<4||7===a||9===a||11===a||a>12||u<4||7===u||9===u||11===u||u>12||1!==c))throw new Error("Invalid block number in ASTC header");var h=function(e,t){return 4===e?Bi.RGBA_ASTC_4x4:5===e?4===t?Bi.RGBA_ASTC_5x4:Bi.RGBA_ASTC_5x5:6===e?5===t?Bi.RGBA_ASTC_6x5:Bi.RGBA_ASTC_6x6:8===e?5===t?Bi.RGBA_ASTC_8x5:6===t?Bi.RGBA_ASTC_8x6:Bi.RGBA_ASTC_8x8:10===e?5===t?Bi.RGBA_ASTC_10x5:6===t?Bi.RGBA_ASTC_10x6:8===t?Bi.RGBA_ASTC_10x8:Bi.RGBA_ASTC_10x10:10===t?Bi.RGBA_ASTC_12x10:Bi.RGBA_ASTC_12x12}(a,u),l=o[7]+(o[8]<<8)+(o[9]<<16),p=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],n={_data:new Uint8Array(s,16),_compressed:!0,width:l,height:p,format:h}}catch(e){r=e}i(r,n)},t.parsePlist=function(e,t,i){var r=null,n=Np.parse(e);n||(r=new Error("parse failed")),i(r,n)},t.parseImport=function(e,t,i){if(e){var r=null,n=null;try{r=Rl(e,t)}catch(e){n=e}i(n,r)}else i(new Error("Json is empty"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?j(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,r,n){var s=this,o=Pe.get(e);if(o)n(null,o);else{var a=this._parsing.get(e);if(a)a.push(n);else{var u=this._parsers[i];u?(this._parsing.add(e,[n]),u(t,r,(function(t,i){t?ke.remove(e):Me(i)||Pe.add(e,i);for(var r=s._parsing.remove(e),n=0,o=r.length;n<o;n++)r[n](t,i)}))):n(null,t)}}},e}());function Bp(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var r=e.options,n=e.progress;r.__exclude__=r.__exclude__||Object.create(null),e.output=[],Vl(e.input,(function(s,a){var u=Ve.create({input:s,onProgress:e.onProgress,options:r,progress:n,onComplete:function(r,c){r&&!e.isFinish&&(!o.assetManager.force||i?(Ce(r.message,r.stack),n.canInvoke=!1,t(r)):n.canInvoke&&e.dispatch("progress",++n.finish,n.total,s)),e.output.push(c),u.recycle(),a(null)}});zp.async(u)}),(function(){if(r.__exclude__=null,e.isFinish)return Bl(e,!0),e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var i=e.output=[],r=0,n=t.length;r<n;r++)i.push(t[r].content);else e.output=t[0].content}(e),Bl(e,!0),t()}))}var zp=new Ge("loadOneAsset",[function(e,t){var i=e.output=e.input,r=i.options,n=i.isNative,s=i.uuid,o=i.file,a=r.reloadAsset;if(o||!a&&!n&&Fe.has(s))return t();Pp.load(i,e.options,(function(e,r){i.file=r,t(e)}))},function(e,t){var i=e.output=e.input,r=e.progress,n=e.options.__exclude__,s=i.id,o=i.file,a=i.options;if(i.isNative)Lp.parse(s,o,i.ext,a,(function(n,o){if(n)return t(n);i.content=o,r.canInvoke&&e.dispatch("progress",++r.finish,r.total,i),ke.remove(s),Pe.remove(s),t()}));else{var u=i.uuid;if(u in n){var c=n[u],h=c.finish,l=c.content,p=c.err,f=c.callbacks;r.canInvoke&&e.dispatch("progress",++r.finish,r.total,i),h||function e(t,i,r,n){if(void 0===n&&(n={}),!r[i]||n[i])return!1;n[i]=!0;var s=!1,o=Pl.getDeps(i);if(o)for(var a=0,u=o.length;a<u;a++){var c=o[a];if(c===t||e(t,c,r,n)){s=!0;break}}return s}(u,u,n)?(l&&l.addRef(),i.content=l,t(p)):f.push({done:t,item:i})}else if(!a.reloadAsset&&Fe.has(u)){var _=Fe.get(u);a.__asyncLoadAssets__||!_.__asyncLoadAssets__?(i.content=_.addRef(),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,i),t()):jp(e,_,t,!1)}else a.__uuid__=u,Lp.parse(s,o,"import",a,(function(i,r){if(i)return t(i);jp(e,r,t,!0)}))}}]);function jp(e,t,i,r){var n=e.input,s=e.progress,o=n,a=o.uuid,u=o.id,c=o.options,h=o.config,l=c.__asyncLoadAssets__,p=c.cacheAsset,f=[];t.addRef&&t.addRef(),jl(a,t,Object.create(null),f,!1,l,h),s.canInvoke&&e.dispatch("progress",++s.finish,s.total+=f.length,n);var _=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:i,item:n}]},d=Ve.create({input:f,options:e.options,onProgress:e.onProgress,onError:Ve.prototype.recycle,progress:s,onComplete:function(e){if(t.decRef&&t.decRef(!1),t.__asyncLoadAssets__=l,_.finish=!0,_.err=e,!e){for(var i,n=Array.isArray(d.output)?d.output:[d.output],s=Object.create(null),o=L(n);!(i=o()).done;){var c=i.value;c&&(s[c instanceof M?c._uuid+"@import":a+"@native"]=c)}if(r){if(!Ul(a,t,s))try{t.onLoaded&&t.onLoaded()}catch(e){Ce(e.message,e.stack)}ke.remove(u),Pe.remove(u),Hl(a,t,p)}else if(t.__nativeDepend__&&!Ul(a,t,s))try{t.onLoaded&&t.onLoaded()}catch(e){Ce(e.message,e.stack)}d.recycle()}for(var h=_.callbacks,f=0,g=h.length;f<g;f++){var v=h[f];t.addRef&&t.addRef(),v.item.content=t,v.done(e)}h.length=0}});Ye.async(d)}function Hp(e,t){var i=e.options,r=Object.create(null),n=Object.create(null);for(var s in i)switch(s){case Be.PATH:case Be.UUID:case Be.DIR:case Be.SCENE:case Be.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":r[s]=i[s];break;case"__exclude__":case"__outputAsArray__":n[s]=i[s];break;default:r[s]=i[s],n[s]=i[s]}e.options=n;var o=Ve.create({input:e.input,options:r}),a=null;try{e.output=e.source=qe.sync(o)}catch(e){a=e;for(var u=0,c=o.output.length;u<c;u++)o.output[u].recycle()}o.recycle(),t(a)}var Up=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},x(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();Up.MAX_DEAD_NUM=500,Up._deadPool=[];var Vp=[];function Wp(e){var t=e.input,i=e.options;t=Array.isArray(t)?t:[t],e.output=[];for(var r=0;r<t.length;r++){var n=t[r],s=Up.create(),o=null,a=null;if("string"==typeof n&&((n=Object.create(null))[i.__requestType__||Be.UUID]=t[r]),"object"==typeof n)for(var u in Xe(n,i),n.preset&&Xe(n,Ze[n.preset]),n)if(function(){switch(u){case Be.UUID:var e=s.uuid=Re(n.uuid);if(!n.bundle){var i=Le.find((function(t){return!!t.getAssetInfo(e)}));n.bundle=i&&i.name}if(Le.has(n.bundle)){if(o=Le.get(n.bundle).config,(a=o.getAssetInfo(e))&&a.redirect){if(!Le.has(a.redirect))throw new Error("Please load bundle "+a.redirect+" first");o=Le.get(a.redirect).config,a=o.getAssetInfo(e)}s.config=o,s.info=a}s.ext=n.ext||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Be.DIR:if(Le.has(n.bundle)){Le.get(n.bundle).config.getDirWithPath(n.dir,n.type,Vp);for(var r,c=L(Vp);!(r=c()).done;){var h=r.value;t.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:n.bundle})}Vp.length=0}s.recycle(),s=null;break;case Be.PATH:if(Le.has(n.bundle)){if(o=Le.get(n.bundle).config,(a=o.getInfoWithPath(n.path,n.type))&&a.redirect){if(!Le.has(a.redirect))throw new Error("you need to load bundle "+a.redirect+" first");o=Le.get(a.redirect).config,a=o.getAssetInfo(a.uuid)}if(!a)throw s.recycle(),new Error("Bundle "+n.bundle+" doesn't contain "+n.path);s.config=o,s.uuid=a.uuid,s.info=a}s.ext=n.ext||".json";break;case Be.SCENE:if(!n.bundle){var l=Le.find((function(t){return!!t.getAssetInfo(e)}));n.bundle=l&&l.name}if(Le.has(n.bundle)){if(o=Le.get(n.bundle).config,(a=o.getSceneInfo(n.scene))&&a.redirect){if(!Le.has(a.redirect))throw new Error("you need to load bundle "+a.redirect+" first");o=Le.get(a.redirect).config,a=o.getAssetInfo(a.uuid)}if(!a)throw s.recycle(),new Error("Bundle "+o.name+" doesn't contain scene "+n.scene);s.config=o,s.uuid=a.uuid,s.info=a}break;case"__isNative__":s.isNative=n.__isNative__;break;case Be.URL:s.url=n.url,s.uuid=n.uuid||n.url,s.ext=n.ext||G(n.url),s.isNative=void 0===n.__isNative__||n.__isNative__;break;default:s.options[u]=n[u]}}(),!s)break;if(s&&(e.output.push(s),!s.uuid&&!s.url))throw new Error("Can not parse this input:"+JSON.stringify(n))}return null}function Gp(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var r=t[i];if(!r.url){var n,s,a=r.config;s=r.isNative?a&&a.nativeBase?a.base+a.nativeBase:o.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:o.assetManager.generalImportBase;var u=r.uuid,c="";r.info&&(c=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),n=".ttf"===r.ext?s+"/"+u.slice(0,2)+"/"+u+c+"/"+r.options.__nativeName__:s+"/"+u.slice(0,2)+"/"+u+c+r.ext,r.url=n}}return null}var Yp=e("A",function(){function e(){this.pipeline=Ye.append(Hp).append(Bp),this.fetchPipeline=We.append(Hp).append(kp),this.transformPipeline=qe.append(Wp).append(Gp),this.bundles=Le,this.assets=Fe,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Pl,this.force=!1,this.allowImageBitmap=!be.isMobile,this.utils=$e,this.downloader=yp,this.parser=Lp,this.packManager=Pp,this.cacheAsset=!0,this.cacheManager=null,this.presets=Ze,this.factory=Rp,this.preprocessPipe=Hp,this.fetchPipe=kp,this.loadPipe=Bp,this.references=Je,this._releaseManager=Ml,this._files=ke,this._parsed=Pe,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var i=e.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=t,this.generalNativeBase=i},t.getBundle=function(e){return Le.get(e)||null},t.removeBundle=function(e){e._destroy(),Le.remove(e.name)},t.loadAny=function(e,t,i,r){var n=Wl(t,i,r),s=n.options,o=n.onProgress,a=n.onComplete;s.preset=s.preset||"default",e=Array.isArray(e)?e.slice():e;var u=new Ve({input:e,onProgress:o,onComplete:Yl(a),options:s});Ye.async(u)},t.preloadAny=function(e,t,i,r){var n=Wl(t,i,r),s=n.options,o=n.onProgress,a=n.onComplete;s.preset=s.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=new Ve({input:e,onProgress:o,onComplete:Yl(a),options:s});We.async(u)},t.postLoadNative=function(e,t,i){var r=Wl(t,void 0,i),n=r.options,s=r.onComplete;if(!e._native||!e.__nativeDepend__)return Yl(s)(null);var o=Pl.getNativeDep(e._uuid);if(o){if(!Le.has(o.bundle)){var a=Le.find((function(t){return!!t.getAssetInfo(e._uuid)}));a&&(o.bundle=a.name)}this.loadAny(o,n,(function(t,i){t?Ce(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=i,e.__nativeDepend__=!1),s&&s(t)}))}},t.loadRemote=function(e,t,i){var r=Wl(t,void 0,i),n=r.options,s=r.onComplete;if(!n.reloadAsset&&this.assets.has(e))return Yl(s)(null,this.assets.get(e));n.__isNative__=!0,n.preset=n.preset||"remote",this.loadAny({url:e},n,null,(function(t,i){t?(Ce(t.message,t.stack),s&&s(t,null)):Rp.create(e,i,n.ext||G(e),n,(function(e,t){s&&s(e,t)}))}))},t.loadBundle=function(e,t,i){var r=Wl(t,void 0,i),n=r.options,s=r.onComplete,o=je(e);if(this.bundles.has(o))return Yl(s)(null,this.getBundle(o));n.preset=n.preset||"bundle",n.ext="bundle",n.__isNative__=!0,this.loadAny({url:e},n,null,(function(t,i){t?(Ce(t.message,t.stack),s&&s(t,null)):Rp.create(e,i,"bundle",n,(function(e,t){s&&s(e,t)}))}))},t.releaseAsset=function(e){Ml.tryRelease(e,!0)},t.releaseUnusedAssets=function(){Fe.forEach((function(e){Ml.tryRelease(e)}))},t.releaseAll=function(){Fe.forEach((function(e){Ml.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},x(e,[{key:"main",get:function(){return Le.get(He.MAIN)||null}},{key:"resources",get:function(){return Le.get(He.RESOURCES)||null}}]),e}());Yp.Pipeline=Ge,Yp.Task=Ve,Yp.Cache=Oe,Yp.RequestItem=Up,Yp.Bundle=ql,Yp.BuiltinBundleName=He;var qp=e("i",o.assetManager=new Yp);o.AssetManager=Yp;var Xp=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],Zp=[".mp3",".ogg",".wav",".m4a"];function $p(){return!0}var Jp={transformURL:function(e){var t=et(e);if(!t)return e;var i=Le.find((function(e){return!!e.getAssetInfo(t)}));if(!i)return e;var r,n=i.getAssetInfo(t);if(!(r=e.startsWith(i.base+i.config.nativeBase)?n.nativeVer||"":n.ver||"")||-1!==e.indexOf(r))return e;var s=!1;if(".ttf"===G(e)&&(s=!0),s){var o=tt(e),a=je(e);e=o+"."+r+"/"+a}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+r}));return e}},Kp=e("C",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=Gl}var t=e.prototype;return t.load=function(e,t,i){void 0===i&&void 0!==t&&(i=t,t=null);for(var r=Array.isArray(e)?e:[e],n=0;n<r.length;n++){var s=r[n];"string"==typeof s?r[n]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var o=[],a=[];qp.loadAny(r,null,(function(e,i,r){r.content&&(Xp.includes(r.ext)?o.push(r.content):Zp.includes(r.ext)&&a.push(r.content)),t&&t(e,i,r)}),(function(e,t){var n=null;if(!e){t=Array.isArray(t)?t:[t];for(var s=function(e){var i=t[e];if(!(i instanceof M)){var n=i,s=r[e].url;o.includes(n)?Rp.create(s,i,".png",{},(function(i,r){n=t[e]=r})):a.includes(n)&&Rp.create(s,i,".mp3",{},(function(i,r){n=t[e]=r})),Fe.add(s,n)}},u=0;u<t.length;u++)s(u);if(t.length>1){var c=Object.create(null);t.forEach((function(e){c[e._uuid]=e})),n={isCompleted:$p,_map:c}}else n=t[0]}i&&i(e,n)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return qp.assets.has(e)?{content:qp.assets.get(e)}:null},t.loadRes=function(e,t,i,r){var n=this._parseLoadResArgs(t,i,r),s=n.type,o=n.onProgress,a=n.onComplete,u=G(e);u&&!Xl.getInfoWithPath(e,s)&&(e=e.slice(0,-u.length)),Xl.load(e,s,o,a)},t.loadResArray=function(e,t,i,r){var n=this._parseLoadResArgs(t,i,r),s=n.type,o=n.onProgress,a=n.onComplete;e.forEach((function(t,i){var r=G(t);r&&!Xl.getInfoWithPath(t,s)&&(e[i]=t.slice(0,-r.length))})),Xl.load(e,s,o,a)},t.loadResDir=function(e,t,i,r){var n=this._parseLoadResArgs(t,i,r),s=n.type,o=n.onProgress,a=n.onComplete;Xl.loadDir(e,s,o,(function(t,i){var r=[];t||(r=Xl.getDirWithPath(e,s).map((function(e){return e.path}))),a&&a(t,i,r)}))},t.getRes=function(e,t){return Fe.has(e)?Fe.get(e):Xl.get(e,t)},t.getResCount=function(){return Fe.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return Pl.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),i=function(i){var r=e[i];t["."+i]=function(e,t,i){r({url:e},i)}};for(var r in e)i(r);yp.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),i=function(i){var r=e[i];t["."+i]=function(e,t,i){r({content:e},i)}};for(var r in e)i(r);Lp.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];"string"==typeof i&&(i=Fe.get(i)),qp.releaseAsset(i)}else e&&("string"==typeof e&&(e=Fe.get(e)),qp.releaseAsset(e))},t.releaseAsset=function(e){qp.releaseAsset(e)},t.releaseRes=function(e,t){Xl.release(e,t)},t.releaseAll=function(){qp.releaseAll(),Fe.clear()},t.removeItem=function(e){return!!Fe.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var i=Pl.getDepsRecursively(e),r=0;r<i.length;r++)this._autoReleaseSetting[i[r]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},x(e,[{key:"onProgress",set:function(e){Ll=e}},{key:"_cache",get:function(){return Fe._map}},{key:"md5Pipe",get:function(){return Jp}},{key:"downloader",get:function(){return yp}},{key:"loader",get:function(){return qp.parser}}]),e}()),Qp=e("l",new Kp),ef=e("j",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,qp.init(e),e.rawAssets&&Xl.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:He.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){qp.loadAny(e,t)}}),tf=e("u",{});Z(tf,"url",[{name:"normalize",target:qp.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Ue({path:Ke(e.substr(10)),bundle:He.RESOURCES,__isNative__:!0,ext:G(e)}):""}}]),$(ef,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),$(Qp,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),Z(o,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return Qp}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return ef}},{name:"Pipeline",target:Yp,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return tf}}]),$(o,"cc",[{name:"LoadingItems",suggest:T(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),Z(Qe,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:yp,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),Z(Ol,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return qp.main?null===(t=qp.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),Z(xt,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return qp.main&&qp.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var rf=Ml._autoRelease;Ml._autoRelease=function(e,t,i){rf.call(Ml,e,t,i);for(var r=Qp._autoReleaseSetting,n=Object.keys(r),s=0;s<n.length;s++){var o=n[s];if(!0===r[o]){var a=Fe.get(o);a&&Ml.tryRelease(a)}}}}}}));
