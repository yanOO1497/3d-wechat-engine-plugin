System.register(["./deprecated-0768b3d4.js","./deprecated-4df5f565.js","./audio-downloader-f2f97571.js"],(function(t,e){"use strict";var i,r,n,s,o,a,u,c,h,l,p,_,f,d,g,v,m,y,b,w,A,T,E,C,S,D,O,R,I,P,k,F,x,N,M,L,B,z,j,H,U,W,V,G,Y,q,X,Z,$,J,K,Q,tt,et,it,rt,nt,st,ot,at,ut,ct,ht,lt,pt,_t,ft,dt,gt,vt,mt,yt,bt,wt,At,Tt,Et,Ct,St,Dt,Ot,Rt,It,Pt,kt,Ft,xt,Nt,Mt,Lt,Bt,zt,jt,Ht,Ut,Wt,Vt,Gt,Yt,qt,Xt,Zt,$t,Jt,Kt,Qt,te,ee,ie,re,ne,se,oe,ae,ue,ce,he,le,pe,_e,fe,de,ge,ve,me,ye,be,we,Ae,Te,Ee,Ce,Se,De,Oe,Re,Ie,Pe,ke,Fe,xe,Ne,Me,Le,Be,ze,je,He,Ue,We,Ve,Ge,Ye,qe,Xe,Ze,$e,Je,Ke,Qe,ti,ei,ii,ri,ni,si,oi,ai,ui,ci,hi,li,pi,_i,fi,di,gi,vi,mi,yi,bi,wi,Ai,Ti,Ei,Ci,Si,Di,Oi,Ri,Ii,Pi,ki,Fi,xi,Ni,Mi,Li,Bi,zi,ji,Hi,Ui;return{setters:[function(t){i=t.c,r=t._,n=t.y,s=t.b,o=t.l,a=t.bn,u=t.bo,c=t.e,h=t.f,l=t.C,p=t.T,_=t.s,f=t.b2,d=t.aX,g=t.bp,v=t.aE,m=t.bq,y=t.br,b=t.bs,w=t.bt,A=t.bu,T=t.n,E=t.W,C=t.V,S=t.Z,D=t.a0,O=t.aa,R=t.a6,I=t.a8,P=t.a3,k=t.z,F=t.bv,x=t.a,N=t.o,M=t.A,L=t.Q,B=t.aF,z=t.bw,j=t.b8,H=t.bx,U=t.E,W=t.by,V=t.bz,G=t.G,Y=t.t,q=t.w,X=t.aK,Z=t.aB,$=t.aC,J=t.B,K=t.x,Q=t.aY,tt=t.b5,et=t.ah,it=t.h,rt=t.m,nt=t.b6,st=t.d,ot=t.aI,at=t.bA,ut=t.aJ,ct=t.aH,ht=t.bh,lt=t.r,pt=t.bB,_t=t.b3,ft=t.bC,dt=t.bD,gt=t.aG,vt=t.S,mt=t.be,yt=t.j,bt=t.i,wt=t.R,At=t.P,Tt=t.p,Et=t.X,Ct=t.a7,St=t.q,Dt=t.aM,Ot=t.bE,Rt=t.bF,It=t.bG,Pt=t.bH,kt=t.bI,Ft=t.bJ,xt=t.bK,Nt=t.bb,Mt=t.bL,Lt=t.bM,Bt=t.bN,zt=t.k,jt=t.I,Ht=t.bO,Ut=t.bP,Wt=t.bQ,Vt=t.bR,Gt=t.bS,Yt=t.bT,qt=t.bU,Xt=t.bV,Zt=t.bW,$t=t.bX,Jt=t.bY,Kt=t.K,Qt=t.aU,te=t.bZ,ee=t.J},function(t){ie=t.bN,re=t.bC,ne=t.bp,se=t.d_,oe=t.bM,ae=t.J,ue=t.h,ce=t.q,he=t.C,le=t.r,pe=t.v,_e=t.t,fe=t.w,de=t.cG,ge=t.dR,ve=t.d$,me=t.e0,ye=t.bQ,be=t.e1,we=t.bI,Ae=t.e2,Te=t.N,Ee=t.O,Ce=t.o,Se=t.dP,De=t.dQ,Oe=t.b_,Re=t.e3,Ie=t.e4,Pe=t.e5,ke=t.e6,Fe=t.e7,xe=t.c0,Ne=t.cl,Me=t.cm,Le=t.co,Be=t.bK,ze=t.e8,je=t.dU,He=t.dW,Ue=t.A,We=t.a,Ve=t.F,Ge=t.cN,Ye=t.B,qe=t.b,Xe=t.M,Ze=t.I,$e=t.as,Je=t.ap,Ke=t.aI,Qe=t.aH,ti=t.av,ei=t.e9,ii=t.K,ri=t.aG,ni=t.aF,si=t.ea,oi=t.ar,ai=t.H,ui=t.X,ci=t.aE,hi=t.aD,li=t.eb,pi=t.bJ,_i=t.ad,fi=t.c3,di=t.aU,gi=t.dx,vi=t.cs,mi=t.ct,yi=t.aT,bi=t.au,wi=t.c$,Ai=t.R,Ti=t.x,Ei=t.aS,Ci=t.dj,Si=t.dk,Di=t.cA,Oi=t.dm,Ri=t.dF,Ii=t.aR,Pi=t.L,ki=t.dE,Fi=t.bR,xi=t.b$,Ni=t.bw,Mi=t.bG,Li=t.bH,Bi=t.ec},function(t){zi=t.d,ji=t.a,Hi=t.b,Ui=t.A}],execute:function(){var Wi,Vi,Gi,Yi,qi;t({G:ih,H:eh,I:void 0,K:void 0,Q:dl,d:pr,p:gl,s:void 0,z:void 0});var Xi=t("M",i("cc.MissingScript")(Wi=a()((qi=function(t){function e(){var e;return e=t.call(this)||this,c(e,"compiled",Gi,h(e)),c(e,"_$erialized",Yi,h(e)),e}return r(e,t),e.safeFindClass=function(t){var e=u(t);if(e)return e;o.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){n(4600,this.node.name)},e}(l),Gi=s((Vi=qi).prototype,"compiled",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yi=s(Vi.prototype,"_$erialized",[_,f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wi=Vi))||Wi)||Wi);function Zi(t){var e,i,r,n=t.deserializedList,s=t._idPropList,o=t._idList,a=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,e=0;e<o.length;e++)i=s[e],r=o[e],a[e][i]=n[r]}o._MissingScript=Xi;var $i=function(){function t(t,e,i){this.result=void 0,this.customEnv=void 0,this.deserializedList=void 0,this.deserializedData=void 0,this._classFinder=void 0,this._ignoreEditorOnly=void 0,this._idList=void 0,this._idObjList=void 0,this._idPropList=void 0,this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=e,this._idList=[],this._idObjList=[],this._idPropList=[]}var e=t.prototype;return e.deserialize=function(t){if(Array.isArray(t)){var e=t,i=e.length;this.deserializedList.length=i;for(var r=0;r<i;r++)e[r]&&(this.deserializedList[r]=this._deserializeObject(e[r]));this.deserializedData=i>0?this.deserializedList[0]:[],Zi(this)}else{var n;this.deserializedList.length=1,n=t?this._deserializeObject(t):null,Zi(this),this.deserializedList[0]=n,this.deserializedData=n}return this.deserializedData},e._deserializeObject=function(t,e,i){var r,n=null,s=null,a=t.__type__;if("TypedArray"===a){var c=t.array;n=new window[t.ctor](c.length);for(var h=0;h<c.length;++h)n[h]=c[h];return n}if(a){if(!(s=this._classFinder(a,t,e,i)))return this._classFinder===u&&o.deserialize.reportMissingClass(a),null;(n=new s)._deserialize?n._deserialize(t.content,this):o.Class._isCCClass(s)?function(t,e,i,r){var n;r.hasOwnProperty("__deserialize__")?n=r.__deserialize__:(n=function(t,e){var i,r=b.test(w(e)),n=o.js.isChildClassOf(e,o._BaseNode)||o.js.isChildClassOf(e,o.Component),s=[],a=s,u=[],c=u,h=[];return function(){var t=e.__values__;i="_$erialized"===t[t.length-1];for(var n=g(e),l=m+"type",p=m+"default",_=m+"formerlySerializedAs",f=0;f<t.length;f++){var d=t[f],y=d;n[d+_]&&(y=n[d+_]);var b=v.getDefault(n[d+p]),w=!1;if(r){var T=n[d+l];if(void 0===b&&T)w=T instanceof A;else{var E=typeof b;w="string"===E||"number"===E||"boolean"===E}}r&&w?(y!==d&&a===s&&(a=s.slice()),s.push(d),a!==s&&a.push(y)):(y!==d&&c===u&&(c=u.slice()),u.push(d),c!==u&&c.push(y),h.push(b instanceof o.ValueType&&b.constructor))}}(),function(t,e,o){for(var l=0;l<s.length;++l){var p=o[a[l]];void 0!==p&&(e[s[l]]=p)}for(var _=0;_<u.length;++_){var f=u[_],d=o[c[_]];if(void 0!==d)if(r||"object"==typeof d){var g=h[_];g?r||d?t._deserializeTypedObject(e[f],d,g):e[f]=null:d?t._deserializeObjField(e,d,f):e[f]=null}else e[f]=d}n&&o._id&&(e._id=o._id),i&&(e._$erialized=JSON.parse(JSON.stringify(o)),t._deserializePrimitiveObject(e._$erialized,o))}}(0,r),y(r,"__deserialize__",n,!0)),n(t,e,i,r)}(this,n,t,s):this._deserializeTypedObject(n,t,s)}else if(Array.isArray(t)){n=new Array(t.length);for(var l=0;l<t.length;l++)"object"==typeof(r=t[l])&&r?this._deserializeObjField(n,r,""+l):n[l]=r}else n={},this._deserializePrimitiveObject(n,t);return n},e._deserializeObjField=function(t,e,i){var r=e.__id__;if(void 0===r){var n=e.__uuid__;n?this.result.push(t,i,n):t[i]=this._deserializeObject(e)}else{var s=this.deserializedList[r];s?t[i]=s:(this._idList.push(r),this._idObjList.push(t),this._idPropList.push(i))}},e._deserializePrimitiveObject=function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];"object"!=typeof r?"__type__"!==i&&(t[i]=r):r?this._deserializeObjField(t,r,i):t[i]=null}},e._deserializeTypedObject=function(t,e,i){if(i===o.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===o.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(i!==o.Color){if(i===o.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var r=m+"default",n=g(i),s=i.__props__||Object.keys(t),a=0;a<s.length;a++){var u=s[a],c=e[u];void 0!==c&&e.hasOwnProperty(u)||(c=v.getDefault(n[u+r])),"object"!=typeof c?t[u]=c:c?this._deserializeObjField(t,c,u):t[u]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var h=e.a;t.a=void 0===h?255:h}},t}();$i.pool=void 0,$i.pool=new d((function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0}),1),$i.pool.get=function(t,e,i,r){var n=this._get();return n?(n.result=t,n.customEnv=i,n._classFinder=e,n):new $i(t,e,i,r)};var Ji=[E,C,S,D,O,R,I,P];function Ki(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var Qi=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},Ki,Ki,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){P.fromArray(t,e,1)}],tr=t("D",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var e=t.prototype;return e.init=function(t){this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]},e.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},e.push=function(t,e,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(i)},t}());function er(t,e){for(var i=t[4][e[0]],r=i[0],n=new(0,r[0]),s=r[1],o=r[2],a=i[i.length-1],u=1;u<a;++u)n[s[i[u]]]=e[u];for(;u<e.length;++u){var c=s[i[u]],h=r[i[u]+o];(0,ar[h])(t,n,c,e[u])}return n}function ir(t,e,i){var r=new e;return r._deserialize?r._deserialize(i,t[0]):k(5303,F(e)),r}function rr(t,e,i,r){r>=0?e[i]=t[5][r]:t[7][3*~r]=e}function nr(t){return function(e,i,r,n){i[r]=n;for(var s=0;s<n.length;++s)t(e,n,s,n[s])}}function sr(t,e,i,r){e[i]=null,t[8][r]=e}function or(t,e,i,r){e[i]=er(t,r)}tr.pool=new d((function(t){t.reset()}),5),tr.pool.get=function(){return this._get()||new tr};var ar=new Array(13);function ur(t,e){return t||pr.reportMissingClass(e),Object}function cr(t,e,i,r,n,s){var o,a,u,c=t(e);if(!c){if(n)return void(i[r]=(o=i,a=r,u=e,function(){var e=t(u)||ur(s,u);return o[a]=e,new e}));c=ur(s,e)}i[r]=c}function hr(t,e,i){for(var r=i||u,n=t[3],s=0;s<n.length;++s){var o=n[s];"string"!=typeof o?cr(r,o[0],o,0,e,i):cr(r,o,n,s,e,i)}}function lr(t){var e=t[4];if(e)for(var i=t[3],r=0;r<e.length;++r){var n=e[r];n[0]=i[n[0]]}}function pr(t,e,i){"string"==typeof t&&(t=JSON.parse(t));var r,n=!e;(e=e||tr.pool.get()).init(t),i=i||{};var s=t[0],a=!1;if("object"==typeof s&&(a=s.preprocessed,s=s.version),s<1)throw new Error(T(5304,s));i._version=s,i.result=e,t[0]=i,a||(hr(t,!1,i.classFinder),lr(t)),o.game._isCloning=!0;var u=t[5],c=function(t){var e=t[5],i=t[6],r=0===i?0:i.length,n=e[e.length-1],s=e.length-r;"number"!=typeof n?n=0:(n<0&&(n=~n),--s);for(var o=0;o<s;++o)e[o]=er(t,e[o]);for(var a=t[3],u=0;u<r;++u,++o){var c=i[u],h=e[o];if(c>=0){var l=a[c];e[o]=ir(t,l,h)}else(0,ar[c=~c])(t,e,o,h)}return n}(t);return o.game._isCloning=!1,t[7]&&function(t,e,i){for(var r=t.length-1,n=0,s=3*t[r];n<s;n+=3){var o=t[n],a=e[t[n+2]],u=t[n+1];u>=0?o[i[u]]=a:o[~u]=a}for(;n<r;n+=3){var c=e[t[n]],h=e[t[n+2]],l=t[n+1];l>=0?c[i[l]]=h:c[~l]=h}}(t[7],u,t[2]),function(t){for(var e=t[5],i=t[2],r=t[1],n=t[8],s=t[9],o=t[10],a=0;a<n.length;++a){var u=n[a];"number"==typeof u&&(n[a]=e[u]);var c=s[a];"number"==typeof c&&(c=c>=0?i[c]:~c,s[a]=c);var h=o[a];"number"==typeof h&&(o[a]=r[h])}}(t),r=u[c],n&&tr.pool.put(e),r}ar[0]=function(t,e,i,r){e[i]=r},ar[1]=rr,ar[2]=nr(rr),ar[3]=nr(sr),ar[4]=or,ar[5]=function(t,e,i,r){Qi[r[0]](e[i],r)},ar[6]=sr,ar[7]=function(t,e,i,r){e[i].set(r)},ar[8]=function(t,e,i,r){var n=new Ji[r[0]];Qi[r[0]](n,r),e[i]=n},ar[9]=nr(or),ar[10]=function(t,e,i,r){var n=t[3][r[0]];e[i]=ir(t,n,r[1])},ar[11]=function(t,e,i,r){var n=r[0];e[i]=n;for(var s=1;s<r.length;s+=3){var o=r[s],a=r[s+1],u=r[s+2];(0,ar[a])(t,n,o,u)}},ar[12]=function(t,e,i,r){var n=r[0];e[i]=n;for(var s=0;s<n.length;++s){var o=n[s],a=r[s+1];0!==a&&(0,ar[a])(t,n,s,o)}},pr.Details=tr,pr.reportMissingClass=function(t){n(5302,t)};var _r,fr,dr,gr=function(t){this.preprocessed=!0,this.version=t};function vr(t,e,i){return[1,0,0,[t],0,i?[e,-1]:[e],[0],0,[],[],[]]}o.deserialize=pr;var mr=t("B",i("cc.BufferAsset")((dr=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._buffer=null,e}return r(e,t),e.prototype.buffer=function(){return this._buffer},x(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(M),s((fr=dr).prototype,"_nativeAsset",[N],Object.getOwnPropertyDescriptor(fr.prototype,"_nativeAsset"),fr.prototype),_r=fr))||_r);o.BufferAsset=mr;var yr=B.Flags.Destroyed,br=B.Flags.PersistentMask,wr=m+"default",Ar=v.IDENTIFIER_RE,Tr={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},Er=v.escapeForJS,Cr=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},t}();function Sr(t,e){return e instanceof Cr?new Cr(e.varName,t+e.expression):t+e}function Dr(t,e,i){Array.isArray(i)?(i[0]=Sr(e,i[0]),t.push(i)):t.push(Sr(e,i)+";")}var Or=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var r=this._exps[i];Dr(t,e+Rr(r[0])+"=",r[1])}},t}();function Rr(t){return Ar.test(t)?"."+t:"["+Er(t)+"]"}Or.pool=void 0,Or.pool=new d((function(t){t._exps.length=0,t._targetExp=null}),1),Or.pool.get=function(t){var e=this._get()||new Or;return e._targetExp=t,e};var Ir,Pr,kr,Fr,xr,Nr,Mr,Lr=function(){function t(t,e){var i;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=z(),j(this.funcModuleCache,Tr),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(i="var "+this.globalVariables.join(",")+";");var r=function(t){var e=[];return function t(e,i){for(var r,n=L(i);!(r=n()).done;){var s=r.value;Array.isArray(s)?t(e,s):e.push(s)}}(e,t),e.join("")}(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",r)(this.objs,this.funcs);for(var n=0,s=this.objsToClear_iN$t.length;n<s;++n)this.objsToClear_iN$t[n]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var i=F(t);if(i){var r=this.funcModuleCache[i];if(r)return r;if(void 0===r){var n=-1!==i.indexOf(".");if(n)try{if(n=t===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(t){}}}var s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));var o="F["+s+"]";return e&&(o="("+o+")"),this.funcModuleCache[i]=o,o},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,i,r){var n=Or.pool.get(r),s=e.constructor.__props__;s||(s=Object.keys(e));for(var o=0;o<s.length;o++){var a=s[o],u=i[a];if(e[a]!==u){var c=this.enumerateField(i,a,u);n.append(a,c)}}n.writeCode(t),Or.pool.put(n)},e.enumerateCCClass=function(t,e,i){for(var r=i.__values__,n=g(i),s=0;s<r.length;s++){var a=r[s],u=e[a],c=n[a+wr];if(!Br(c,u))if("object"==typeof u&&u instanceof o.ValueType&&(c=v.getDefault(c))&&c.constructor===u.constructor){var h="o"+Rr(a);this.setValueType(t,c,u,h)}else this.setObjProp(t,e,a,u)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new Cr(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)Dr(i,e+"["+r+"]=",this.enumerateField(t,r,t[r]));return i},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId,r=[new Cr(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)0!==t[n]&&Dr(r,i+"["+n+"]=",t[n]);return r},e.enumerateField=function(t,e,i){if("object"==typeof i&&i){var r=i._iN$t;if(r){var n=r.globalVar;if(!n){n=r.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(n);var s=r.source[0];r.source[0]=Sr(n+"=",s)}return n}return ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?Er(i):("_objFlags"===e&&t instanceof B&&(i&=br),i)},e.setObjProp=function(t,e,i,r){Dr(t,"o"+Rr(i)+"=",this.enumerateField(e,i,r))},e.enumerateObject=function(t,e){var i=e.constructor;if(o.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var n=e[r];"object"==typeof n&&n&&n===e._iN$t||this.setObjProp(t,e,r,n)}},e.instantiateObj=function(t){if(t instanceof o.ValueType)return v.getNewValueTypeCode(t);if(t instanceof o.Asset)return this.getObjRef(t);if(t._objFlags&yr)return null;var e,i=t.constructor;if(o.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof o.Component){if(t instanceof o._BaseNode||t instanceof o.Component)return this.getObjRef(t)}else if(this.parent instanceof o._BaseNode)if(t instanceof o._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof o.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new Cr("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new Cr("o","{}");else{if(i)return this.getObjRef(t);e=new Cr("o","Object.create(null)")}var r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},t}();function Br(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof o.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return H(t)&&H(e)}return!1}var zr,jr,Hr,Ur,Wr,Vr=U({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Gr=t("P",i("cc.Prefab")((Mr=Nr=function(t){function e(){var e;return e=t.call(this)||this,c(e,"data",kr,h(e)),c(e,"optimizationPolicy",Fr,h(e)),c(e,"asyncLoadAssets",xr,h(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}r(e,t);var i=e.prototype;return i.createNode=function(t){var e=o.instantiate(this);e.name=this.name,t(null,e)},i.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof o._BaseNode&&t,new Lr(t,e).result)},i._doInstantiate=function(t){return this.data._prefab?this.data._prefab._synced=!0:n(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},i._instantiate=function(){var t;return this.data._prefab._synced=!0,t=this.data._instantiate(),++this._instantiatedTimes,t},e}(M),Nr.OptimizationPolicy=Vr,Nr.OptimizationPolicyThreshold=3,kr=s((Pr=Mr).prototype,"data",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fr=s(Pr.prototype,"optimizationPolicy",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.AUTO}}),xr=s(Pr.prototype,"asyncLoadAssets",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ir=Pr))||Ir);o.Prefab=Gr,W(o,"cc._Prefab","Prefab");var Yr,qr,Xr,Zr,$r=t("S",i("cc.SceneAsset")((Wr=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"scene",Hr,h(e)),c(e,"asyncLoadAssets",Ur,h(e)),e}return r(e,t),e}(M),Hr=s((jr=Wr).prototype,"scene",[p,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ur=s(jr.prototype,"asyncLoadAssets",[p,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zr=jr))||zr);o.SceneAsset=$r;var Jr,Kr,Qr,tn,en=t("a",i("cc.SpriteAtlas")((Zr=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"spriteFrames",Xr,h(e)),e}r(e,t);var i=e.prototype;return i.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},i.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},i.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];t.push(e[n])}return t},i._serialize=function(){},i._deserialize=function(t,e){var i=t;this._name=i.name;var r=i.spriteFrames;this.spriteFrames=z();for(var n=0;n<r.length;n+=2)e.result.push(this.spriteFrames,r[n],r[n+1])},e}(M),Xr=s((qr=Zr).prototype,"spriteFrames",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return z()}}),Yr=qr))||Yr);o.SpriteAtlas=en;var rn,nn,sn,on,an=t("T",i("cc.TextAsset")((tn=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"text",Qr,h(e)),e}return r(e,t),e.prototype.toString=function(){return this.text},e}(M),Qr=s((Kr=tn).prototype,"text",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Jr=Kr))||Jr);o.TextAsset=an;var un,cn=t("J",i("cc.JsonAsset")((on=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"json",sn,h(e)),e}return r(e,t),e}(M),sn=s((nn=on).prototype,"json",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rn=nn))||rn);o.JsonAsset=cn;var hn,ln,pn,_n,fn=t("F",i("cc.Font")(un=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(M))||un);o.Font=fn;var dn,gn,vn,mn,yn,bn,wn,An,Tn,En=t("b",i("cc.TTFFont")((_n=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"_fontFamily",pn,h(e)),e}return r(e,t),x(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:G(this._native),__isNative__:!0}}}]),e}(fn),pn=s((ln=_n).prototype,"_fontFamily",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s(ln.prototype,"_nativeAsset",[N,V],Object.getOwnPropertyDescriptor(ln.prototype,"_nativeAsset"),ln.prototype),s(ln.prototype,"_nativeDep",[N],Object.getOwnPropertyDescriptor(ln.prototype,"_nativeDep"),ln.prototype),hn=ln))||hn);o.TTFFont=En;var Cn,Sn=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},Dn=t("O",function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,i=Object.keys(this.letterDefinitions);e<i.length;e++){var r=i[e],n=new Sn;j(n,this.letterDefinitions[r]),t[r]=n}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}()),On=t("c",(dn=i("cc.BitmapFont"),gn=Y(ie),dn((Tn=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"fntDataStr",yn,h(e)),c(e,"spriteFrame",bn,h(e)),c(e,"fontSize",wn,h(e)),c(e,"fntConfig",An,h(e)),e}return r(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new Dn(t.texture));var e=this.fntConfig;if(e){var i=e.fontDefDictionary;for(var r in i){var n=new Sn,s=i[r].rect;n.offsetX=i[r].xOffset,n.offsetY=i[r].yOffset,n.w=s.width,n.h=s.height,n.u=s.x,n.v=s.y,n.textureID=0,n.valid=!0,n.xAdvance=i[r].xAdvance,this.fontDefDictionary.addLetterDefinitions(r,n)}}else q("The fnt config is not exists!")},e}(fn),yn=s((mn=Tn).prototype,"fntDataStr",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bn=s(mn.prototype,"spriteFrame",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wn=s(mn.prototype,"fontSize",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),An=s(mn.prototype,"fntConfig",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vn=mn))||vn));o.BitmapFont=On;var Rn,In,Pn,kn,Fn,xn,Nn,Mn,Ln,Bn=t("L",i("cc.LabelAtlas")(Cn=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(On))||Cn);o.LabelAtlas=Bn;var zn=t("e",(Rn=i("cc.Skeleton"),In=Y([X]),Pn=Y([P]),Rn((Ln=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"_joints",xn,h(e)),c(e,"_bindposes",Nn,h(e)),c(e,"_hash",Mn,h(e)),e._invBindposes=null,e}return r(e,t),e.prototype.destroy=function(){return o.director.root.dataPoolManager.releaseSkeleton(this),t.prototype.destroy.call(this)},x(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new P;P.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var i=this._bindposes[e];t+=i.m00.toPrecision(2)+" "+i.m01.toPrecision(2)+" "+i.m02.toPrecision(2)+" "+i.m03.toPrecision(2)+" "+i.m04.toPrecision(2)+" "+i.m05.toPrecision(2)+" "+i.m06.toPrecision(2)+" "+i.m07.toPrecision(2)+" "+i.m08.toPrecision(2)+" "+i.m09.toPrecision(2)+" "+i.m10.toPrecision(2)+" "+i.m11.toPrecision(2)+" "+i.m12.toPrecision(2)+" "+i.m13.toPrecision(2)+" "+i.m14.toPrecision(2)+" "+i.m15.toPrecision(2)+"\n"}this._hash=re(t,666)}return this._hash}}]),e}(M),xn=s((Fn=Ln).prototype,"_joints",[In],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nn=s(Fn.prototype,"_bindposes",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mn=s(Fn.prototype,"_hash",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kn=Fn))||kn));o.Skeleton=zn,Z(ne.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),$(ne.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]),$(se.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),Z(oe.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var jn=t("n",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},x(t,[{key:"priority",set:function(t){this._priority=t},get:function(){return this._priority}},{key:"id",set:function(t){this._id=t},get:function(){return this._id}}]),t}()),Hn=new Q("Scheduler"),Un=function(t,e,i,r){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=r};Un.get=function(t,e,i,r){var n=Un._listEntries.pop();return n?(n.target=t,n.priority=e,n.paused=i,n.markedForDeletion=r):n=new Un(t,e,i,r),n},Un.put=function(t){Un._listEntries.length<20&&(t.target=null,Un._listEntries.push(t))},Un._listEntries=[];var Wn=function(t,e,i,r){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=i,this.callback=r};Wn.get=function(t,e,i,r){var n=Wn._hashUpdateEntries.pop();return n?(n.list=t,n.entry=e,n.target=i,n.callback=r):n=new Wn(t,e,i,r),n},Wn.put=function(t){Wn._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,Wn._hashUpdateEntries.push(t))},Wn._hashUpdateEntries=[];var Vn=function(t,e,i,r,n,s){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=r,this.currentTimerSalvaged=n,this.paused=s};Vn.get=function(t,e,i,r,n,s){var o=Vn._hashTimerEntries.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=n,o.paused=s):o=new Vn(t,e,i,r,n,s),o},Vn.put=function(t){Vn._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,Vn._hashTimerEntries.push(t))},Vn._hashTimerEntries=[];var Gn=function(){function t(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var e=t.prototype;return e.initWithCallback=function(t,e,i,r,n,s){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=r,this._delay=s,this._useDelay=this._delay>0,this._repeat=n,this._runForever=this._repeat===o.macro.REPEAT_FOREVER,!0},e.getInterval=function(){return this._interval},e.setInterval=function(t){this._interval=t},e.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},e.getCallback=function(){return this._callback},e.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},e.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},t}();Gn._timers=[],Gn.get=function(){return Gn._timers.pop()||new Gn},Gn.put=function(t){Gn._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,Gn._timers.push(t))};var Yn=t("f",function(t){function e(){var e;return(e=t.call(this)||this)._timeScale=void 0,e._updatesNegList=void 0,e._updates0List=void 0,e._updatesPosList=void 0,e._hashForUpdates=void 0,e._hashForTimers=void 0,e._currentTarget=void 0,e._currentTargetSalvaged=void 0,e._updateHashLocked=void 0,e._arrayForTimers=void 0,e._timeScale=1,e._updatesNegList=[],e._updates0List=[],e._updatesPosList=[],e._hashForUpdates=z(!0),e._hashForTimers=z(!0),e._currentTarget=null,e._currentTargetSalvaged=!1,e._updateHashLocked=!1,e._arrayForTimers=[],e}r(e,t),e.enableForTarget=function(t){var e=!1;(t.uuid||t.id)&&(e=!0),e||(t.__instanceId?n(1513):t.id=Hn.getNewId())};var i=e.prototype;return i.setTimeScale=function(t){this._timeScale=t},i.getTimeScale=function(){return this._timeScale},i.update=function(t){var e,i,r,n,s;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,r=(i=this._updatesNegList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updates0List).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updatesPosList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);var o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updates0List;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updatesPosList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(t,e,i,r,s,a){if("function"!=typeof t){var u=t;t=e,e=u}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!r,r=o.macro.REPEAT_FOREVER,s=0),J(e,1502);var c=e.uuid||e.id;if(c){var h,l,p=this._hashForTimers[c];if(p?p.paused!==a&&n(1511):(p=Vn.get(null,e,0,null,null,a),this._arrayForTimers.push(p),this._hashForTimers[c]=p),null==p.timers)p.timers=[];else for(l=0;l<p.timers.length;++l)if((h=p.timers[l])&&t===h._callback)return K(1507,h.getInterval(),i),void(h._interval=i);(h=Gn.get()).initWithCallback(this,t,e,i,r,s),p.timers.push(h),this._currentTarget===p&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else k(1510)},i.scheduleUpdate=function(t,e,i){var r=t.uuid||t.id;if(r){var n=this._hashForUpdates[r];if(n&&n.entry){if(n.entry.priority===e)return n.entry.markedForDeletion=!1,void(n.entry.paused=i);if(this._updateHashLocked)return K(1506),n.entry.markedForDeletion=!1,void(n.entry.paused=i);this.unscheduleUpdate(t)}var s,o=Un.get(t,e,i,!1);0===e?(s=this._updates0List,this._appendIn(s,o)):(s=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,o,e)),this._hashForUpdates[r]=Wn.get(s,o,t,null)}else k(1510)},i.unschedule=function(t,e){if(e&&t){var i=e.uuid||e.id;if(i){var r=this._hashForTimers[i];if(r)for(var n=r.timers,s=0,o=n.length;s<o;s++){var a=n[s];if(t===a._callback)return a!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),n.splice(s,1),Gn.put(a),r.timerIndex>=s&&r.timerIndex--,void(0===n.length&&(this._currentTarget===r?this._currentTargetSalvaged=!0:this._removeHashElement(r)))}}else k(1510)}},i.unscheduleUpdate=function(t){if(t){var e=t.uuid||t.id;if(e){var i=this._hashForUpdates[e];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else k(1510)}},i.unscheduleAllForTarget=function(t){if(t){var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];if(i){var r=i.timers;r.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var n=0,s=r.length;n<s;n++)Gn.put(r[n]);r.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}else k(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(o.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(t){var e,i,r,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var s=0;if(t<0)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,(r=this._updatesNegList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s===this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,(r=this._updates0List[e])&&this.unscheduleUpdate(r.target),s===this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,(r=this._updatesPosList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s===this._updatesPosList.length&&e++},i.isScheduled=function(t,e){J(t,1508),J(e,1509);var i=e.uuid||e.id;if(i){var r=this._hashForTimers[i];if(!r)return!1;if(null==r.timers)return!1;for(var n=r.timers,s=0;s<n.length;++s)if(t===n[s]._callback)return!0;return!1}k(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(o.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(t){var e,i,r,n,s=[],o=this._arrayForTimers;for(i=0,r=o.length;i<r;i++)(e=o[i])&&(e.paused=!0,s.push(e.target));if(t<0)for(i=0;i<this._updatesNegList.length;i++)(n=this._updatesNegList[i])&&n.priority>=t&&(n.paused=!0,s.push(n.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)(n=this._updates0List[i])&&(n.paused=!0,s.push(n.target));for(i=0;i<this._updatesPosList.length;i++)(n=this._updatesPosList[i])&&n.priority>=t&&(n.paused=!0,s.push(n.target));return s},i.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},i.pauseTarget=function(t){J(t,1503);var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];i&&(i.paused=!0);var r=this._hashForUpdates[e];r&&(r.entry.paused=!0)}else k(1510)},i.resumeTarget=function(t){J(t,1504);var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];i&&(i.paused=!1);var r=this._hashForUpdates[e];r&&(r.entry.paused=!1)}else k(1510)},i.isTargetPaused=function(t){J(t,1505);var e=t.uuid||t.id;if(!e)return k(1510),!1;var i=this._hashForTimers[e];if(i)return i.paused;var r=this._hashForUpdates[e];return!!r&&r.entry.paused},i._removeHashElement=function(t){var e=t.target.uuid||t.target.id;delete this._hashForTimers[e];for(var i=this._arrayForTimers,r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break}Vn.put(t)},i._removeUpdateFromHash=function(t){var e=t.target.uuid||t.target.id,i=this._hashForUpdates[e];if(i){for(var r=i.list,n=i.entry,s=0,o=r.length;s<o;s++)if(r[s]===n){r.splice(s,1);break}delete this._hashForUpdates[e],Un.put(n),Wn.put(i)}},i._priorityIn=function(t,e,i){for(var r=0;r<t.length;r++)if(i<t[r].priority)return void t.splice(r,0,e);t.push(e)},i._appendIn=function(t,e){t.push(e)},e}(jn));Yn.PRIORITY_SYSTEM=1<<31,Yn.PRIORITY_NON_SYSTEM=Yn.PRIORITY_SYSTEM+1,Yn.ID="scheduler",o.Scheduler=Yn;var qn,Xn,Zn,$n,Jn,Kn,Qn,ts,es,is,rs,ns,ss,os,as,us,cs,hs,ls,ps,_s,fs,ds,gs,vs,ms,ys,bs,ws,As,Ts,Es,Cs,Ss,Ds,Os,Rs,Is,Ps,ks,Fs,xs,Ns,Ms,Ls,Bs,zs,js,Hs,Us,Ws,Vs,Gs,Ys,qs,Xs,Zs,$s,Js,Ks,Qs,to,eo,io,ro,no,so,oo,ao,uo,co,ho,lo,po,_o,fo,go,vo=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new ae(t),this.jointAnimationInfo=new ue(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}(),mo=new C,yo=U(ce),bo=U(he),wo=U(le),Ao=U(pe),To=U(_e),Eo=U({SKYBOX:fe|de.DEPTH_STENCIL,SOLID_COLOR:de.ALL,DEPTH_ONLY:de.DEPTH_STENCIL,DONT_CLEAR:de.NONE}),Co=t("o",(qn=i("cc.Camera"),Xn=it(),Zn=rt(),$n=nt(),Jn=st(),Kn=Y(ge.BitMask),Qn=nt(),ts=st(),es=Y(Eo),is=nt(),rs=st(),ns=nt(),ss=st(),os=nt(),as=st(),us=nt(),cs=st(),hs=Y(yo),ls=nt(),ps=st(),_s=Y(bo),fs=nt(),ds=st(),gs=nt(),vs=st(),ms=nt(),ys=st(),bs=nt(),ws=st(),As=nt(),Ts=st(),Es=Y(wo),Cs=nt(),Ss=st(),Ds=Y(Ao),Os=nt(),Rs=st(),Is=Y(To),Ps=nt(),ks=st(),Fs=nt(),xs=st(),Ns=Y(oe),Ms=nt(),Ls=st(),qn(Bs=Xn(Bs=Zn(Bs=tt((so=no=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"_projection",js,h(e)),c(e,"_priority",Hs,h(e)),c(e,"_fov",Us,h(e)),c(e,"_fovAxis",Ws,h(e)),c(e,"_orthoHeight",Vs,h(e)),c(e,"_near",Gs,h(e)),c(e,"_far",Ys,h(e)),c(e,"_color",qs,h(e)),c(e,"_depth",Xs,h(e)),c(e,"_stencil",Zs,h(e)),c(e,"_clearFlags",$s,h(e)),c(e,"_rect",Js,h(e)),c(e,"_aperture",Ks,h(e)),c(e,"_shutter",Qs,h(e)),c(e,"_iso",to,h(e)),c(e,"_screenScale",eo,h(e)),c(e,"_visibility",io,h(e)),c(e,"_targetTexture",ro,h(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e}r(e,t);var i=e.prototype;return i.onLoad=function(){this._createCamera()},i.onEnable=function(){this.node.hasChangedFlags|=ve.POSITION,this._camera&&this._attachToScene()},i.onDisable=function(){this._camera&&this._detachFromScene()},i.onDestroy=function(){this._camera&&(o.director.root.destroyCamera(this._camera),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},i.screenPointToRay=function(t,e,i){return i||(i=me.create()),this._camera&&this._camera.screenPointToRay(i,t,e),i},i.worldToScreen=function(t,e){return e||(e=new C),this._camera&&this._camera.worldToScreen(e,t),e},i.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},i.convertToUINode=function(t,e,i){if(i||(i=new C),!this._camera)return i;this.worldToScreen(t,mo);var r=e.getComponent("cc.UITransform"),n=ye.getVisibleSize(),s=mo.x-.5*this._camera.width,a=mo.y-.5*this._camera.height;return mo.x=s/o.view.getScaleX()+.5*n.width,mo.y=a/o.view.getScaleY()+.5*n.height,r&&r.convertToNodeSpaceAR(mo,i),i},i._createCamera=function(){this._camera=o.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?o.director.root&&o.director.root.mainWindow:o.director.root&&o.director.root.tempWindow,priority:this._priority,flows:this._flows}),this._camera&&(this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=et(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},i._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},i._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},i._chechTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},i._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},x(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===he.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=et(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&(this._camera.viewport=t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var e=this._targetTexture;this._targetTexture=t,this._chechTargetTextureEvent(e),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?o.director.root&&o.director.root.mainWindow:o.director.root&&o.director.root.tempWindow)}},{key:"flows",set:function(t){this._camera&&(this._camera.flows=t),this._flows=t}}]),e}(l),no.ProjectionType=yo,no.FOVAxis=bo,no.ClearFlag=Eo,no.Aperture=wo,no.Shutter=Ao,no.ISO=To,js=s((zs=so).prototype,"_projection",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yo.PERSPECTIVE}}),Hs=s(zs.prototype,"_priority",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Us=s(zs.prototype,"_fov",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),Ws=s(zs.prototype,"_fovAxis",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bo.VERTICAL}}),Vs=s(zs.prototype,"_orthoHeight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Gs=s(zs.prototype,"_near",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ys=s(zs.prototype,"_far",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),qs=s(zs.prototype,"_color",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O("#333333")}}),Xs=s(zs.prototype,"_depth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Zs=s(zs.prototype,"_stencil",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$s=s(zs.prototype,"_clearFlags",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Eo.SOLID_COLOR}}),Js=s(zs.prototype,"_rect",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new I(0,0,1,1)}}),Ks=s(zs.prototype,"_aperture",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wo.F16_0}}),Qs=s(zs.prototype,"_shutter",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ao.D125}}),to=s(zs.prototype,"_iso",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return To.ISO100}}),eo=s(zs.prototype,"_screenScale",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),io=s(zs.prototype,"_visibility",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return be}}),ro=s(zs.prototype,"_targetTexture",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s(zs.prototype,"priority",[$n,Jn],Object.getOwnPropertyDescriptor(zs.prototype,"priority"),zs.prototype),s(zs.prototype,"visibility",[Kn,Qn,ts],Object.getOwnPropertyDescriptor(zs.prototype,"visibility"),zs.prototype),s(zs.prototype,"clearFlags",[es,is,rs],Object.getOwnPropertyDescriptor(zs.prototype,"clearFlags"),zs.prototype),s(zs.prototype,"clearColor",[ns,ss],Object.getOwnPropertyDescriptor(zs.prototype,"clearColor"),zs.prototype),s(zs.prototype,"clearDepth",[os,as],Object.getOwnPropertyDescriptor(zs.prototype,"clearDepth"),zs.prototype),s(zs.prototype,"clearStencil",[us,cs],Object.getOwnPropertyDescriptor(zs.prototype,"clearStencil"),zs.prototype),s(zs.prototype,"projection",[hs,ls,ps],Object.getOwnPropertyDescriptor(zs.prototype,"projection"),zs.prototype),s(zs.prototype,"fovAxis",[_s,fs,ds],Object.getOwnPropertyDescriptor(zs.prototype,"fovAxis"),zs.prototype),s(zs.prototype,"fov",[gs,vs],Object.getOwnPropertyDescriptor(zs.prototype,"fov"),zs.prototype),s(zs.prototype,"orthoHeight",[ms,ys],Object.getOwnPropertyDescriptor(zs.prototype,"orthoHeight"),zs.prototype),s(zs.prototype,"near",[bs,ws],Object.getOwnPropertyDescriptor(zs.prototype,"near"),zs.prototype),s(zs.prototype,"far",[As,Ts],Object.getOwnPropertyDescriptor(zs.prototype,"far"),zs.prototype),s(zs.prototype,"aperture",[Es,Cs,Ss],Object.getOwnPropertyDescriptor(zs.prototype,"aperture"),zs.prototype),s(zs.prototype,"shutter",[Ds,Os,Rs],Object.getOwnPropertyDescriptor(zs.prototype,"shutter"),zs.prototype),s(zs.prototype,"iso",[Is,Ps,ks],Object.getOwnPropertyDescriptor(zs.prototype,"iso"),zs.prototype),s(zs.prototype,"rect",[Fs,xs],Object.getOwnPropertyDescriptor(zs.prototype,"rect"),zs.prototype),s(zs.prototype,"targetTexture",[Ns,Ms,Ls],Object.getOwnPropertyDescriptor(zs.prototype,"targetTexture"),zs.prototype),Bs=zs))||Bs)||Bs)||Bs)||Bs));o.Camera=Co;var So,Do,Oo,Ro,Io,Po,ko,Fo,xo,No,Mo,Lo,Bo,zo,jo,Ho,Uo,Wo,Vo,Go,Yo,qo,Xo,Zo,$o,Jo,Ko,Qo,ta,ea,ia,ra,na,sa,oa,aa,ua,ca,ha,la,pa,_a,fa,da,ga,va,ma,ya,ba,wa,Aa,Ta,Ea,Ca,Sa,Da,Oa,Ra,Ia,Pa,ka,Fa,xa,Na,Ma,La,Ba,za,ja,Ha,Ua,Wa,Va,Ga,Ya,qa,Xa,Za,$a,Ja,Ka,Qa,tu,eu,iu,ru,nu,su,ou,au,uu,cu,hu,lu,pu,_u,fu,du,gu,vu,mu,yu,bu,wu,Au,Tu,Eu,Cu=t("E",(oo=i("cc.ClickEvent"),ao=Y(o.Node),oo((go=function(){function t(){c(this,"target",ho,this),c(this,"component",lo,this),c(this,"_componentId",po,this),c(this,"handler",_o,this),c(this,"customEventData",fo,this)}t.emitEvents=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(var s=0,o=e.length;s<o;s++){var a=e[s];a instanceof t&&a.emit(r)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(o.isValid(e)){this._genCompIdIfNeeded();var i=o.js._getClassById(this._componentId),r=e.getComponent(i);if(o.isValid(r)){var n=r[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(r,t))}}},e._compName2Id=function(t){var e=o.js.getClassByName(t);return o.js._getClassId(e)},e._compId2Name=function(t){var e=o.js._getClassById(t);return o.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},x(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),ho=s((co=go).prototype,"target",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lo=s(co.prototype,"component",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),po=s(co.prototype,"_componentId",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_o=s(co.prototype,"handler",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fo=s(co.prototype,"customEventData",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),uo=co))||uo));o.Component.EventHandler=Cu;var Su=new C(0,1,0),Du=new C,Ou=new D,Ru=(So=i("cc.AmbientInfo"),Do=Y(ot),So((Fo=function(){function t(){c(this,"_skyColor",Io,this),c(this,"_skyIllum",Po,this),c(this,"_groundAlbedo",ko,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},x(t,[{key:"skyColor",set:function(t){this._skyColor.set(t),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(t){this._skyIllum=t,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(t){this._groundAlbedo.set(t),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),t}(),Io=s((Ro=Fo).prototype,"_skyColor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(51,128,204,1)}}),Po=s(Ro.prototype,"_skyIllum",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ce.SKY_ILLUM}}),ko=s(Ro.prototype,"_groundAlbedo",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(51,51,51,255)}}),s(Ro.prototype,"skyColor",[p],Object.getOwnPropertyDescriptor(Ro.prototype,"skyColor"),Ro.prototype),s(Ro.prototype,"skyIllum",[p,Do],Object.getOwnPropertyDescriptor(Ro.prototype,"skyIllum"),Ro.prototype),s(Ro.prototype,"groundAlbedo",[p],Object.getOwnPropertyDescriptor(Ro.prototype,"groundAlbedo"),Ro.prototype),Oo=Ro))||Oo);o.AmbientInfo=Ru;var Iu=(xo=i("cc.SkyboxInfo"),No=Y(we),Mo=Y(we),xo((Wo=function(){function t(){c(this,"_envmap",zo,this),c(this,"_isRGBE",jo,this),c(this,"_enabled",Ho,this),c(this,"_useIBL",Uo,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},x(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(t){this._useIBL=t,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(t){this._envmap=t,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(t){this._isRGBE=t,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),t}(),zo=s((Bo=Wo).prototype,"_envmap",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jo=s(Bo.prototype,"_isRGBE",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ho=s(Bo.prototype,"_enabled",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uo=s(Bo.prototype,"_useIBL",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s(Bo.prototype,"enabled",[p],Object.getOwnPropertyDescriptor(Bo.prototype,"enabled"),Bo.prototype),s(Bo.prototype,"useIBL",[p],Object.getOwnPropertyDescriptor(Bo.prototype,"useIBL"),Bo.prototype),s(Bo.prototype,"envmap",[p,Mo],Object.getOwnPropertyDescriptor(Bo.prototype,"envmap"),Bo.prototype),s(Bo.prototype,"isRGBE",[p],Object.getOwnPropertyDescriptor(Bo.prototype,"isRGBE"),Bo.prototype),Lo=Bo))||Lo);o.SkyboxInfo=Iu;var Pu=(Vo=i("cc.FogInfo"),Go=Y(Ae),Yo=ht(),qo=Y(ot),Xo=lt(),Zo=pt(),$o=nt(),Jo=ht(),Ko=Y(ot),Qo=pt(),ta=nt(),ea=ht(),ia=Y(ot),ra=pt(),na=nt(),sa=ht(),oa=Y(ot),aa=_t(),ua=pt(),ca=nt(),ha=ht(),la=Y(ot),pa=pt(),_a=nt(),fa=ht(),da=Y(ot),ga=pt(),va=nt(),Vo((Ia=Ra=function(){function t(){c(this,"_type",ba,this),c(this,"_fogColor",wa,this),c(this,"_enabled",Aa,this),c(this,"_fogDensity",Ta,this),c(this,"_fogStart",Ea,this),c(this,"_fogEnd",Ca,this),c(this,"_fogAtten",Sa,this),c(this,"_fogTop",Da,this),c(this,"_fogRange",Oa,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},x(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),Ra.FogType=Ae,ba=s((ya=Ia).prototype,"_type",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ae.LINEAR}}),wa=s(ya.prototype,"_fogColor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O("#C8C8C8")}}),Aa=s(ya.prototype,"_enabled",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ta=s(ya.prototype,"_fogDensity",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Ea=s(ya.prototype,"_fogStart",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Ca=s(ya.prototype,"_fogEnd",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),Sa=s(ya.prototype,"_fogAtten",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Da=s(ya.prototype,"_fogTop",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),Oa=s(ya.prototype,"_fogRange",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),s(ya.prototype,"enabled",[p],Object.getOwnPropertyDescriptor(ya.prototype,"enabled"),ya.prototype),s(ya.prototype,"fogColor",[p],Object.getOwnPropertyDescriptor(ya.prototype,"fogColor"),ya.prototype),s(ya.prototype,"type",[p,Go],Object.getOwnPropertyDescriptor(ya.prototype,"type"),ya.prototype),s(ya.prototype,"fogDensity",[Yo,qo,Xo,Zo,at,$o],Object.getOwnPropertyDescriptor(ya.prototype,"fogDensity"),ya.prototype),s(ya.prototype,"fogStart",[Jo,Ko,Qo,ta],Object.getOwnPropertyDescriptor(ya.prototype,"fogStart"),ya.prototype),s(ya.prototype,"fogEnd",[ea,ia,ra,na],Object.getOwnPropertyDescriptor(ya.prototype,"fogEnd"),ya.prototype),s(ya.prototype,"fogAtten",[sa,oa,aa,ua,ca],Object.getOwnPropertyDescriptor(ya.prototype,"fogAtten"),ya.prototype),s(ya.prototype,"fogTop",[ha,la,pa,_a],Object.getOwnPropertyDescriptor(ya.prototype,"fogTop"),ya.prototype),s(ya.prototype,"fogRange",[fa,da,ga,va],Object.getOwnPropertyDescriptor(ya.prototype,"fogRange"),ya.prototype),ma=ya))||ma),ku=(Pa=i("cc.ShadowsInfo"),ka=Y(Te),Fa=ht(),xa=Y(ot),Na=ht(),Ma=Y(Ee),La=ht(),Ba=Y(ut),za=ht(),ja=Y(ot),Ha=ht(),Ua=Y(ot),Wa=ht(),Va=Y(ot),Ga=ht(),Ya=Y(ct),qa=ht(),Xa=ht(),Za=Y(ot),$a=ht(),Ja=Y(ot),Ka=ht(),Pa((du=function(){function t(){c(this,"_type",eu,this),c(this,"_enabled",iu,this),c(this,"_normal",ru,this),c(this,"_distance",nu,this),c(this,"_shadowColor",su,this),c(this,"_autoAdapt",ou,this),c(this,"_pcf",au,this),c(this,"_bias",uu,this),c(this,"_near",cu,this),c(this,"_far",hu,this),c(this,"_aspect",lu,this),c(this,"_orthoSize",pu,this),c(this,"_maxReceived",_u,this),c(this,"_size",fu,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(Ou),this.normal=C.transformQuat(Du,Su,Ou),t.getWorldPosition(Du),this.distance=C.dot(this._normal,Du)},e.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},x(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(t){this._type=t,this._resource&&(this._resource.type=t)},get:function(){return this._type}},{key:"shadowColor",set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)},get:function(){return this._shadowColor}},{key:"normal",set:function(t){C.copy(this._normal,t),this._resource&&(this._resource.normal=t)},get:function(){return this._normal}},{key:"distance",set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)},get:function(){return this._distance}},{key:"pcf",set:function(t){this._pcf=t,this._resource&&(this._resource.pcf=t)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(t){this._autoAdapt=t,this._resource&&(this._resource.autoAdapt=t)},get:function(){return this._autoAdapt}},{key:"near",set:function(t){this._near=t,this._resource&&(this._resource.near=t)},get:function(){return this._near}},{key:"far",set:function(t){this._far=t,this._resource&&(this._resource.far=t)},get:function(){return this._far}},{key:"orthoSize",set:function(t){this._orthoSize=t,this._resource&&(this._resource.orthoSize=t)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(t){this._size.set(t),this._resource&&(this._resource.size=t,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(t){this._aspect=t,this._resource&&(this._resource.aspect=t)},get:function(){return this._aspect}},{key:"bias",set:function(t){this._bias=t,this._resource&&(this._resource.bias=t)},get:function(){return this._bias}}]),t}(),eu=s((tu=du).prototype,"_type",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Te.Planar}}),iu=s(tu.prototype,"_enabled",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ru=s(tu.prototype,"_normal",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C(0,1,0)}}),nu=s(tu.prototype,"_distance",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),su=s(tu.prototype,"_shadowColor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0,76)}}),ou=s(tu.prototype,"_autoAdapt",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),au=s(tu.prototype,"_pcf",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ee.HARD}}),uu=s(tu.prototype,"_bias",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),cu=s(tu.prototype,"_near",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hu=s(tu.prototype,"_far",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),lu=s(tu.prototype,"_aspect",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),pu=s(tu.prototype,"_orthoSize",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),_u=s(tu.prototype,"_maxReceived",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),fu=s(tu.prototype,"_size",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new E(512,512)}}),s(tu.prototype,"enabled",[p],Object.getOwnPropertyDescriptor(tu.prototype,"enabled"),tu.prototype),s(tu.prototype,"type",[p,ka],Object.getOwnPropertyDescriptor(tu.prototype,"type"),tu.prototype),s(tu.prototype,"shadowColor",[p],Object.getOwnPropertyDescriptor(tu.prototype,"shadowColor"),tu.prototype),s(tu.prototype,"normal",[Fa],Object.getOwnPropertyDescriptor(tu.prototype,"normal"),tu.prototype),s(tu.prototype,"distance",[xa,Na],Object.getOwnPropertyDescriptor(tu.prototype,"distance"),tu.prototype),s(tu.prototype,"pcf",[Ma,La],Object.getOwnPropertyDescriptor(tu.prototype,"pcf"),tu.prototype),s(tu.prototype,"autoAdapt",[Ba,za],Object.getOwnPropertyDescriptor(tu.prototype,"autoAdapt"),tu.prototype),s(tu.prototype,"near",[ja,Ha],Object.getOwnPropertyDescriptor(tu.prototype,"near"),tu.prototype),s(tu.prototype,"far",[Ua,Wa],Object.getOwnPropertyDescriptor(tu.prototype,"far"),tu.prototype),s(tu.prototype,"orthoSize",[Va,Ga],Object.getOwnPropertyDescriptor(tu.prototype,"orthoSize"),tu.prototype),s(tu.prototype,"maxReceived",[Ya,qa],Object.getOwnPropertyDescriptor(tu.prototype,"maxReceived"),tu.prototype),s(tu.prototype,"shadowMapSize",[Xa],Object.getOwnPropertyDescriptor(tu.prototype,"shadowMapSize"),tu.prototype),s(tu.prototype,"aspect",[Za,$a],Object.getOwnPropertyDescriptor(tu.prototype,"aspect"),tu.prototype),s(tu.prototype,"bias",[Ja,Ka],Object.getOwnPropertyDescriptor(tu.prototype,"bias"),tu.prototype),Qa=tu))||Qa);o.ShadowsInfo=ku;var Fu,xu,Nu,Mu,Lu,Bu=(gu=i("cc.SceneGlobals"),vu=Y(Iu),gu((Eu=function(){function t(){c(this,"ambient",bu,this),c(this,"shadows",wu,this),c(this,"_skybox",Au,this),c(this,"fog",Tu,this)}return t.prototype.activate=function(){var t=o.director.root.pipeline;this.ambient.activate(t.ambient),this.skybox.activate(t.skybox),this.shadows.activate(t.shadows),this.fog.activate(t.fog)},x(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),bu=s((yu=Eu).prototype,"ambient",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ru}}),wu=s(yu.prototype,"shadows",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ku}}),Au=s(yu.prototype,"_skybox",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Iu}}),Tu=s(yu.prototype,"fog",[p,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pu}}),s(yu.prototype,"skybox",[p,vu],Object.getOwnPropertyDescriptor(yu.prototype,"skybox"),yu.prototype),mu=yu))||mu);o.SceneGlobals=Bu;var zu,ju=t("k",i("cc.Scene")((Lu=function(t){function e(e){var i;return i=t.call(this,e)||this,c(i,"autoReleaseAssets",Nu,h(i)),c(i,"_globals",Mu,h(i)),i._renderScene=null,i.dependAssets=null,i._inited=void 0,i._prefabSyncedInLiveReload=!1,i._pos=C.ZERO,i._rot=D.IDENTITY,i._scale=C.ONE,i._mat=P.IDENTITY,i._dirtyFlags=0,i._activeInHierarchy=!1,o.director&&o.director.root&&(i._renderScene=o.director.root.createScene({})),i._inited=!o.game||!o.game._isCloning,i}r(e,t),x(e,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]);var i=e.prototype;return i.destroy=function(){var t=B.prototype.destroy.call(this);if(t)for(var e=this._children,i=0;i<e.length;++i)e[i].active=!1;return o.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},i.addComponent=function(){throw new Error(T(3822))},i._onHierarchyChanged=function(){},i._onBatchCreated=function(){t.prototype._onBatchCreated.call(this);for(var e=this._children.length,i=0;i<e;++i)this._children[i]._onBatchCreated()},i._onBatchRestored=function(){this._onBatchCreated()},i.getPosition=function(t){return C.copy(t||new C,C.ZERO)},i.getRotation=function(t){return D.copy(t||new D,D.IDENTITY)},i.getScale=function(t){return C.copy(t||new C,C.ONE)},i.getWorldPosition=function(t){return C.copy(t||new C,C.ZERO)},i.getWorldRotation=function(t){return D.copy(t||new D,D.IDENTITY)},i.getWorldScale=function(t){return C.copy(t||new C,C.ONE)},i.getWorldMatrix=function(t){return P.copy(t||new P,P.IDENTITY)},i.getWorldRS=function(t){return P.copy(t||new P,P.IDENTITY)},i.getWorldRT=function(t){return P.copy(t||new P,P.IDENTITY)},i.updateWorldTransform=function(){},i._instantiate=function(){},i._load=function(){this._inited||(this._onBatchCreated(),this._inited=!0),this.walk(Se._setScene)},i._activate=function(t){t=!1!==t,o.director._nodeActivator.activateNode(this,t),this._globals.activate()},x(e,[{key:"position",get:function(){return C.ZERO}},{key:"worldPosition",get:function(){return C.ZERO}},{key:"rotation",get:function(){return D.IDENTITY}},{key:"worldRotation",get:function(){return D.IDENTITY}},{key:"scale",get:function(){return C.ONE}},{key:"worldScale",get:function(){return C.ONE}},{key:"eulerAngles",get:function(){return C.ZERO}},{key:"worldMatrix",get:function(){return P.IDENTITY}}]),e}(Se),s((xu=Lu).prototype,"globals",[p],Object.getOwnPropertyDescriptor(xu.prototype,"globals"),xu.prototype),Nu=s(xu.prototype,"autoReleaseAssets",[_,p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mu=s(xu.prototype,"_globals",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bu}}),Fu=xu))||Fu);o.Scene=ju,B.Flags.HideInHierarchy;var Hu=t("m",i("cc.PrivateNode")(zu=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e}(De))||zu);o.PrivateNode=Hu;var Uu=ft.fastRemoveAt,Wu=B.Flags.IsStartCalled,Vu=B.Flags.IsOnEnableCalled;function Gu(t,e){for(var i=e.constructor._executionOrder,r=e._id,n=0,s=t.length-1,o=s>>>1;n<=s;o=n+s>>>1){var a=t[o],u=a.constructor._executionOrder;if(u>i)s=o-1;else if(u<i)n=o+1;else{var c=a._id;if(c>r)s=o-1;else{if(!(c<r))return o;n=o+1}}}return~n}function Yu(t,e){for(var i=t.array,r=t.i+1;r<i.length;){var n=i[r];n._enabled&&n.node._activeInHierarchy?++r:(t.removeAt(r),e&&(n._objFlags&=~e))}}B.Flags.IsEditorOnEnableCalled;var qu=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=dt;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function Xu(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}qu.stableRemoveInactive=Yu;var Zu=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var i=e.prototype;return i.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},i.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},i.cancelInactive=function(t){Yu(this._zero,t),Yu(this._neg,t),Yu(this._pos,t)},i.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(Xu),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(Xu),this._invoke(e),e.array.length=0)},e}(qu),$u=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var i=e.prototype;return i.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var i=e<0?this._neg.array:this._pos.array,r=Gu(i,t);r<0&&i.splice(~r,0,t)}},i.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var i=e<0?this._neg:this._pos,r=Gu(i.array,t);r>=0&&i.removeAt(r)}},i.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}(qu);function Ju(t,e,i){return function(r,n){try{e(r,n)}catch(e){o._throw(e);var s=r.array;for(i&&(s[r.i]._objFlags|=i),++r.i;r.i<s.length;++r.i)try{t(s[r.i],n)}catch(t){o._throw(t),i&&(s[r.i]._objFlags|=i)}}}}var Ku=Ju((function(t){t.start(),t._objFlags|=Wu}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];i.start(),i._objFlags|=Wu}}),Wu),Qu=Ju((function(t,e){t.update(e)}),(function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].update(e)})),tc=Ju((function(t,e){t.lateUpdate(e)}),(function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].lateUpdate(e)})),ec=function(t){var e=o.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var r=i[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||e._onEnabled(r))}},ic=function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new Zu(Ku),this.updateInvoker=new $u(Qu),this.lateUpdateInvoker=new $u(tc),this._updating=!1},e._onEnabled=function(t){o.director.getScheduler().resumeTarget(t),t._objFlags|=Vu,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){o.director.getScheduler().pauseTarget(t),t._objFlags&=~Vu;var e=this._deferredComps.indexOf(t);e>=0?Uu(this._deferredComps,e):(!t.start||t._objFlags&Wu||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&Vu)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&Vu&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&Wu||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,i=t.length;e<i;e++)this._scheduleImmediate(t[e]);t.length=0},t}(),rc=B.Flags.IsPreloadStarted,nc=B.Flags.IsOnLoadStarted,sc=B.Flags.IsOnLoadCalled,oc=B.Flags.Deactivating,ac=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var i=e.prototype;return i.add=function(t){this._zero.array.push(t)},i.remove=function(t){this._zero.fastRemove(t)},i.cancelInactive=function(t){qu.stableRemoveInactive(this._zero,t)},i.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(qu),uc=Ju((function(t){t.__preload()}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].__preload()})),cc=Ju((function(t){t.onLoad(),t._objFlags|=sc}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];i.onLoad(),i._objFlags|=sc}}),sc),hc=new d(4);function lc(t,e,i){e?t._removeComponent(e):ft.removeAt(t._components,i)}hc.get=function(){var t=this._get()||{preload:new ac(uc),onLoad:new Zu(cc),onEnable:new Zu(ec)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var pc,_c,fc,dc,gc,vc,mc,yc,bc,wc,Ac,Tc,Ec,Cc,Sc,Dc,Oc,Rc,Ic,Pc,kc,Fc,xc,Nc,Mc,Lc,Bc,zc,jc,Hc,Uc,Wc,Vc,Gc,Yc,qc,Xc,Zc,$c,Jc=t("N",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var i=hc.get();this._activatingStack.push(i),this._activateNodeRecursively(t,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),hc.put(i)}else{this._deactivateNodeRecursively(t);for(var r,n=this._activatingStack,s=L(n);!(r=s()).done;){var o=r.value;o.preload.cancelInactive(rc),o.onLoad.cancelInactive(nc),o.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},e.activateComp=function(t,e,i,r){if(gt(t,!0)&&(t._objFlags&rc||(t._objFlags|=rc,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&nc||(t._objFlags|=nc,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=sc):t._objFlags|=sc),t._enabled)){if(!t.node._activeInHierarchy)return;o.director._compScheduler.enableComp(t,r)}},e.destroyComp=function(t){o.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&sc&&t.onDestroy()},e._activateNodeRecursively=function(t,e,i,r){if(t._objFlags&oc)k(3816,t.name);else{t._activeInHierarchy=!0;for(var n=t._components.length,s=0;s<n;++s){var a=t._components[s];a instanceof o.Component?this.activateComp(a,e,i,r):(lc(t,a,s),--s,--n)}t._childArrivalOrder=t._children.length;for(var u=0,c=t._children.length;u<c;++u){var h=t._children[u];h._active&&this._activateNodeRecursively(h,e,i,r)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=oc,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var r=t._components[i];if(r._enabled&&(o.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~oc)}for(var n=0,s=t._children.length;n<s;++n){var a=t._children[n];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),t._activeInHierarchy))return void(t._objFlags&=~oc)}t._onPostActivated(!1),t._objFlags&=~oc},t}());Z(Se.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),Z(De.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new E),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new R),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setContentSize(t,e)}}]),$(De.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),$(ge,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),Z(ge,"Layers",[{name:"Default",newName:"DEFAULT",target:ge.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:ge.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:ge.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:ge.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:ge.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:ge.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:ge.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:ge.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:ge,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:ge,targetName:"Layers"}]),$(ge.Enum,"Layers.Enum",[{name:"ALWAYS"}]),$(ge.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var Kc,Qc,th=new C;function eh(t){return t instanceof ju?Re:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:R.ZERO}function ih(t,e,i,r){for(var n=t.parent?t.parent.getScale():th,s=n.x,o=n.y,a=0,u=0,c=t.parent;;){if(!c)return i.x=i.y=0,void(r.x=r.y=1);var h=c.getPosition();if(a+=h.x,u+=h.y,(c=c.parent)===e)break;var l=(n=c?c.getScale():th).x,p=n.y;a*=l,u*=p,s*=l,o*=p}r.x=0!==s?1/s:1,r.y=0!==o?1/o:1,i.x=-a,i.y=-u}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(Kc||(Kc=t("z",{}))),vt(Kc),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(Qc||(Qc=t("K",{})));var rh,nh,sh,oh,ah,uh,ch,hh,lh,ph,_h,fh,dh,gh,vh,mh,yh,bh,wh,Ah,Th,Eh,Ch,Sh=Qc.TOP|Qc.BOT,Dh=Qc.LEFT|Qc.RIGHT,Oh=t("W",(pc=i("cc.Widget"),_c=it(),fc=Pe(110),dc=rt(),gc=ke(Ie),vc=Y(De),mc=st(),yc=st(),bc=st(),wc=st(),Ac=st(),Tc=st(),Ec=st(),Cc=ht(),Sc=ht(),Dc=Y(Kc),Oc=st(),pc(Rc=_c(Rc=fc(Rc=dc(Rc=gc(Rc=tt(($c=Zc=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastPos=new C,e._lastSize=new R,e._dirty=!0,c(e,"_alignFlags",Pc,h(e)),c(e,"_target",kc,h(e)),c(e,"_left",Fc,h(e)),c(e,"_right",xc,h(e)),c(e,"_top",Nc,h(e)),c(e,"_bottom",Mc,h(e)),c(e,"_horizontalCenter",Lc,h(e)),c(e,"_verticalCenter",Bc,h(e)),c(e,"_isAbsLeft",zc,h(e)),c(e,"_isAbsRight",jc,h(e)),c(e,"_isAbsTop",Hc,h(e)),c(e,"_isAbsBottom",Uc,h(e)),c(e,"_isAbsHorizontalCenter",Wc,h(e)),c(e,"_isAbsVerticalCenter",Vc,h(e)),c(e,"_originalWidth",Gc,h(e)),c(e,"_originalHeight",Yc,h(e)),c(e,"_alignMode",qc,h(e)),c(e,"_lockFlags",Xc,h(e)),e}r(e,t);var i=e.prototype;return i.updateAlignment=function(){o._widgetManager.updateAlignment(this.node)},i._validateTargetInDEV=function(){},i.setDirty=function(){this._recursiveDirty()},i.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),o._widgetManager.add(this),this._registerEvent(),this._registerTargetEvents()},i.onDisable=function(){o._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},i.onDestroy=function(){this._removeParentEvent()},i._adjustWidgetToAllowMovingInEditor=function(t){if(t&ve.POSITION&&!o._widgetManager.isAligning){var e=this.node.getPosition(),i=this._lastPos,r=new C(e);r.subtract(i);var n=this.node.parent,s=new C(1,1,1);if(this.target&&(n=this.target,ih(this.node,n,new C,s)),n){var a=eh(n),u=new C;0!==a.width&&0!==a.height&&C.set(u,r.x/a.width,r.y/a.height,u.z),this.isAlignTop&&(this._top-=(this._isAbsTop?r.y:u.y)*s.y),this.isAlignBottom&&(this._bottom+=(this._isAbsBottom?r.y:u.y)*s.y),this.isAlignLeft&&(this._left+=(this._isAbsLeft?r.x:u.x)*s.x),this.isAlignRight&&(this._right-=(this._isAbsRight?r.x:u.x)*s.x),this.isAlignHorizontalCenter&&(this._horizontalCenter+=(this._isAbsHorizontalCenter?r.x:u.x)*s.x),this.isAlignVerticalCenter&&(this._verticalCenter+=(this._isAbsVerticalCenter?r.y:u.y)*s.y),this._recursiveDirty()}}},i._adjustWidgetToAllowResizingInEditor=function(){if(!o._widgetManager.isAligning){this.setDirty();var t=this.node._uiProps.uiTransformComp,e=t.contentSize,i=this._lastSize,r=new C(e.width-i.width,e.height-i.height,0),n=this.node.parent,s=new C(1,1,1);if(this.target&&(n=this.target,ih(this.node,n,new C,s)),n){var a=eh(n),u=new C;0!==a.width&&0!==a.height&&C.set(u,r.x/a.width,r.y/a.height,u.z);var c=t.anchorPoint;this.isAlignTop&&(this._top-=(this._isAbsTop?r.y:u.y)*(1-c.y)*s.y),this.isAlignBottom&&(this._bottom-=(this._isAbsBottom?r.y:u.y)*c.y*s.y),this.isAlignLeft&&(this._left-=(this._isAbsLeft?r.x:u.x)*c.x*s.x),this.isAlignRight&&(this._right-=(this._isAbsRight?r.x:u.x)*(1-c.x)*s.x),this._recursiveDirty()}}},i._adjustWidgetToAnchorChanged=function(){this.setDirty()},i._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents()},i._registerEvent=function(){this.node.on(Oe.TRANSFORM_CHANGED,this._adjustWidgetToAllowMovingInEditor,this),this.node.on(Oe.SIZE_CHANGED,this._adjustWidgetToAllowResizingInEditor,this),this.node.on(Oe.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(Oe.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._unregisterEvent=function(){this.node.off(Oe.TRANSFORM_CHANGED,this._adjustWidgetToAllowMovingInEditor,this),this.node.off(Oe.SIZE_CHANGED,this._adjustWidgetToAllowResizingInEditor,this),this.node.off(Oe.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},i._removeParentEvent=function(){this.node.off(Oe.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var i=this.node.parent&&this.node.parent._uiProps,r=i&&i.uiTransformComp,n=r?r.contentSize:Re;this.isAlignLeft&&t===Qc.LEFT?this._left=e?this._left*n.width:this._left/n.width:this.isAlignRight&&t===Qc.RIGHT?this._right=e?this._right*n.width:this._right/n.width:this.isAlignHorizontalCenter&&t===Qc.CENTER?this._horizontalCenter=e?this._horizontalCenter*n.width:this._horizontalCenter/n.width:this.isAlignTop&&t===Qc.TOP?this._top=e?this._top*n.height:this._top/n.height:this.isAlignBottom&&t===Qc.BOT?this._bottom=e?this._bottom*n.height:this._bottom/n.height:this.isAbsoluteVerticalCenter&&t===Qc.MID&&(this._verticalCenter=this._verticalCenter/n.height),this._recursiveDirty()}},i._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(Ie)&&(t.on(Oe.TRANSFORM_CHANGED,this._targetChangedOperation,this),t.on(Oe.SIZE_CHANGED,this._targetChangedOperation,this))},i._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(Oe.TRANSFORM_CHANGED,this._targetChangedOperation,this),t.off(Oe.SIZE_CHANGED,this._targetChangedOperation,this))},i._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(Oe.TRANSFORM_CHANGED,this._targetChangedOperation,this),e.off(Oe.SIZE_CHANGED,this._targetChangedOperation,this))},i._targetChangedOperation=function(){this.alignMode===Kc.ALWAYS&&this._recursiveDirty()},i._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&Dh)>0,r=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=r.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=r.height))):(i?this.isStretchWidth&&(r.width=this._originalWidth):this.isStretchHeight&&(r.height=this._originalHeight),this._alignFlags&=~t)}},i._recursiveDirty=function(){this._dirty||(this._dirty=!0)},x(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&Qc.TOP)>0},set:function(t){this._setAlign(Qc.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&Qc.BOT)>0},set:function(t){this._setAlign(Qc.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&Qc.LEFT)>0},set:function(t){this._setAlign(Qc.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&Qc.RIGHT)>0},set:function(t){this._setAlign(Qc.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&Qc.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=Qc.MID):this._alignFlags&=~Qc.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&Qc.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=Qc.CENTER):this._alignFlags&=~Qc.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&Dh)===Dh}},{key:"isStretchHeight",get:function(){return(this._alignFlags&Sh)===Sh}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(Qc.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(Qc.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(Qc.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(Qc.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(Qc.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(Qc.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(l),Zc.AlignMode=Kc,s((Ic=$c).prototype,"target",[vc,mc],Object.getOwnPropertyDescriptor(Ic.prototype,"target"),Ic.prototype),s(Ic.prototype,"isAlignTop",[yc],Object.getOwnPropertyDescriptor(Ic.prototype,"isAlignTop"),Ic.prototype),s(Ic.prototype,"isAlignBottom",[bc],Object.getOwnPropertyDescriptor(Ic.prototype,"isAlignBottom"),Ic.prototype),s(Ic.prototype,"isAlignLeft",[wc],Object.getOwnPropertyDescriptor(Ic.prototype,"isAlignLeft"),Ic.prototype),s(Ic.prototype,"isAlignRight",[Ac],Object.getOwnPropertyDescriptor(Ic.prototype,"isAlignRight"),Ic.prototype),s(Ic.prototype,"isAlignVerticalCenter",[Tc],Object.getOwnPropertyDescriptor(Ic.prototype,"isAlignVerticalCenter"),Ic.prototype),s(Ic.prototype,"isAlignHorizontalCenter",[Ec],Object.getOwnPropertyDescriptor(Ic.prototype,"isAlignHorizontalCenter"),Ic.prototype),s(Ic.prototype,"isStretchWidth",[Cc],Object.getOwnPropertyDescriptor(Ic.prototype,"isStretchWidth"),Ic.prototype),s(Ic.prototype,"isStretchHeight",[Sc],Object.getOwnPropertyDescriptor(Ic.prototype,"isStretchHeight"),Ic.prototype),s(Ic.prototype,"editorTop",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"editorTop"),Ic.prototype),s(Ic.prototype,"editorBottom",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"editorBottom"),Ic.prototype),s(Ic.prototype,"editorLeft",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"editorLeft"),Ic.prototype),s(Ic.prototype,"editorRight",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"editorRight"),Ic.prototype),s(Ic.prototype,"editorHorizontalCenter",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"editorHorizontalCenter"),Ic.prototype),s(Ic.prototype,"editorVerticalCenter",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"editorVerticalCenter"),Ic.prototype),s(Ic.prototype,"isAbsoluteTop",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"isAbsoluteTop"),Ic.prototype),s(Ic.prototype,"isAbsoluteBottom",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"isAbsoluteBottom"),Ic.prototype),s(Ic.prototype,"isAbsoluteLeft",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"isAbsoluteLeft"),Ic.prototype),s(Ic.prototype,"isAbsoluteRight",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"isAbsoluteRight"),Ic.prototype),s(Ic.prototype,"isAbsoluteHorizontalCenter",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"isAbsoluteHorizontalCenter"),Ic.prototype),s(Ic.prototype,"isAbsoluteVerticalCenter",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"isAbsoluteVerticalCenter"),Ic.prototype),s(Ic.prototype,"alignMode",[Dc,Oc],Object.getOwnPropertyDescriptor(Ic.prototype,"alignMode"),Ic.prototype),s(Ic.prototype,"alignFlags",[p],Object.getOwnPropertyDescriptor(Ic.prototype,"alignFlags"),Ic.prototype),Pc=s(Ic.prototype,"_alignFlags",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kc=s(Ic.prototype,"_target",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fc=s(Ic.prototype,"_left",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xc=s(Ic.prototype,"_right",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nc=s(Ic.prototype,"_top",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mc=s(Ic.prototype,"_bottom",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lc=s(Ic.prototype,"_horizontalCenter",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bc=s(Ic.prototype,"_verticalCenter",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zc=s(Ic.prototype,"_isAbsLeft",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),jc=s(Ic.prototype,"_isAbsRight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Hc=s(Ic.prototype,"_isAbsTop",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Uc=s(Ic.prototype,"_isAbsBottom",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Wc=s(Ic.prototype,"_isAbsHorizontalCenter",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Vc=s(Ic.prototype,"_isAbsVerticalCenter",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Gc=s(Ic.prototype,"_originalWidth",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yc=s(Ic.prototype,"_originalHeight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qc=s(Ic.prototype,"_alignMode",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kc.ON_WINDOW_RESIZE}}),Xc=s(Ic.prototype,"_lockFlags",[_,f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rc=Ic))||Rc)||Rc)||Rc)||Rc)||Rc)||Rc));o.internal.computeInverseTransForTarget=ih,o.internal.getReadonlyNodeSize=eh;var Rh,Ih=new C,Ph=U({SOLID_COLOR:de.ALL,DEPTH_ONLY:de.DEPTH_STENCIL,DONT_CLEAR:de.NONE}),kh=U({OVERLAY:0,INTERSPERSE:1}),Fh=t("R",(rh=i("cc.Canvas"),nh=it(),sh=Pe(100),oh=ke(Ie),ah=rt(),uh=Y(Ph),ch=st(),hh=st(),lh=Y(kh),ph=st(),_h=st(),fh=Y(oe),dh=st(),gh=Y(Ph),vh=Y(kh),rh(mh=nh(mh=sh(mh=oh(mh=ah(mh=tt(mh=Fe((Ch=function(t){function e(){var e;return e=t.call(this)||this,c(e,"_priority",bh,h(e)),c(e,"_targetTexture",wh,h(e)),c(e,"_clearFlag",Ah,h(e)),c(e,"_color",Th,h(e)),c(e,"_renderMode",Eh,h(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._camera=null,e._pos=new C,e._thisOnCameraResized=e._onResizeCamera.bind(h(e)),e}r(e,t),x(e,[{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t,this._camera&&(this._camera.clearFlag=this._clearFlag)}},{key:"color",get:function(){return this._color},set:function(t){O.copy(this._color,t),this._camera&&(this._camera.clearColor=t)}},{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._camera&&(this._camera.priority=this._getViewPriority())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=this._getViewPriority()),o.director.root&&o.director.root.ui&&o.director.root.ui.sortScreens()}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var e=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(e),this._updateTargetTexture()}}},{key:"visibility",get:function(){return this._camera?this._camera.view.visibility:-1}},{key:"camera",get:function(){return this._camera}}]);var i=e.prototype;return i.__preload=function(){var t=this.getComponent(Oh);t&&t.updateAlignment();var e=new De("UICamera_"+this.node.name);e.setPosition(0,0,1e3),this._camera=o.director.root.createCamera(),this._camera.initialize({name:"ui_"+this.node.name,node:e,projection:Co.ProjectionType.ORTHO,priority:this._getViewPriority(),flows:["UIFlow"]}),this._camera.fov=45,this._camera.clearFlag=this.clearFlag,this._camera.farClip=2e3,this._camera.viewport=new I(0,0,1,1),this.color=this._color,this._checkTargetTextureEvent(null),this._updateTargetTexture(),this.node.on(Oe.TRANSFORM_CHANGED,this._thisOnCameraResized),o.director.root.ui.addScreen(this)},i.onEnable=function(){this._camera&&o.director.root.ui.renderScene.addCamera(this._camera)},i.onDisable=function(){this._camera&&o.director.root.ui.renderScene.removeCamera(this._camera)},i.onDestroy=function(){o.director.root.ui.removeScreen(this),this._camera&&o.director.root.destroyCamera(this._camera),this._targetTexture&&this._targetTexture.off("resize"),this.node.off(Oe.TRANSFORM_CHANGED,this._thisOnCameraResized)},i._onResizeCamera=function(){var t=this._camera;if(t){if(this._targetTexture){var e=this._targetTexture.window;t.setFixedSize(e.width,e.height),t.orthoHeight=Re.height/2}else{var i=xe.canvas;t.resize(i.width,i.height),t.orthoHeight=xe.canvas.height/ye.getScaleY()/2}this.node.getWorldPosition(Ih),t.node.setPosition(Ih.x,Ih.y,1e3),t.update()}},i._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},i._updateTargetTexture=function(){if(this._camera){var t=this._camera;if(this._targetTexture){var e=this._targetTexture.window;t.changeTargetWindow(e),t.orthoHeight=Re.height/2,t.isWindowSize=!1}else t.changeTargetWindow(),t.orthoHeight=xe.canvas.height/ye.getScaleY()/2,t.isWindowSize=!0}},i._getViewPriority=function(){return this._renderMode===kh.OVERLAY?this._priority|1<<30:this._priority},e}(l),s((yh=Ch).prototype,"clearFlag",[uh,ch],Object.getOwnPropertyDescriptor(yh.prototype,"clearFlag"),yh.prototype),s(yh.prototype,"color",[hh],Object.getOwnPropertyDescriptor(yh.prototype,"color"),yh.prototype),s(yh.prototype,"renderMode",[lh,ph],Object.getOwnPropertyDescriptor(yh.prototype,"renderMode"),yh.prototype),s(yh.prototype,"priority",[_h],Object.getOwnPropertyDescriptor(yh.prototype,"priority"),yh.prototype),s(yh.prototype,"targetTexture",[fh,dh],Object.getOwnPropertyDescriptor(yh.prototype,"targetTexture"),yh.prototype),bh=s(yh.prototype,"_priority",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wh=s(yh.prototype,"_targetTexture",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ah=s(yh.prototype,"_clearFlag",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ph.DEPTH_ONLY}}),Th=s(yh.prototype,"_color",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0,255)}}),Eh=s(yh.prototype,"_renderMode",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kh.OVERLAY}}),mh=yh))||mh)||mh)||mh)||mh)||mh)||mh)||mh));o.Canvas=Fh;var xh,Nh=t("t",i("cc.UIComponent")(Rh=ke(Ie)(Rh=Pe(110)(Rh=Fe(Rh=tt(Rh=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastParent=null,e}r(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiComp=this},i.onEnable=function(){},i.onDisable=function(){},i.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},i.updateAssembler=function(){},i.postUpdateAssembler=function(){},e}(l))||Rh)||Rh)||Rh)||Rh)||Rh);!function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL"}(xh||(xh=t("s",{})));var Mh,Lh,Bh,zh,jh,Hh,Uh,Wh,Vh,Gh,Yh,qh,Xh,Zh,$h,Jh,Kh,Qh,tl,el,il,rl,nl,sl,ol,al,ul,cl=t("V",function(){function t(){this.stage=xh.DISABLED,this.stageOld=xh.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Ne.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Me.KEEP,zFailOp:Me.KEEP,passOp:Me.KEEP,ref:1}}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(){this.stage=xh.CLEAR},e.enterLevel=function(){this.stage=xh.ENTER_LEVEL},e.enableMask=function(){this.stage=xh.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=xh.DISABLED:this.stage=xh.ENABLED)},e.handleMaterial=function(t,e){if(this.stage!==this.stageOld){var i=this._stencilPattern;if(this.stage===xh.DISABLED)i.stencilTest=!1,i.func=Ne.ALWAYS,i.failOp=Me.KEEP,i.stencilMask=i.writeMask=65535,i.ref=1;else if(i.stencilTest=!0,this.stage===xh.ENABLED)i.func=Ne.EQUAL,i.failOp=Me.KEEP,i.stencilMask=i.ref=this.getStencilRef(),i.writeMask=this.getWriteMask();else if(this.stage===xh.CLEAR){var r=this._maskStack[this._maskStack.length-1];i.func=Ne.NEVER,i.failOp=r.inverted?Me.REPLACE:Me.ZERO,i.writeMask=i.stencilMask=i.ref=this.getWriteMask()}else if(this.stage===xh.ENTER_LEVEL){var n=this._maskStack[this._maskStack.length-1];i.func=Ne.NEVER,i.failOp=n.inverted?Me.ZERO:Me.REPLACE,i.writeMask=i.stencilMask=i.ref=this.getWriteMask()}this.stageOld=this.stage}return this._changed(t.passes[0],e)},e.applyStencil=function(t,e){t.overridePipelineStates({depthStencilState:{stencilTestFront:e.stencilTest,stencilFuncFront:e.func,stencilReadMaskFront:e.stencilMask,stencilWriteMaskFront:e.writeMask,stencilFailOpFront:e.failOp,stencilZFailOpFront:e.zFailOp,stencilPassOpFront:e.passOp,stencilRefFront:e.ref,stencilTestBack:e.stencilTest,stencilFuncBack:e.func,stencilReadMaskBack:e.stencilMask,stencilWriteMaskBack:e.writeMask,stencilFailOpBack:e.failOp,stencilZFailOpBack:e.zFailOp,stencilPassOpBack:e.passOp,stencilRefBack:e.ref}})},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=xh.DISABLED},e._changed=function(t,e){if(e)return e.stencilStage!==this.stage&&(e.stencilStage=this.stage,!0);var i=t.depthStencilState,r=this._stencilPattern;return r.stencilTest!==i.stencilTestFront||r.func!==i.stencilFuncFront||r.failOp!==i.stencilFailOpFront||r.stencilMask!==i.stencilReadMaskFront||r.writeMask!==i.stencilWriteMaskFront||r.ref!==i.stencilRefFront},x(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());cl.sharedManager=null,cl.sharedManager=new cl,vt(Le),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(ul||(ul=t("I",{})));var hl=t("U",(Mh=i("cc.UIRenderable"),Lh=ke(Ie),Bh=ht(),zh=Y(Be),jh=Y(Be),Hh=nt(),Uh=mt(),Wh=ht(),Vh=Y(Le),Gh=nt(),Yh=st(),qh=ht(),Xh=Y(Le),Zh=nt(),$h=st(),Jh=nt(),Kh=st(),Mh(Qh=Lh(Qh=Fe(Qh=tt((al=ol=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,c(e,"_materials",el,h(e)),c(e,"_customMaterial",il,h(e)),e.stencilStage=xh.DISABLED,c(e,"_srcBlendFactor",rl,h(e)),c(e,"_dstBlendFactor",nl,h(e)),c(e,"_color",sl,h(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=ul.ADD_COLOR_AND_TEXTURE,e._blendTemplate={blendState:{targets:[{blendSrc:Le.SRC_ALPHA,blendDst:Le.ONE_MINUS_SRC_ALPHA}]}},e._lastParent=null,e._materialUniformHash=0,e}r(e,t);var i=e.prototype;return i.updateMaterial=function(){if(this._customMaterial)this.setMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc()}},i.updateMaterialUniformHash=function(t,e){for(var i,r,n=t.passes,s="",o=!1,a=0;a<n.length;a++)if(i=n[a],e||i.rootBufferDirty){o=!0;for(var u=i.blocks,c=0;c<i.blocks.length;c++){r=u[c];for(var h=0;h<r.length;h++)s+=r[h]+","}}return o&&(this._materialUniformHash=re(s,666)),this._materialUniformHash},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(Oe.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(Oe.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender(),this.updateMaterialUniformHash(this.getMaterial(0),!0)},i.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender(),this.updateMaterialUniformHash(this.getMaterial(0),!0)},i.onDisable=function(){this.node.off(Oe.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(Oe.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},i.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++)this._materialInstances[t].destroy();this._renderData=null},i.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t&&this._renderFlag){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else t||(this._renderDataFlag=t)},i.requestRenderData=function(){var t=ze.add();return this._renderData=t,t},i.destroyRenderData=function(){this._renderData&&(ze.remove(this._renderData),this._renderData=null)},i.updateAssembler=function(t){this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(t))},i.postUpdateAssembler=function(t){this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},i._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},i._postCanRender=function(){},i._updateColor=function(){this._assembler&&this._assembler.updateColor&&this._assembler.updateColor(this)},i._updateBlendFunc=function(){var t=this.getMaterial(0),e=this._blendTemplate.blendState.targets[0];if(t)return e.blendDst===this._dstBlendFactor&&e.blendSrc===this._srcBlendFactor||(t=this.material,e.blendDst=this._dstBlendFactor,e.blendSrc=this._srcBlendFactor,t.overridePipelineStates(this._blendTemplate,0)),t},i._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i.markForUpdateRenderData()}},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case ul.ADD_COLOR:t=je.get("ui-base-material");break;case ul.GRAYSCALE:t=je.get("ui-sprite-gray-material");break;case ul.USE_ALPHA_SEPARATED:t=je.get("ui-sprite-alpha-sep-material");break;case ul.USE_ALPHA_SEPARATED_AND_GRAY:t=je.get("ui-sprite-gray-alpha-sep-material");break;default:t=je.get("ui-sprite-material")}return t},x(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&n(12001),this._srcBlendFactor},set:function(t){this._customMaterial?n(12001):this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&n(12001),this._dstBlendFactor},set:function(t){this._customMaterial?n(12001):this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"materialUniformHash",get:function(){return this._materialUniformHash}}]),e}(He),ol.BlendState=Le,ol.Assembler=null,ol.PostAssembler=null,el=s((tl=al).prototype,"_materials",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),s(tl.prototype,"sharedMaterials",[N,Bh],Object.getOwnPropertyDescriptor(tl.prototype,"sharedMaterials"),tl.prototype),il=s(tl.prototype,"_customMaterial",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s(tl.prototype,"customMaterial",[jh,Hh,Uh],Object.getOwnPropertyDescriptor(tl.prototype,"customMaterial"),tl.prototype),s(tl.prototype,"srcBlendFactor",[Wh,Vh,Gh,Yh],Object.getOwnPropertyDescriptor(tl.prototype,"srcBlendFactor"),tl.prototype),s(tl.prototype,"dstBlendFactor",[qh,Xh,Zh,$h],Object.getOwnPropertyDescriptor(tl.prototype,"dstBlendFactor"),tl.prototype),s(tl.prototype,"color",[Jh,Kh],Object.getOwnPropertyDescriptor(tl.prototype,"color"),tl.prototype),rl=s(tl.prototype,"_srcBlendFactor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Le.SRC_ALPHA}}),nl=s(tl.prototype,"_dstBlendFactor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Le.ONE_MINUS_SRC_ALPHA}}),sl=s(tl.prototype,"_color",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O.WHITE.clone()}}),Qh=tl))||Qh)||Qh)||Qh)||Qh));$(Nh.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),o.UITransformComponent=Ie,yt.setClassAlias(Ie,"cc.UITransformComponent"),yt.setClassAlias(hl,"cc.RenderComponent"),o.CanvasComponent=Fh,yt.setClassAlias(Fh,"cc.CanvasComponent");var ll=t("q",[new Ue(We.ATTR_POSITION,Ve.RGB32F)]),pl=t("v",[new Ue(We.ATTR_POSITION,Ve.RGB32F),new Ue(We.ATTR_COLOR,Ve.RGBA32F)]),_l=t("w",[new Ue(We.ATTR_POSITION,Ve.RGB32F),new Ue(We.ATTR_TEX_COORD,Ve.RG32F),new Ue(We.ATTR_COLOR,Ve.RGBA32F)]),fl=t("Y",[new Ue(We.ATTR_POSITION,Ve.RGB32F),new Ue(We.ATTR_TEX_COORD,Ve.RG32F),new Ue(We.ATTR_COLOR,Ve.RGBA32F),new Ue(We.ATTR_COLOR2,Ve.RGBA32F)]);function dl(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=Ge[r.format].count}return e}function gl(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=Ge[r.format].size}return e}t("X",Object.freeze({__proto__:null,vfmt:ll,vfmtPosColor:pl,vfmtPosUvColor:_l,vfmtPosUvTwoColor:fl,getAttributeFormatBytes:dl,getAttributeStride:gl}));var vl=t("x",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}x(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}}]);var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=dl(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var r=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new Ye(qe.VERTEX|qe.TRANSFER_DST,Xe.HOST|Xe.DEVICE,r,r)));var n=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new Ye(qe.INDEX|qe.TRANSFER_DST,Xe.HOST|Xe.DEVICE,n,n))),this._attributes=t,this._iaInfo=new Ze(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,r=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._batcher.autoMergeBatches(),this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var n=this.vData.byteLength,s=this.iData.length;if(i>n||r>s){for(;n<i||s<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)$e.free(this._hInputAssemblers[t]);this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return Je;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push($e.alloc(this._batcher.device,this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++],i=$e.get(e);return i.firstIndex=this.indicesStart,i.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e)}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),r=0,n=e.length;r<n;r++)i[r]=e[r]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,r=0,n=e.length;r<n;r++)i[r]=e[r]},x(t,[{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());vl.OPACITY_OFFSET=8,new P;var ml=function(t){function e(){var e;return(e=t.call(this)||this).type=ai.UI_BATCH,e}r(e,t);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this);var e=new yl;e.initialize(),this._subModels[0]=e;var i=Ke.get(this._handle,Qe.SUB_MODEL_ARRAY);ti.assign(i,0,e.handle)},i.updateTransform=function(){if(this.transform){var t=this.transform;(t.hasChangedFlags||t._dirtyFlags)&&(t.updateWorldTransform(),this._transformUpdated=!0)}},i.updateUBOs=function(t){for(var e=this._subModels,i=0;i<e.length;i++)e[i].update();if(this._updateStamp=t,this._transformUpdated){if(this.transform){var r=this.transform._mat;P.toArray(this._localData,r,ei.MAT_WORLD_OFFSET),this._localBuffer.update(this._localData)}this._transformUpdated=!1}},i.directInitialize=function(t){this._subModels[0].directInitialize(t.material.passes,t.hInputAssembler,t.hDescriptorSet),t.useLocalData&&(this.node=this.transform=t.useLocalData,this._updateAttributesAndBinding(0))},e}(ii),yl=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var i=e.prototype;return i.initialize=function(){this._handle=ri.alloc(),ri.set(this._handle,ni.PRIORITY,si.DEFAULT)},i.directInitialize=function(t,e,i){this._passes=t,this._flushPassInfo(),ri.set(this._handle,ni.INPUT_ASSEMBLER,e),ri.set(this._handle,ni.DESCRIPTOR_SET,i),this._inputAssembler=$e.get(e),this._descriptorSet=oi.get(i)},i.destroy=function(){ri.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=si.DEFAULT,this._handle=Je,this._patches=null,this._subMesh=null,this._passes=null},e}(ui),bl=t("y",function(){function t(){this.bufferBatch=null,this.camera=null,this.model=null,this.material=null,this.texture=null,this.sampler=null,this.hInputAssembler=Je,this.hDescriptorSet=Je,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0}var e=t.prototype;return e.destroy=function(){this.hDescriptorSet&&(this.hDescriptorSet=Je)},e.clear=function(){this.bufferBatch=null,this.hInputAssembler=Je,this.camera=null,this.material=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null},t}()),wl=function(){function t(){this._material=null,this._pass=null,this._hDescriptorSet=Je,this._refCount=0}var e=t.prototype;return e.initialize=function(t){return!!t.material&&(this._material=new Be,this._material.copy(t.material),this._pass=this._material.passes[0],this._pass.update(),this._hDescriptorSet=ci.get(this._pass.handle,hi.DESCRIPTOR_SET),!0)},e.increase=function(){return this._refCount++,this._refCount},e.decrease=function(){return this._refCount--,0===this._refCount&&this.destroy(),this._refCount},e.destroy=function(){this._material&&(this._material.destroy(),this._material=null),this._refCount=0},x(t,[{key:"material",get:function(){return this._material}},{key:"pass",get:function(){return this._pass}},{key:"hDescriptorSet",get:function(){return this._hDescriptorSet}}]),t}(),Al=bt.os===bt.OS_IOS&&bt.isBrowser&&/(iPhone OS 1[4-9])|(Version\/1[4-9][\.\d]*)|(iOS 1[4-9])/.test(window.navigator.userAgent),Tl=new fi(null),El=function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new wt((function(){return new vl(e)}),128),this._drawBatchPool=void 0,this._scene=void 0,this._meshBuffers=new Map,this._meshBufferUseCount=new Map,this._uiMaterials=new Map,this._canvasMaterials=new Map,this._batches=void 0,this._uiModelPool=null,this._modelInUse=void 0,this._emptyMaterial=new Be,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currCanvas=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0,this._parentOpacity=1,this._descriptorSetCacheMap=new Map,this._root=t,this.device=t.device,this._scene=this._root.createScene({name:"GUIScene"}),this._uiModelPool=new At((function(){var t=o.director.root.createModel(ml);return t.enabled=!0,t.visFlags|=ge.Enum.UI_3D,t}),2),this._modelInUse=new Tt(10),this._batches=new Tt(64),this._drawBatchPool=new At((function(){return new bl}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=_l);var e=t===_l?36:gl(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},x(e,[{key:"renderScene",get:function(){return this._scene}},{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}}]),t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var i,r=L(this._meshBuffers.keys());!(i=r()).done;){var n=i.value,s=this._meshBuffers.get(n);s&&s.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._uiModelPool&&this._uiModelPool.destroy((function(t){t.destroy()})),this._descriptorSetCacheMap&&this._destoryDescriptorSet(),this._meshBuffers.clear(),o.director.root.destroyScene(this._scene)},t.getRenderSceneGetter=function(){return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),"renderScene").get.bind(this)},t._getUIMaterial=function(t){if(this._uiMaterials.has(t.hash))return this._uiMaterials.get(t.hash);var e=new wl;return e.initialize({material:t}),this._uiMaterials.set(t.hash,e),e},t._removeUIMaterial=function(t){this._uiMaterials.has(t)&&0===this._uiMaterials.get(t).decrease()&&this._uiMaterials.delete(t)},t.addScreen=function(t){for(var e=this._screens,i=0;i<e.length;i++){var r=e[i];if(r.camera){var n=r.camera.view.visibility,s=this._canvasMaterials.get(n);if(s){for(var o=s.keys(),a=o.next();!a.done;)this._removeUIMaterial(a.value),a=o.next();s.clear()}}}this._screens.push(t),this._screens.sort(this._screenSort);for(var u=0;u<e.length;u++){var c=e[u];c.camera&&(c.camera.view.visibility=ge.BitMask.UI_2D|u+1,this._canvasMaterials.has(c.camera.view.visibility)||this._canvasMaterials.set(c.camera.view.visibility,new Map))}},t.getScreen=function(t){for(var e=this._screens,i=0;i<e.length;++i){var r=e[i];if(r.camera&&r.camera.view.visibility===t)return r}return null},t.removeScreen=function(t){var e=this,i=this._screens.indexOf(t);if(-1!==i){if(this._screens.splice(i,1),t.camera){for(var r=this._canvasMaterials.get(t.camera.view.visibility),n=r.keys(),s=n.next();!s.done;)this._removeUIMaterial(s.value),s=n.next();r.clear()}for(var o,a=i;a<this._screens.length;a++)(o=this._screens[a].camera)&&function(){var t=e._canvasMaterials.get(o.view.visibility);o.view.visibility=ge.BitMask.UI_2D|a+1;var i=e._canvasMaterials.get(o.view.visibility);t.forEach((function(t,e){i.set(e,t)})),t.clear()}()}},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var i=t[e];i.enabledInHierarchy&&(this._currCanvas=i,this._recursiveScreenNode(i.node))}for(var r=0,n=0;n<this._modelInUse.length;n++)this._scene.removeModel(this._modelInUse.get(n)),this._uiModelPool.free(this._modelInUse.get(n));if(this._modelInUse.clear(),this._batches.length)for(var s=0;s<this._batches.length;++s){var o=this._batches.array[s];if(o.model){var a=o.camera||this._scene.cameras[0];if(a){var u=a.view.visibility;o.model.visFlags=u,o.model.node.layer=u}for(var c=o.model.subModels,h=0;h<c.length;h++)c[h].priority=r++}else{var l=this._descriptorSetCacheMap.get(o.textureHash);if(l&&l.has(o.samplerHash))o.hDescriptorSet=l.get(o.samplerHash);else{this._initDescriptorSet(o);var p=oi.get(o.hDescriptorSet),_=li.SAMPLER_SPRITE;p.bindTexture(_,o.texture),p.bindSampler(_,o.sampler),p.update(),l?this._descriptorSetCacheMap.get(o.textureHash).set(o.samplerHash,o.hDescriptorSet):this._descriptorSetCacheMap.set(o.textureHash,new Map([[o.samplerHash,o.hDescriptorSet]]))}var f=this._uiModelPool.alloc();if(f.directInitialize(o),this._scene.addModel(f),f.subModels[0].priority=r++,o.camera){var d=o.camera.view.visibility;f.visFlags=d,null==this._canvasMaterials.get(d).get(o.material.hash)&&this._canvasMaterials.get(d).set(o.material.hash,1)}this._modelInUse.push(f)}}},t.uploadBuffers=function(){if(this._batches.length>0)for(var t,e=this._meshBuffers,i=L(e.keys());!(t=i()).done;){var r=t.value,n=e.get(r);n&&n.forEach((function(t){t.uploadBuffers(),t.reset()}))}for(var s=0;s<this._batches.length;++s){var o=this._batches.array[s];o.isStatic||(o.clear(),this._drawBatchPool.free(o))}this._parentOpacity=1,this._batches.clear(),this._currMaterial=this._emptyMaterial,this._currCanvas=null,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._meshBufferUseCount.clear(),this._currMaterialHash=0,this._currMaterialUniformHash=0,cl.sharedManager.reset()},t.commitComp=function(t,e,i,r){var n,s,o=t,a=0,u=0;e?(n=e.getGFXTexture(),s=e.getGFXSampler(),a=e.getHash(),u=e.getSamplerHash()):(n=null,s=null);var c=o.getRenderMaterial(0),h=c.hash,l=o.updateMaterialUniformHash(c);this._currMaterialHash===h&&this._currMaterialUniformHash===l&&this._currTextureHash===a&&this._currSamplerHash===u&&this._currTransform===r||(this.autoMergeBatches(this._currComponent),this._currComponent=o,this._currTransform=r,this._currMaterial=c,this._currTexture=n,this._currSampler=s,this._currTextureHash=a,this._currSamplerHash=u,this._currMaterialHash=o.getRenderMaterial(0).hash,this._currMaterialUniformHash=o.materialUniformHash),i&&(i.fillBuffers(o,this),this._applyOpacity(o))},t.commitModel=function(t,e,i){if(this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent),i){var r;if(r=t instanceof hl?cl.sharedManager.handleMaterial(i,t):cl.sharedManager.handleMaterial(i)){var n=cl.sharedManager.pattern;cl.sharedManager.applyStencil(i,n)}if(r&&e)for(var s=0;s<e.subModels.length;s++)e.setSubModelMaterial(s,i)}var o=this._currCanvas,a=this._drawBatchPool.alloc();a.camera=o&&o.camera,a.model=e,a.bufferBatch=null,a.material=i,a.texture=null,a.sampler=null,a.useLocalData=null,this._currMaterial=this._emptyMaterial,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0,this._batches.push(a)},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,i=this._currCanvas,r=null==e?void 0:e.recordBatch(),n=this._currMaterial;if(r&&n){if(t){if(cl.sharedManager.handleMaterial(n,t)){this._currMaterial=n=t.material;var s=cl.sharedManager.pattern;cl.sharedManager.applyStencil(n,s)}t.updateMaterialUniformHash(n)}var o=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();o.camera=i&&i.camera,o.bufferBatch=e,o.material=n,o.texture=this._currTexture,o.sampler=this._currSampler,o.hInputAssembler=r,o.useLocalData=this._currTransform,o.textureHash=this._currTextureHash,o.samplerHash=this._currSamplerHash,this._batches.push(o),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,Al&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,i){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this.autoMergeBatches(i)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currMaterialHash=0,this._currMaterialUniformHash=0},t.flushMaterial=function(t){this._currMaterial=t},t._destroyUIMaterials=function(){for(var t=this._uiMaterials.values(),e=t.next();!e.done;)e.value.destroy(),e=t.next();this._uiMaterials.clear()},t.walk=function(t,e){void 0===e&&(e=0);var i=t.children.length,r=this._parentOpacity;if(this._parentOpacity*=t._uiProps.opacity,this._preprocess(t),i>0&&!t._static)for(var n=t.children,s=0;s<n.length;++s){var o=n[s];this.walk(o,e)}this._postprocess(t),this._parentOpacity=r,e+=1},t._preprocess=function(t){if(t._uiProps.uiTransformComp){t._uiProps.uiTransformComp._canvas=this._currCanvas;var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.updateAssembler(this)}},t._postprocess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._requireBufferBatch.bind(this,t));var i=gl(t),r=this._meshBuffers.get(i);return r||(r=[],this._meshBuffers.set(i,r)),r.push(e),e},t._requireBufferBatch=function(t){var e=gl(t),i=this._meshBuffers.get(e);i||(i=[],this._meshBuffers.set(e,i));var r=this._meshBufferUseCount.get(e)||0;r>=i.length?this._currMeshBuffer=this._createMeshBuffer(t):this._currMeshBuffer=i[r],this._meshBufferUseCount.set(e,r+1),2===arguments.length&&this._currMeshBuffer.request(arguments[0],arguments[1])},t._screenSort=function(t,e){var i=t.priority-e.priority;return 0===i?t.node.getSiblingIndex()-e.node.getSiblingIndex():i},t._applyOpacity=function(t){for(var e=t.color.a/255,i=this._parentOpacity*=e,r=this.currBufferBatch,n=r.byteOffset>>2,s=r.vData,o=r.lastByteOffset>>2,a=r.vertexFormatBytes/4,u=o;u<n;u+=a)s[u+vl.OPACITY_OFFSET]*=i;r.lastByteOffset=r.byteOffset},t._initDescriptorSet=function(t){var e=o.director.root,i=pi.get("sprite").shaders[0].name;Tl.layout=_i.getDescriptorSetLayout(e.device,i,!0),t.hDescriptorSet=oi.alloc(e.device,Tl)},t._releaseDescriptorSetCache=function(t){this._descriptorSetCacheMap.has(t)&&(this._descriptorSetCacheMap.get(t).forEach((function(t){oi.free(t)})),this._descriptorSetCacheMap.delete(t))},t._destoryDescriptorSet=function(){this._descriptorSetCacheMap.forEach((function(t){t.forEach((function(t){oi.free(t)}))})),this._descriptorSetCacheMap.clear()},e}(),Cl=function(){function t(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=Je}t.registerCreateFunc=function(e){e._createWindowFun=function(e){return new t(e)}},x(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return bi.get(di.get(this._poolHandle,yi.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===di.get(this._poolHandle,yi.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===di.get(this._poolHandle,yi.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}}]);var e=t.prototype;return e.initialize=function(t,e){this._poolHandle=di.alloc(),void 0!==e.title&&(this._title=e.title),void 0!==e.swapchainBufferIndices&&(this._swapchainBufferIndices=e.swapchainBufferIndices),void 0!==e.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=e.shouldSyncSizeWithSwapchain),this._width=e.width,this._height=e.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=e.renderPassInfo,r=i.colorAttachments,n=i.depthStencilAttachment,s=0;s<r.length;s++)r[s].format===Ve.UNKNOWN&&(r[s].format=t.colorFormat);n&&n.format===Ve.UNKNOWN&&(n.format=t.depthStencilFormat),this._renderPass=t.createRenderPass(e.renderPassInfo);for(var o=0;o<r.length;o++){var a=null;this._swapchainBufferIndices&1<<o?di.set(this._poolHandle,yi.HAS_ON_SCREEN_ATTACHMENTS,1):(a=t.createTexture(new gi(vi.TEX2D,mi.COLOR_ATTACHMENT|mi.SAMPLED,r[o].format,this._width,this._height)),di.set(this._poolHandle,yi.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(a)}n&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=t.createTexture(new gi(vi.TEX2D,mi.DEPTH_STENCIL_ATTACHMENT|mi.SAMPLED,n.format,this._width,this._height)),di.set(this._poolHandle,yi.HAS_OFF_SCREEN_ATTACHMENTS,1)):di.set(this._poolHandle,yi.HAS_ON_SCREEN_ATTACHMENTS,1));var u=bi.alloc(t,new wi(this._renderPass,this._colorTextures,this._depthStencilTexture));return di.set(this._poolHandle,yi.FRAMEBUFFER,u),!0},e.destroy=function(){this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var e=this._colorTextures[t];e&&e.destroy()}this._colorTextures.length=0,this._poolHandle&&(bi.get(di.get(this._poolHandle,yi.FRAMEBUFFER)).destroy(),this._poolHandle=Je)},e.resize=function(t,e){if(this._width=t,this._height=e,t>this._nativeWidth||e>this._nativeHeight){this._nativeWidth=t,this._nativeHeight=e;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(t,e),i=!0);for(var r=0;r<this._colorTextures.length;r++){var n=this._colorTextures[r];n&&(n.resize(t,e),i=!0)}var s=bi.get(di.get(this._poolHandle,yi.FRAMEBUFFER));i&&s&&(s.destroy(),s.initialize(new wi(this._renderPass,this._colorTextures,this._depthStencilTexture)))}},t}(),Sl=function(){function t(t){var e=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._ui=null,this._dataPoolMgr=void 0,this._scenes=[],this._cameras=[],this._views=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=Je,this._device=t,this._dataPoolMgr=new vo(t),Ai.registerCreateFunc(this),Cl.registerCreateFunc(this),this._cameraPool=new At((function(){return new Ti(e._device)}),4)}x(t,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(t){this._curWindow=t},get:function(){return this._curWindow}},{key:"tempWindow",set:function(t){this._tempWindow=t},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"ui",get:function(){return this._ui}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Ei.get(this._poolHandle,Ii.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Ei.get(this._poolHandle,Ii.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(t){t>0?(this._fixedFPS=t,this._fixedFPSFrameTime=1e3/t):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var e=t.prototype;return e.initialize=function(){var t=this;this._poolHandle=Ei.alloc();var e=new Ci,i=new Si;i.depthStoreOp=Di.DISCARD,i.stencilStoreOp=Di.DISCARD;var r=new Oi([e],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:r,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(je.initBuiltinRes(this._device)).then((function(){o.view.on("design-resolution-changed",(function(){var e=o.game.canvas.width,i=o.game.canvas.height;t.resize(e,i)}),t)}))},e.destroy=function(){this.clearCameras(),this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._ui&&(this._ui.destroy(),this._ui=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Ei.free(this._poolHandle),this._poolHandle=Je)},e.resize=function(t,e){this._device.resize(t,e),this._mainWindow.resize(t,e);for(var i,r=L(this._windows);!(i=r()).done;){var n=i.value;n.shouldSyncSizeWithSwapchain&&n.resize(t,e)}for(var s,o=L(this._cameras);!(s=o()).done;){var a=s.value;a.isWindowSize&&a.resize(t,e)}},e.setRenderPipeline=function(t){if(t||(t=this.createDefaultPipeline()),this._pipeline=t,!this._pipeline.activate())return!1;var e=o.director.getScene();return e&&e.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._ui&&(this._ui=new El(this),!this._ui.initialize())&&(this.destroy(),1))},e.createDefaultPipeline=function(){var t=new Ri;return t.initialize({flows:[]}),t},e.onGlobalPipelineStateChanged=function(){for(var t=0;t<this._cameras.length;t++)this._cameras[t].view.onGlobalPipelineStateChanged();for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged()},e.activeWindow=function(t){this._curWindow=t},e.resetCumulativeTime=function(){Ei.set(this._poolHandle,Ii.CUMULATIVE_TIME,0)},e.frameMove=function(t){if(Ei.set(this._poolHandle,Ii.FRAME_TIME,t),++this._frameCount,Ei.set(this._poolHandle,Ii.CUMULATIVE_TIME,Ei.get(this._poolHandle,Ii.CUMULATIVE_TIME)+t),this._fpsTime+=t,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0),this._ui&&this._ui.update(),this._pipeline){this._device.acquire(),this._views.length=0;var e=this._cameras,i=o.director.getTotalFrames();this._ui&&this._ui.uploadBuffers();for(var r=0;r<e.length;r++){var n=this._cameras[r],s=n.view;s.isEnable&&s.window&&(n.update(),n.scene.update(i),this._views.push(s))}this._pipeline.render(this._views),this._device.present()}},e.createWindow=function(t){var e=this._createWindowFun(this);return e.initialize(this.device,t),this._windows.push(e),e},e.destroyWindow=function(t){for(var e=0;e<this._windows.length;++e)if(this._windows[e]===t)return t.destroy(),void this._windows.splice(e,1)},e.destroyWindows=function(){for(var t,e=L(this._windows);!(t=e()).done;)t.value.destroy();this._windows=[]},e.createScene=function(t){var e=this._createSceneFun(this);return e.initialize(t),this._scenes.push(e),e},e.destroyScene=function(t){for(var e=0;e<this._scenes.length;++e)if(this._scenes[e]===t)return t.destroy(),void this._scenes.splice(e,1)},e.destroyScenes=function(){for(var t,e=L(this._scenes);!(t=e()).done;)t.value.destroy();this._scenes=[]},e.createView=function(t){var e=new ki;return e.initialize(t),e},e.attachCamera=function(t){for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]===t)return;this._cameras.push(t),this.sortViews()},e.detachCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return void this._cameras.splice(e,1)},e.clearCameras=function(){this._cameras.length=0},e.createModel=function(t){var e=this._modelPools.get(t);e||(this._modelPools.set(t,new At((function(){return new t}),10)),e=this._modelPools.get(t));var i=e.alloc();return i.initialize(),i},e.destroyModel=function(t){var e=this._modelPools.get(t.constructor);e?(e.free(t),t.destroy(),t.scene&&t.scene.removeModel(t)):console.warn("'"+t.constructor.name+"'is not in the model pool and cannot be destroyed by destroyModel.")},e.createCamera=function(){return this._cameraPool.alloc()},e.destroyCamera=function(t){this._cameraPool.free(t),t.destroy(),t.scene&&t.scene.removeCamera(t),t.isWindowSize=!0},e.createLight=function(t){var e=this._lightPools.get(t);e||(this._lightPools.set(t,new At((function(){return new t}),4)),e=this._lightPools.get(t));var i=e.alloc();return i.initialize(),i},e.destroyLight=function(t){var e=this._lightPools.get(t.constructor);if(t.destroy(),e&&(e.free(t),t.scene))switch(t.type){case Pi.SPHERE:t.scene.removeSphereLight(t);break;case Pi.SPOT:t.scene.removeSpotLight(t)}},e.sortViews=function(){this._cameras.sort((function(t,e){return t.view.priority-e.view.priority}))},t}();o.Root=Sl;var Dl=t("g",function(t){function e(){var e;return(e=t.call(this)||this)._compScheduler=void 0,e._nodeActivator=void 0,e._invalid=void 0,e._paused=void 0,e._purgeDirectorInNextLoop=void 0,e._root=void 0,e._loadingScene=void 0,e._scene=void 0,e._totalFrames=void 0,e._lastUpdate=void 0,e._deltaTime=void 0,e._startTime=void 0,e._scheduler=void 0,e._systems=void 0,e._invalid=!1,e._paused=!1,e._purgeDirectorInNextLoop=!1,e._root=null,e._loadingScene="",e._scene=null,e._totalFrames=0,e._lastUpdate=0,e._deltaTime=0,e._startTime=0,e._scheduler=new Yn,e._compScheduler=new ic,e._nodeActivator=new Jc,e._systems=[],o.game.once(xi.EVENT_RENDERER_INITED,e._initOnRendererInitialized,h(e)),e}r(e,t);var i=e.prototype;return i.calculateDeltaTime=function(t){t||(t=performance.now()),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,this._lastUpdate=t},i.convertToGL=function(t){var e=o.game.container,i=o.view,r=e.getBoundingClientRect(),n=r.left+window.pageXOffset-e.clientLeft,s=r.top+window.pageYOffset-e.clientTop,a=i._devicePixelRatio*(t.x-n),u=i._devicePixelRatio*(s+r.height-t.y);return i._isRotated?Et(i._viewportRect.width-u,a):Et(a,u)},i.convertToUI=function(t){var e=o.game.container,i=o.view,r=e.getBoundingClientRect(),n=r.left+window.pageXOffset-e.clientLeft,s=r.top+window.pageYOffset-e.clientTop,a=Et(0,0);return i._isRotated?(a.x=n+t.y/i._devicePixelRatio,a.y=s+r.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(a.x=n+t.x*i._devicePixelRatio,a.y=s+r.height-t.y*i._devicePixelRatio),a},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return Ct(o.winSize)},i.getWinSizeInPixels=function(){return Ct(o.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){o.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Fi&&Fi.setEnabled(!1),o.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),o.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(e.EVENT_RESET),Fi&&Fi.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(t,e,i){t instanceof $r&&(t=t.scene),J(t instanceof ju,1216),t._load();for(var r=Object.keys(o.game._persistRootNodes).map((function(t){return o.game._persistRootNodes[t]})),n=0;n<r.length;n++){var s=r[n];s.emit(o.Node.SCENE_CHANGED_FOR_PERSISTS,t.renderScene);var a=t.getChildByUuid(s.uuid);if(a){var u=a.getSiblingIndex();a._destroyImmediate(),t.insertChild(s,u)}else s.parent=t}var c=this._scene;o.isValid(c)&&c.destroy(),o.assetManager._releaseManager._autoRelease(c,t,r),this._scene=null,B._deferredDestroy(),e&&e(),this.emit(o.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,t),this.emit(o.Director.EVENT_AFTER_SCENE_LAUNCH,t)},i.runScene=function(t,e,i){var r=this;t instanceof $r&&(t=t.scene),J(t,1205),J(t instanceof ju,1216),t._load(),this.once(o.Director.EVENT_AFTER_DRAW,(function(){r.runSceneImmediate(t,e,i)}))},i.loadScene=function(t,e,i){var r=this;if(this._loadingScene)return n(1208,t,this._loadingScene),!1;var s=o.assetManager.bundles.find((function(e){return e.getSceneInfo(t)}));return s?(this.emit(o.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,console.time("LoadScene "+t),s.loadScene(t,(function(n,s){console.timeEnd("LoadScene "+t),r._loadingScene="",n?(St(n),e&&e(n)):r.runSceneImmediate(s,i,e)})),!0):(k(1209,t),!1)},i.preloadScene=function(t,e,i){var r=o.assetManager.bundles.find((function(e){return e.getSceneInfo(t)}));if(r)r.preloadScene(t,null,e,i);else{var n='Can not preload the scene "'+t+'" because it is not in the build settings.';i&&i(new Error(n)),St("preloadScene: "+n)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||K(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(t){o.Camera.main&&(o.Camera.main.depth=!!t)},i.setClearColor=function(t){o.Camera.main&&(o.Camera.main.backgroundColor=t)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/o.game.getFrameRate()},i.setAnimationInterval=function(t){o.game.setFrameRate(Math.round(1e3/t))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(Yn.ID,t,200))},i.registerSystem=function(t,e,i){e.id=t,e.priority=i,e.init(),this._systems.push(e),this._systems.sort(jn.sortByPriority)},i.unregisterSystem=function(t){ft.fastRemove(this._systems,t),this._systems.sort(jn.sortByPriority)},i.getSystem=function(t){return this._systems.find((function(e){return e.id===t}))},i.getAnimationManager=function(){return this.getSystem(o.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(t){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(t);var i=this._deltaTime;if(!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var r=0;r<this._systems.length;++r)this._systems[r].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(e.EVENT_AFTER_UPDATE),B._deferredDestroy();for(var n=0;n<this._systems.length;++n)this._systems[n].postUpdate(i)}this.emit(e.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(e.EVENT_AFTER_DRAW),Fi.frameUpdateListeners(),De.bookOfChange.clear(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,Fi&&Fi.setEnabled(!0),this.registerSystem(Yn.ID,this._scheduler,200),this.emit(e.EVENT_INIT)},i._init=function(){return this._root=new Sl(o.game._gfxDevice),this._root.initialize({}).catch((function(t){return k(1217),Promise.reject(t)}))},x(e,[{key:"root",get:function(){return this._root}}]),e}(Dt));Dl.EVENT_INIT="director_init",Dl.EVENT_RESET="director_reset",Dl.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",Dl.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",Dl.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",Dl.EVENT_BEFORE_UPDATE="director_before_update",Dl.EVENT_AFTER_UPDATE="director_after_update",Dl.EVENT_BEFORE_DRAW="director_before_draw",Dl.EVENT_AFTER_DRAW="director_after_draw",Dl.EVENT_BEFORE_PHYSICS="director_before_physics",Dl.EVENT_AFTER_PHYSICS="director_after_physics",Dl.instance=void 0,o.Director=Dl;var Ol=t("h",Dl.instance=o.director=new Dl),Rl=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Ot,this.scenes=new Ot,this.paths=new Ot}var e=t.prototype;return e.init=function(t){!function(t){var e=t.uuids,i=t.paths,r=t.types,n=t.deps,s=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,a=e.length;o<a;o++)e[o]=It(e[o]);for(var u in i){var c=i[u],h=c[1];c[1]=r[h]}}else{for(var l=Object.create(null),p=0,_=e.length;p<_;p++){var f=e[p];e[p]=l[f]=It(f)}e=l}for(var d in i){var g=i[d];s[e[d]]=g}var v=t.scenes;for(var m in v){var y=v[m];v[m]=e[y]}var b=t.packs;for(var w in b)for(var A=b[w],T=0;T<A.length;++T)A[T]=e[A[T]];var E=t.versions;if(E)for(var C in E)for(var S=E[C],D=0;D<S.length;D+=2){var O=S[D];S[D]=e[O]||O}var R=t.redirect;if(R)for(var I=0;I<R.length;I+=2)R[I]=e[R[I]],R[I+1]=n[R[I+1]]}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect)},e.getInfoWithPath=function(t,e){if(!t)return null;t=Rt(t);var i=this.paths.get(t);if(i){if(!e)return i[0];for(var r=0,n=i.length;r<n;r++){var s=i[r];if(yt.isChildClassOf(s.ctor,e))return s}}return null},e.getDirWithPath=function(t,e,i){"/"===(t=Rt(t))[t.length-1]&&(t=t.slice(0,-1));var r=i||[];return this.paths.forEach((function(i,n){if(n.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(n,t)||!t)for(var s=0,o=i.length;s<o;s++){var a=i[s];e&&!yt.isChildClassOf(a.ctor,e)||r.push(a)}})),r},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,i){return i.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,i=t.length;e<i;e++){var r=t[e];this.assetInfos.add(r,{uuid:r})}}},e._initPath=function(t){if(t){var e=this.paths;for(var i in e.clear(),t){var r=t[i],n=r[0],s=r[1],o=3===r.length,a=this.assetInfos.get(i);a.path=n,a.ctor=yt._getClassById(s),e.has(n)?o?e.get(n).push(a):e.get(n).splice(0,0,a):e.add(n,[a])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var i=this.assetInfos;for(var r in t){var n=t[r],s=i.get(n);s.url=r,e.add(r,s)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var i in t){var r=t[i],n={uuid:i,packedUuids:r,ext:".json"};e.add(i,n);for(var s=0,o=r.length;s<o;s++){var a=r[s],u=e.get(a),c=u.packs;c?1===o?c.splice(0,0,n):c.push(n):u.packs=[n]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,i=t.import;if(i)for(var r=0,n=i.length;r<n;r+=2){var s=i[r];e.get(s).ver=i[r+1]}if(i=t.native)for(var o=0,a=i.length;o<a;o+=2){var u=i[o];e.get(u).nativeVer=i[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,i=0,r=t.length;i<r;i+=2){var n=t[i];e.get(n).redirect=t[i+1]}},t}();function Il(t,e){var i;i=Xi.safeFindClass;var r,n=tr.pool.get();try{r=pr(t,n,{classFinder:i,customEnv:e})}catch(t){throw console.error(t),tr.pool.put(n),t}r._uuid=e.__uuid__||"";for(var s=n.uuidList,o=n.uuidObjList,a=n.uuidPropList,u=[],c=0;c<s.length;c++){var h=s[c];u[c]={uuid:It(h),owner:o[c],prop:a[c]}}return r.__depends__=u,r._native&&(r.__nativeDepend__=!0),tr.pool.put(n),r}var Pl=new(function(){function t(){this._depends=new Ot}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?Object.assign({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),i=[];return this._descend(t,e,i),i},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var i,r,n=null;if(Array.isArray(e)||e.__type__){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(r=(i=e[5])[i.length-1])&&r<0)try{var s=Il(e,{__uuid__:t});(n=this._parseDepsFromAsset(s)).nativeDep&&(n.nativeDep.uuid=t),Pt.add(t+"@import",s)}catch(e){kt.remove(t+"@import"),n={deps:[]}}else n={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(n=this._depends.get(t)).parsedFromExistAsset)return n;n=this._parseDepsFromAsset(e)}return this._depends.add(t,n),n},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:t.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:t.constructor.preventDeferredLoadDependents},i=t.__depends__,r=0,n=i.length;r<n;r++)e.deps.push(i[r].uuid);return t.__nativeDepend__&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=null;return(e=function(t){var e=t[1];return t[10].map((function(t){return e[t]}))}(t)).forEach((function(t,i){return e[i]=It(t)})),e},e._descend=function(t,e,i){for(var r=this.getDeps(t),n=0;n<r.length;n++){var s=r[n];e[s]||(e[s]=!0,i.push(s),this._descend(s,e,i))}},t}());function kl(t,e){t._uuid&&e.push(t._uuid)}function Fl(t,e){for(var i=Object.getOwnPropertyNames(t),r=0;r<i.length;r++){var n=i[r];if("node"!==n&&"__eventTargets"!==n){var s=t[n];if("object"==typeof s&&s)if(Array.isArray(s))for(var o=0;o<s.length;o++){var a=s[o];a instanceof M&&kl(a,e)}else if(s.constructor&&s.constructor!==Object)s instanceof M&&kl(s,e);else for(var u=Object.getOwnPropertyNames(s),c=0;c<u.length;c++){var h=s[u[c]];h instanceof M&&kl(h,e)}}}}function xl(t,e,i,r){i.push(t._uuid);for(var n=Pl.getDeps(t._uuid),s=0,o=n.length;s<o;s++){var a=Ft.get(n[s]);if(a){var u=a._uuid;u in e?e[u]+=r:e[u]=a.refCount+r,i.includes(u)||xl(a,e,i,r)}}}var Nl=[],Ml=new(function(){function t(){this._persistNodeDeps=new Ot,this._toDelete=new Ot,this._eventListener=!1}var e=t.prototype;return e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];!function t(e,i){for(var r=0;r<e._components.length;r++)Fl(e._components[r],i);for(var n=0;n<e._children.length;n++)t(e._children[n],i)}(t,e);for(var i=0,r=e.length;i<r;i++){var n=Ft.get(e[i]);n&&n.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),i=0,r=e.length;i<r;i++){var n=Ft.get(e[i]);n&&n.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,i){for(var r=0,n=i.length;r<n;r++){for(var s,o,a=i[r],u=Pl._depends.get(e._id),c=this._persistNodeDeps.get(a.uuid),h=L(c);!(o=h()).done;){var l=o.value,p=Ft.get(l);p&&p.addRef()}u&&(u.persistDeps||(u.persistDeps=[]),(s=u.persistDeps).push.apply(s,c))}if(t){for(var _=Pl.getDeps(t._id),f=0,d=_.length;f<d;f++){var g=Ft.get(_[f]);g&&g.decRef(t.autoReleaseAssets)}var v=Pl._depends.get(t._id);if(v&&v.persistDeps)for(var m=v.persistDeps,y=0,b=m.length;y<b;y++){var w=Ft.get(m[y]);w&&w.decRef(t.autoReleaseAssets)}Pl.remove(t._id)}},e.tryRelease=function(t,e){if(void 0===e&&(e=!1),t instanceof M){if(e)return this._free(t,e);this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,o.director.once(o.Director.EVENT_AFTER_DRAW,this._freeAssets,this))}},e.removeFromDeleteQueue=function(t){this._toDelete.remove(t._uuid)},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var i=t._uuid;if(this._toDelete.remove(i),gt(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,xl(t,e,Nl,-1),Nl.length=0,0!==e[t._uuid])return e[t._uuid];for(var i in e)0!==e[i]&&xl(Ft.get(i),e,Nl,1);return Nl.length=0,e[t._uuid]}(t)>0)){Ft.remove(i);for(var r=Pl.getDeps(i),n=0,s=r.length;n<s;n++){var o=Ft.get(r[n]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),Pl.remove(i)}},t}()),Ll=null;function Bl(t,e){for(var i=0,r=t.input.length;i<r;i++){var n=t.input[i];e&&!n.isNative&&n.content instanceof M&&n.content.decRef(!1),n.recycle()}t.input=null}function zl(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function jl(t,e,i,r,n,s,o){try{var a=Pl.parse(t,e),u=!0;if(e instanceof M&&!e.__nativeDepend__&&(u=!1),n){for(var c=0,h=a.deps.length;c<h;c++){var l=a.deps[c];l in i||(i[l]=!0,r.push({uuid:l,bundle:o&&o.name}))}u&&a.nativeDep&&(o&&(a.nativeDep.bundle=o.name),r.push(Object.assign({},a.nativeDep)))}else{s=!Nt&&(!!e.asyncLoadAssets||s&&!a.preventDeferredLoadDependents);for(var p=0,_=a.deps.length;p<_;p++){var f=a.deps[p];f in i||(i[f]=!0,r.push({uuid:f,__asyncLoadAssets__:s,bundle:o&&o.name}))}u&&!s&&!a.preventPreloadNativeObject&&a.nativeDep&&(o&&(a.nativeDep.bundle=o.name),r.push(Object.assign({},a.nativeDep)))}}catch(t){St(t.message,t.stack)}}function Hl(t,e,i){e&&(i=void 0!==i?i:o.assetManager.cacheAsset,!Mt(e)&&i&&Ft.add(t,e))}function Ul(t,e,i){var r=!1,n=e.__depends__;if(n){for(var s=0,o=n.length;s<o;s++){var a=n[s],u=i[a.uuid+"@import"];u?a.owner[a.prop]=u.addRef():(St("The asset "+a.uuid+" is missing!"),r=!0)}e.__depends__=null}return e.__nativeDepend__&&(i[t+"@native"]?e._nativeAsset=i[t+"@native"]:r=!0,e.__nativeDepend__=!1),r}function Wl(t,e,i){var r=0,n=[];0===t.length&&i&&i(n);for(var s=function(s,o){e(t[s],(function(t){t&&n.push(t),++r===o&&i&&i(n)}))},o=0,a=t.length;o<a;o++)s(o,a)}function Vl(t,e,i){var r=t,n=e,s=i;if(void 0===i){var o="function"==typeof t;e?(s=e,o||(n=null)):void 0===e&&o&&(s=t,r=null,n=null),void 0!==e&&o&&(n=t,r=null)}return{options:r||Object.create(null),onProgress:n,onComplete:s}}function Gl(t,e,i){var r=t,n=e,s=i;if(void 0===i){var o=yt.isChildClassOf(t,M);e?(s=e,o&&(n=null)):void 0!==e||o||(s=t,n=null,r=null),void 0===e||o||(n=t,r=null)}return{type:r,onProgress:n||Ll,onComplete:s}}function Yl(t){return function(e,i){if(t){var r=[];Array.isArray(i)?i.forEach((function(t){return t instanceof M&&r.push(t.addRef())})):i instanceof M&&r.push(i.addRef()),xt((function(){r.forEach((function(t){return t.decRef(!1)})),t(e,i)}))}}}var ql=function(){function t(){this._config=new Rl}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,i){return this._config.getDirWithPath(t,e,i)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),Lt.add(t.name,this)},e.load=function(t,e,i,r){var n=Gl(e,i,r),s=n.type,a=n.onProgress,u=n.onComplete,c={__requestType__:Bt.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(t)};o.assetManager.loadAny(t,c,a,u)},e.preload=function(t,e,i,r){var n=Gl(e,i,r),s=n.type,a=n.onProgress,u=n.onComplete;o.assetManager.preloadAny(t,{__requestType__:Bt.PATH,type:s,bundle:this.name},a,u)},e.loadDir=function(t,e,i,r){var n=Gl(e,i,r),s=n.type,a=n.onProgress,u=n.onComplete;o.assetManager.loadAny(t,{__requestType__:Bt.DIR,type:s,bundle:this.name,__outputAsArray__:!0},a,u)},e.preloadDir=function(t,e,i,r){var n=Gl(e,i,r),s=n.type,a=n.onProgress,u=n.onComplete;o.assetManager.preloadAny(t,{__requestType__:Bt.DIR,type:s,bundle:this.name},a,u)},e.loadScene=function(t,e,i,r){var n=Vl(e,i,r),s=n.options,a=n.onProgress,u=n.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,o.assetManager.loadAny({scene:t},s,a,(function(t,e){if(t)St(t.message,t.stack),u&&u(t);else if(e instanceof $r&&e.scene){var i=e.scene;i._id=e._uuid,i.name=e.name,u&&u(null,e)}else u&&u(new Error("The asset "+e._uuid+" is not a scene"))}))},e.preloadScene=function(t,e,i,r){var n=Vl(e,i,r),s=n.options,a=n.onProgress,u=n.onComplete;s.bundle=this.name,o.assetManager.preloadAny({scene:t},s,a,(function(e){e&&k(1210,t,e.message),u&&u(e)}))},e.get=function(t,e){var i=this.getInfoWithPath(t,e);return i&&Ft.get(i.uuid)||null},e.release=function(t,e){var i=this.get(t,e);i&&Ml.tryRelease(i,!0)},e.releaseUnusedAssets=function(){var t=this;Ft.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&Ml.tryRelease(e)}))},e.releaseAll=function(){var t=this;Ft.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&Ml.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},x(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),Xl=t("r",new ql);o.resources=Xl;var Zl=bt.__videoSupport,$l=Zl&&Zl.format;function Jl(t,e,i){if(!$l||0===$l.length)return i(new Error(T(7703)));var r=document.createElement("video"),n=document.createElement("source");r.appendChild(n);var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(){200===this.status||0===this.status?(n.src=URL.createObjectURL(this.response),i(null,r)):i(new Error(s.status+"(no response)"))},s.onerror=function(){var e="load video failure - "+t;zt(e),i(new Error(e))},s.send()}function Kl(t,e,i){var r=new Image;function n(){r.removeEventListener("load",n),r.removeEventListener("error",s),i&&i(null,r)}function s(){r.removeEventListener("load",n),r.removeEventListener("error",s),i&&i(new Error(T(4930,t)))}return"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.addEventListener("load",n),r.addEventListener("error",s),r.src=t,r}var Ql={};function tp(t,e,i){if(Ql[t])return i&&i(null),null;var r=document.createElement("script");function n(){r.parentNode.removeChild(r),r.removeEventListener("load",n,!1),r.removeEventListener("error",s,!1),Ql[t]=!0,i&&i(null)}function s(){r.parentNode.removeChild(r),r.removeEventListener("load",n,!1),r.removeEventListener("error",s,!1),i&&i(new Error(T(4928,t)))}return"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.async=e.scriptAsyncLoading||!1,r.src=t,r.addEventListener("load",n,!1),r.addEventListener("error",s,!1),document.body.appendChild(r),r}var ep,ip=null,rp=-1,np=Object.create(null),sp=[];function op(){for(var t=!0,e=Date.now(),i=sp.length-1;i>=0;i--){var r=sp[i],s=r.fontFamilyName;if(e-r.startTime>3e3)n(4933,s),r.onComplete(null,s),sp.splice(i,1);else{var o=r.refWidth,a="40px "+s;ip.font=a,o!==Ni(ip,"BES bswy:->@123",a)?(sp.splice(i,1),r.onComplete(null,s)):t=!1}}t&&(clearInterval(rp),rp=-1)}function ap(t,e,i){var r=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,r=t.lastIndexOf("/");return-1!==(i=-1===r?t.substring(0,e)+"_LABEL":t.substring(r+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}(t);if(np[r])return i(null,r);if(!ip){var s=document.createElement("canvas");s.width=100,s.height=100,ip=s.getContext("2d")}var o=Ni(ip,"BES bswy:->@123","40px "+r),a=document.createElement("style");a.type="text/css";var u="";isNaN(Number(r))?u+="@font-face { font-family:"+r+"; src:":u+='@font-face { font-family:"'+r+'"; src:',u+='url("'+t+'");',a.textContent=u+"}",document.body.appendChild(a);var c=document.createElement("div"),h=c.style;if(h.fontFamily=r,c.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",document.body.appendChild(c),function(){if(void 0===ep)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ep=t?parseInt(t[1],10)>42:!e}else ep=!1;return ep}())!function(t,e,i){var r=new Promise((function(i,r){!function n(){Date.now()-t>=3e3?r():document.fonts.load("40px "+e).then((function(t){t.length>=1?i():setTimeout(n,100)}),(function(){r()}))}()})),s=null,o=new Promise((function(t,e){s=setTimeout(e,3e3)}));Promise.race([o,r]).then((function(){s&&(clearTimeout(s),s=null),i(null,e)}),(function(){n(4933,e),i(null,e)}))}(Date.now(),r,i);else{var l={fontFamilyName:r,refWidth:o,onComplete:i,startTime:Date.now()};sp.push(l),-1===rp&&(rp=setInterval(op,100))}np[r]=a}var up,cp,hp,lp,pp=/^\w+:\/\/.*/,_p=function(t,e,i){(bt.capabilities.imageBitmap&&o.assetManager.allowImageBitmap?fp:Kl)(t,e,i)},fp=function(t,e,i){e.xhrResponseType="blob",ji(t,e,e.onFileProgress,i)},dp=function(t,e,i){e.xhrResponseType="json",ji(t,e,e.onFileProgress,i)},gp=function(t,e,i){e.xhrResponseType="arraybuffer",ji(t,e,e.onFileProgress,i)},vp=function(t,e,i){e.xhrResponseType="text",ji(t,e,e.onFileProgress,i)},mp=function(t,e,i){var r=jt(t),n=t;pp.test(n)||(n=-1!==yp.remoteBundles.indexOf(r)?yp.remoteServerAddress+"remote/"+r:"assets/"+r);var s=e.version||yp.bundleVers[r],o=0,a=null,u=null;dp(n+"/config."+(s?s+".":"")+"json",e,(function(t,e){t&&(u=t),(a=e)&&(a.base=n+"/"),2==++o&&i(u,a)})),tp(n+"/index."+(s?s+".":"")+"js",e,(function(t){t?(u=t,2==++o&&i(t)):yp.importBundleEntry(r).then((function(){2==++o&&i(u,a)})).catch((function(t){u=t,2==++o&&i(u)}))}))},yp=new(function(){function t(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=Kl,this.downloadDomAudio=zi,this.downloadFile=ji,this.downloadScript=tp,this._downloaders={".png":_p,".jpg":_p,".bmp":_p,".jpeg":_p,".gif":_p,".ico":_p,".tiff":_p,".webp":_p,".image":_p,".pvr":gp,".pkm":gp,".astc":gp,".mp3":Hi,".ogg":Hi,".wav":Hi,".m4a":Hi,".txt":vp,".xml":vp,".vsh":vp,".fsh":vp,".atlas":vp,".tmx":vp,".tsx":vp,".json":dp,".ExportJson":dp,".plist":vp,".fnt":vp,".font":ap,".eot":ap,".ttf":ap,".woff":ap,".svg":ap,".ttc":ap,".mp4":Jl,".avi":Jl,".mov":Jl,".mpg":Jl,".mpeg":Jl,".rm":Jl,".rmvb":Jl,".binary":gp,".bin":gp,".dbbin":gp,".skel":gp,".js":tp,bundle:mp,default:vp},this._downloading=new Ot,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress=""}var i=t.prototype;return i.init=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=i},i.register=function(t,e){"object"==typeof t?j(this._downloaders,t):this._downloaders[t]=e},i.importBundleEntry=function(t){return e.import("virtual:///prerequisite-imports/"+t)},i.download=function(t,e,i,r,n){var s=this,o=kt.get(t);if(o)return n(null,o);var a=this._downloading.get(t);if(a){a.push(n);var u=this._queue.find((function(e){return e.id===t}));if(!u)return;var c=r.priority||0;u.priority<c&&(u.priority=c,this._queueDirty=!0)}else{var h=void 0!==r.maxRetryCount?r.maxRetryCount:this.maxRetryCount,l=void 0!==r.maxConcurrency?r.maxConcurrency:this.maxConcurrency,p=void 0!==r.maxRequestsPerFrame?r.maxRequestsPerFrame:this.maxRequestsPerFrame,_=this._downloaders[i]||this._downloaders.default;!function t(e,i,r,n,s){void 0===s&&(s=0),e(s,(function(o,a){s++,!o||s>i?n&&n(o,a):setTimeout((function(){t(e,i,r,n,s)}),r)}))}((function(i,o){if(0===i&&s._downloading.add(t,[n]),!s.limited)return _(zl(e,s.appendTimeStamp),r,o);s._updateTime();var a=function(t,e){s._totalNum--,s._handleQueueInNextFrame(l,p),o(t,e)};s._totalNum<l&&s._totalNumThisPeriod<p?(_(zl(e,s.appendTimeStamp),r,a),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:t,priority:r.priority||0,url:e,options:r,done:a,handler:_}),s._queueDirty=!0,s._totalNum<l&&s._handleQueueInNextFrame(l,p))}),h,this.retryInterval,(function(e,i){e||kt.add(t,i);for(var r=s._downloading.remove(t),n=0,o=r.length;n<o;n++)r[n](e,i)}))}},i.loadSubpackage=function(t,e){o.assetManager.loadBundle(t,null,e)},i._updateTime=function(){var t=Date.now();t-this._lastDate>1e3*o.director.getDeltaTime()&&(this._totalNumThisPeriod=0,this._lastDate=t)},i._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(zl(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(t,e)},i._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(xt(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},x(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}()),bp=t("_",i("cc.VideoClip")((lp=function(t){function e(){var e;return e=t.call(this)||this,c(e,"_duration",hp,h(e)),e._video=null,e.loaded=!1,e}return r(e,t),x(e,[{key:"_nativeAsset",set:function(t){this._video=t,t?(this._duration=t.duration,this.loaded=!0):(this._duration=0,this.loaded=!1)},get:function(){return this._video}}]),e}(M),hp=s((cp=lp).prototype,"_duration",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),up=cp))||up);function wp(t,e,i,r){var n=null,s=null;try{(n=new Mi)._nativeUrl=t,n._nativeAsset=e}catch(t){s=t}r(s,n)}function Ap(t,e,i,r){var n=new Ui;n._nativeUrl=t,n._nativeAsset=e,n._duration=e.duration,r(null,n)}function Tp(t,e,i,r){var n=new cn;n.json=e,r(null,n)}function Ep(t,e,i,r){var n=new an;n.text=e,r(null,n)}function Cp(t,e,i,r){var n=new En;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}function Sp(t,e,i,r){var n=new mr;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}function Dp(t,e,i,r){var n=new M;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}function Op(t,e,i,r){var n=Lt.get(e.name);n||(n=e.name===Ht.RESOURCES?Xl:new ql,e.base=e.base||t+"/",n.init(e)),r(null,n)}function Rp(t,e,i,r){var n=new bp;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}var Ip=new(function(){function t(){this._creating=new Ot,this._producers={".png":wp,".jpg":wp,".bmp":wp,".jpeg":wp,".gif":wp,".ico":wp,".tiff":wp,".webp":wp,".image":wp,".pvr":wp,".pkm":wp,".mp3":Ap,".ogg":Ap,".wav":Ap,".m4a":Ap,".mp4":Rp,".avi":Rp,".mov":Rp,".mpg":Rp,".mpeg":Rp,".rm":Rp,".rmvb":Rp,".txt":Ep,".xml":Ep,".vsh":Ep,".fsh":Ep,".atlas":Ep,".tmx":Ep,".tsx":Ep,".fnt":Ep,".json":Tp,".ExportJson":Tp,".font":Cp,".eot":Cp,".ttf":Cp,".woff":Cp,".svg":Cp,".ttc":Cp,".binary":Sp,".bin":Sp,".dbbin":Sp,".skel":Sp,bundle:Op,default:Dp}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?yt.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,i,r,n){var s=this,o=this._producers[i]||this._producers.default,a=Ft.get(t);if(r.reloadAsset||!a){var u=this._creating.get(t);u?u.push(n):(this._creating.add(t,[n]),o(t,e,r,(function(e,i){!e&&i instanceof M&&(i._uuid=t,Hl(t,i,r.cacheAsset));for(var n=s._creating.remove(t),o=0,a=n.length;o<a;o++)n[o](e,i)})))}else n(null,a)},t}()),Pp=new(function(){function t(){this._loading=new Ot,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,i,r){var n=yt.createMap(!0),s=null;if(Array.isArray(e)){(e=function(t,e){if(t[0]<1)throw new Error(T(5304,t[0]));hr(t,!0,e),lr(t);for(var i=new gr(t[0]),r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],u=0;u<a.length;++u)a[u].unshift(i,r,n,s,o);return a}(e,Xi.safeFindClass)).length!==t.length&&k(4915);for(var o=0;o<t.length;o++)n[t[o]+"@import"]=e[o]}else{var a=yt._getClassId(Li);if(e.type===a&&e.data){var u=e.data;u.length!==t.length&&k(4915);for(var c=0;c<t.length;c++)n[t[c]+"@import"]=vr(a,{base:u[c][0],mipmaps:u[c][1]},!0)}else s=new Error("unmatched type pack!"),n=null}r(s,n)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?yt.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,i,r,n){e?(0,this._unpackers[i])(t,e,r,n):n(new Error("package data is wrong!"))},e.load=function(t,e,i){var r=this;if(t.isNative||!t.info||!t.info.packs)return yp.download(t.id,t.url,t.ext,t.options,i);if(kt.has(t.id))return i(null,kt.get(t.id));var n=t.info.packs,s=n.find((function(t){return r._loading.has(t.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:t.id});else{s=n[0],this._loading.add(s.uuid,[{onComplete:i,id:t.id}]);var o=Ut(s.uuid,{ext:s.ext,bundle:t.config.name});yp.download(s.uuid,o,s.ext,t.options,(function(e,i){kt.remove(s.uuid),e&&St(e.message,e.stack),r.unpack(s.packedUuids,i,s.ext,t.options,(function(t,i){if(!t)for(var n in i)kt.add(n,i[n]);for(var o=r._loading.remove(s.uuid),a=0,u=o.length;a<u;a++){var c=o[a];if(e||t)c.onComplete(e||t);else{var h=i[c.id];h?c.onComplete(null,h):c.onComplete(new Error("can not retrieve data from package"))}}}))}))}},t}());function kp(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,n=t.progress,s=[],a=n.total;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],Wl(t.input,(function(r,u){if(!r.isNative&&Ft.has(r.uuid)){var c=Ft.get(r.uuid);return c.addRef(),xp(r,t,c,null,c.__asyncLoadAssets__,s,a),u()}Pp.load(r,t.options,(function(c,h){c?t.isFinish||(!o.assetManager.force||i?(St(c.message,c.stack),n.canInvoke=!1,e(c)):xp(r,t,null,null,!1,s,a)):t.isFinish||xp(r,t,null,h,!r.isNative,s,a),u()}))}),(function(){if(t.isFinish)return Bl(t,!0),t.dispatch("error");if(s.length>0){var o=Wt.create({input:s,progress:n,options:r,onProgress:t.onProgress,onError:Wt.prototype.recycle,onComplete:function(r){var n;r||((n=t.output).push.apply(n,o.output),o.recycle()),i&&Fp(t),e(r)}});Vt.async(o)}else i&&Fp(t),e()}))}function Fp(t){for(var e=t.output,i=0,r=e.length;i<r;i++)e[i].content&&e[i].content.decRef(!1)}function xp(t,e,i,r,n,s,o){var a=e.options.__exclude__,u=e.progress;t.content=i,t.file=r,e.output.push(t),n&&(a[t.uuid]=!0,jl(t.uuid,r||i,a,s,!0,!1,t.config),u.total=o+s.length),u.canInvoke&&e.dispatch("progress",++u.finish,u.total,t)}var Np=new(function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var i=e.prototype;return i.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return n(5100),{};for(var i=null,r=0,s=e.childNodes.length;r<s&&1!==(i=e.childNodes[r]).nodeType;r++);return this._parseNode(i)},i._parseNode=function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var r=0;r<t.childNodes.length;r++)e+=t.childNodes[r].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},i._parseArray=function(t){for(var e=[],i=0,r=t.childNodes.length;i<r;i++){var n=t.childNodes[i];1===n.nodeType&&e.push(this._parseNode(n))}return e},i._parseDict=function(t){for(var e={},i="",r=0,n=t.childNodes.length;r<n;r++){var s=t.childNodes[r];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e},e}(t("Z",function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){var e;return this._parser&&(e=this._parser.parseFromString(t,"text/xml")),e},t}())));function Mp(t,e){return t[e]<<8|t[e+1]}var Lp=new(function(){function t(){this._parsing=new Ot,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,i){t instanceof HTMLImageElement?i(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){i(null,t)}),(function(t){i(t,null)}))},e.parseAudio=function(t,e,i){t instanceof ArrayBuffer?bt.__audioSupport.context.decodeAudioData(t,(function(t){i(null,t)}),(function(t){i(new Error("Error with decoding audio data"+t.err),null)})):i(null,t)},e.parsePVRTex=function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(s,0,13);if(55727696===o[0]){var a=o[7],u=o[6],c=o[12]+52;n={_data:new Uint8Array(s,c),_compressed:!0,width:a,height:u,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var h=o[0],l=o[1],p=o[2];n={_data:new Uint8Array(s,h),_compressed:!0,width:p,height:l,format:0}}}catch(t){r=t}i(r,n)},e.parsePKMTex=function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s),a=Mp(o,6);if(0!==a&&1!==a&&3!==a)throw new Error("Invalid magic number in ETC header");var u=Mp(o,12),c=Mp(o,14);Mp(o,8),Mp(o,10),n={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:c,format:0}}catch(t){r=t}i(r,n)},e.parseASTCTex=function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var a=o[4],u=o[5],c=o[6];if((a<3||a>6||u<3||u>6||c<3||c>6)&&(a<4||7===a||9===a||11===a||a>12||u<4||7===u||9===u||11===u||u>12||1!==c))throw new Error("Invalid block number in ASTC header");var h=function(t,e){return 4===t?Bi.RGBA_ASTC_4x4:5===t?4===e?Bi.RGBA_ASTC_5x4:Bi.RGBA_ASTC_5x5:6===t?5===e?Bi.RGBA_ASTC_6x5:Bi.RGBA_ASTC_6x6:8===t?5===e?Bi.RGBA_ASTC_8x5:6===e?Bi.RGBA_ASTC_8x6:Bi.RGBA_ASTC_8x8:10===t?5===e?Bi.RGBA_ASTC_10x5:6===e?Bi.RGBA_ASTC_10x6:8===e?Bi.RGBA_ASTC_10x8:Bi.RGBA_ASTC_10x10:10===e?Bi.RGBA_ASTC_12x10:Bi.RGBA_ASTC_12x12}(a,u),l=o[7]+(o[8]<<8)+(o[9]<<16),p=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],n={_data:new Uint8Array(s,16),_compressed:!0,width:l,height:p,format:h}}catch(t){r=t}i(r,n)},e.parsePlist=function(t,e,i){var r=null,n=Np.parse(t);n||(r=new Error("parse failed")),i(r,n)},e.parseImport=function(t,e,i){if(t){var r=null,n=null;try{r=Il(t,e)}catch(t){n=t}i(n,r)}else i(new Error("Json is empty"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?j(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,i,r,n){var s=this,o=Pt.get(t);if(o)n(null,o);else{var a=this._parsing.get(t);if(a)a.push(n);else{var u=this._parsers[i];u?(this._parsing.add(t,[n]),u(e,r,(function(e,i){e?kt.remove(t):Mt(i)||Pt.add(t,i);for(var r=s._parsing.remove(t),n=0,o=r.length;n<o;n++)r[n](e,i)}))):n(null,e)}}},t}());function Bp(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,n=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],Wl(t.input,(function(s,a){var u=Wt.create({input:s,onProgress:t.onProgress,options:r,progress:n,onComplete:function(r,c){r&&!t.isFinish&&(!o.assetManager.force||i?(St(r.message,r.stack),n.canInvoke=!1,e(r)):n.canInvoke&&t.dispatch("progress",++n.finish,n.total,s)),t.output.push(c),u.recycle(),a(null)}});zp.async(u)}),(function(){if(r.__exclude__=null,t.isFinish)return Bl(t,!0),t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var i=t.output=[],r=0,n=e.length;r<n;r++)i.push(e[r].content);else t.output=e[0].content}(t),Bl(t,!0),e()}))}var zp=new Gt("loadOneAsset",[function(t,e){var i=t.output=t.input,r=i.options,n=i.isNative,s=i.uuid,o=i.file,a=r.reloadAsset;if(o||!a&&!n&&Ft.has(s))return e();Pp.load(i,t.options,(function(t,r){i.file=r,e(t)}))},function(t,e){var i=t.output=t.input,r=t.progress,n=t.options.__exclude__,s=i.id,o=i.file,a=i.options;if(i.isNative)Lp.parse(s,o,i.ext,a,(function(n,o){if(n)return e(n);i.content=o,r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),kt.remove(s),Pt.remove(s),e()}));else{var u=i.uuid;if(u in n){var c=n[u],h=c.finish,l=c.content,p=c.err,_=c.callbacks;r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),h||function t(e,i,r,n){if(void 0===n&&(n={}),!r[i]||n[i])return!1;n[i]=!0;var s=!1,o=Pl.getDeps(i);if(o)for(var a=0,u=o.length;a<u;a++){var c=o[a];if(c===e||t(e,c,r,n)){s=!0;break}}return s}(u,u,n)?(l&&l.addRef(),i.content=l,e(p)):_.push({done:e,item:i})}else if(!a.reloadAsset&&Ft.has(u)){var f=Ft.get(u);a.__asyncLoadAssets__||!f.__asyncLoadAssets__?(i.content=f.addRef(),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),e()):jp(t,f,e,!1)}else a.__uuid__=u,Lp.parse(s,o,"import",a,(function(i,r){if(i)return e(i);jp(t,r,e,!0)}))}}]);function jp(t,e,i,r){var n=t.input,s=t.progress,o=n,a=o.uuid,u=o.id,c=o.options,h=o.config,l=c.__asyncLoadAssets__,p=c.cacheAsset,_=[];e.addRef&&e.addRef(),jl(a,e,Object.create(null),_,!1,l,h),s.canInvoke&&t.dispatch("progress",++s.finish,s.total+=_.length,n);var f=t.options.__exclude__[a]={content:e,finish:!1,callbacks:[{done:i,item:n}]},d=Wt.create({input:_,options:t.options,onProgress:t.onProgress,onError:Wt.prototype.recycle,progress:s,onComplete:function(t){if(e.decRef&&e.decRef(!1),e.__asyncLoadAssets__=l,f.finish=!0,f.err=t,!t){for(var i,n=Array.isArray(d.output)?d.output:[d.output],s=Object.create(null),o=L(n);!(i=o()).done;){var c=i.value;c&&(s[c instanceof M?c._uuid+"@import":a+"@native"]=c)}if(r){if(!Ul(a,e,s))try{e.onLoaded&&e.onLoaded()}catch(t){St(t.message,t.stack)}kt.remove(u),Pt.remove(u),Hl(a,e,p)}else if(e.__nativeDepend__&&!Ul(a,e,s))try{e.onLoaded&&e.onLoaded()}catch(t){St(t.message,t.stack)}d.recycle()}for(var h=f.callbacks,_=0,g=h.length;_<g;_++){var v=h[_];e.addRef&&e.addRef(),v.item.content=e,v.done(t)}h.length=0}});Yt.async(d)}function Hp(t,e){var i=t.options,r=Object.create(null),n=Object.create(null);for(var s in i)switch(s){case Bt.PATH:case Bt.UUID:case Bt.DIR:case Bt.SCENE:case Bt.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":r[s]=i[s];break;case"__exclude__":case"__outputAsArray__":n[s]=i[s];break;default:r[s]=i[s],n[s]=i[s]}t.options=n;var o=Wt.create({input:t.input,options:r}),a=null;try{t.output=t.source=qt.sync(o)}catch(t){a=t;for(var u=0,c=o.output.length;u<c;u++)o.output[u].recycle()}o.recycle(),e(a)}var Up=function(){function t(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},x(t,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),t}();Up.MAX_DEAD_NUM=500,Up._deadPool=[];var Wp=[];function Vp(t){var e=t.input,i=t.options;e=Array.isArray(e)?e:[e],t.output=[];for(var r=0;r<e.length;r++){var n=e[r],s=Up.create(),o=null,a=null;if("string"==typeof n&&((n=Object.create(null))[i.__requestType__||Bt.UUID]=e[r]),"object"==typeof n)for(var u in Xt(n,i),n.preset&&Xt(n,Zt[n.preset]),n)if(function(){switch(u){case Bt.UUID:var t=s.uuid=It(n.uuid);if(!n.bundle){var i=Lt.find((function(e){return!!e.getAssetInfo(t)}));n.bundle=i&&i.name}if(Lt.has(n.bundle)){if(o=Lt.get(n.bundle).config,(a=o.getAssetInfo(t))&&a.redirect){if(!Lt.has(a.redirect))throw new Error("Please load bundle "+a.redirect+" first");o=Lt.get(a.redirect).config,a=o.getAssetInfo(t)}s.config=o,s.info=a}s.ext=n.ext||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Bt.DIR:if(Lt.has(n.bundle)){Lt.get(n.bundle).config.getDirWithPath(n.dir,n.type,Wp);for(var r,c=L(Wp);!(r=c()).done;){var h=r.value;e.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:n.bundle})}Wp.length=0}s.recycle(),s=null;break;case Bt.PATH:if(Lt.has(n.bundle)){if(o=Lt.get(n.bundle).config,(a=o.getInfoWithPath(n.path,n.type))&&a.redirect){if(!Lt.has(a.redirect))throw new Error("you need to load bundle "+a.redirect+" first");o=Lt.get(a.redirect).config,a=o.getAssetInfo(a.uuid)}if(!a)throw s.recycle(),new Error("Bundle "+n.bundle+" doesn't contain "+n.path);s.config=o,s.uuid=a.uuid,s.info=a}s.ext=n.ext||".json";break;case Bt.SCENE:if(!n.bundle){var l=Lt.find((function(e){return!!e.getAssetInfo(t)}));n.bundle=l&&l.name}if(Lt.has(n.bundle)){if(o=Lt.get(n.bundle).config,(a=o.getSceneInfo(n.scene))&&a.redirect){if(!Lt.has(a.redirect))throw new Error("you need to load bundle "+a.redirect+" first");o=Lt.get(a.redirect).config,a=o.getAssetInfo(a.uuid)}if(!a)throw s.recycle(),new Error("Bundle "+o.name+" doesn't contain scene "+n.scene);s.config=o,s.uuid=a.uuid,s.info=a}break;case"__isNative__":s.isNative=n.__isNative__;break;case Bt.URL:s.url=n.url,s.uuid=n.uuid||n.url,s.ext=n.ext||G(n.url),s.isNative=void 0===n.__isNative__||n.__isNative__;break;default:s.options[u]=n[u]}}(),!s)break;if(s&&(t.output.push(s),!s.uuid&&!s.url))throw new Error("Can not parse this input:"+JSON.stringify(n))}return null}function Gp(t){for(var e=t.output=t.input,i=0;i<e.length;i++){var r=e[i];if(!r.url){var n,s,a=r.config;s=r.isNative?a&&a.nativeBase?a.base+a.nativeBase:o.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:o.assetManager.generalImportBase;var u=r.uuid,c="";r.info&&(c=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),n=".ttf"===r.ext?s+"/"+u.slice(0,2)+"/"+u+c+"/"+r.options.__nativeName__:s+"/"+u.slice(0,2)+"/"+u+c+r.ext,r.url=n}}return null}var Yp=t("A",function(){function t(){this.pipeline=Yt.append(Hp).append(Bp),this.fetchPipeline=Vt.append(Hp).append(kp),this.transformPipeline=qt.append(Vp).append(Gp),this.bundles=Lt,this.assets=Ft,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Pl,this.force=!1,this.allowImageBitmap=!bt.isMobile,this.utils=$t,this.downloader=yp,this.parser=Lp,this.packManager=Pp,this.cacheAsset=!0,this.cacheManager=null,this.presets=Zt,this.factory=Ip,this.preprocessPipe=Hp,this.fetchPipe=kp,this.loadPipe=Bp,this.references=Jt,this._releaseManager=Ml,this._files=kt,this._parsed=Pt,this._parsePipeline=null}var e=t.prototype;return e.init=function(t){void 0===t&&(t={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.server,t.bundleVers,t.remoteBundles),this.parser.init(),this.dependUtil.init();var e=t.importBase||"";e&&e.endsWith("/")&&(e=e.substr(0,e.length-1));var i=t.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=e,this.generalNativeBase=i},e.getBundle=function(t){return Lt.get(t)||null},e.removeBundle=function(t){t._destroy(),Lt.remove(t.name)},e.loadAny=function(t,e,i,r){var n=Vl(e,i,r),s=n.options,o=n.onProgress,a=n.onComplete;s.preset=s.preset||"default",t=Array.isArray(t)?t.slice():t;var u=new Wt({input:t,onProgress:o,onComplete:Yl(a),options:s});Yt.async(u)},e.preloadAny=function(t,e,i,r){var n=Vl(e,i,r),s=n.options,o=n.onProgress,a=n.onComplete;s.preset=s.preset||"preload",t=Array.isArray(t)?t.slice():t;var u=new Wt({input:t,onProgress:o,onComplete:Yl(a),options:s});Vt.async(u)},e.postLoadNative=function(t,e,i){var r=Vl(e,void 0,i),n=r.options,s=r.onComplete;if(!t._native||!t.__nativeDepend__)return Yl(s)(null);var o=Pl.getNativeDep(t._uuid);if(o){if(!Lt.has(o.bundle)){var a=Lt.find((function(e){return!!e.getAssetInfo(t._uuid)}));a&&(o.bundle=a.name)}this.loadAny(o,n,(function(e,i){e?St(e.message,e.stack):t.isValid&&t.__nativeDepend__&&(t._nativeAsset=i,t.__nativeDepend__=!1),s&&s(e)}))}},e.loadRemote=function(t,e,i){var r=Vl(e,void 0,i),n=r.options,s=r.onComplete;if(!n.reloadAsset&&this.assets.has(t))return Yl(s)(null,this.assets.get(t));n.__isNative__=!0,n.preset=n.preset||"remote",this.loadAny({url:t},n,null,(function(e,i){e?(St(e.message,e.stack),s&&s(e,null)):Ip.create(t,i,n.ext||G(t),n,(function(t,e){s&&s(t,e)}))}))},e.loadBundle=function(t,e,i){var r=Vl(e,void 0,i),n=r.options,s=r.onComplete,o=jt(t);if(this.bundles.has(o))return Yl(s)(null,this.getBundle(o));n.preset=n.preset||"bundle",n.ext="bundle",n.__isNative__=!0,this.loadAny({url:t},n,null,(function(e,i){e?(St(e.message,e.stack),s&&s(e,null)):Ip.create(t,i,"bundle",n,(function(t,e){s&&s(t,e)}))}))},e.releaseAsset=function(t){Ml.tryRelease(t,!0)},e.releaseUnusedAssets=function(){Ft.forEach((function(t){Ml.tryRelease(t)}))},e.releaseAll=function(){Ft.forEach((function(t){Ml.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},x(t,[{key:"main",get:function(){return Lt.get(Ht.MAIN)||null}},{key:"resources",get:function(){return Lt.get(Ht.RESOURCES)||null}}]),t}());Yp.Pipeline=Gt,Yp.Task=Wt,Yp.Cache=Ot,Yp.RequestItem=Up,Yp.Bundle=ql,Yp.BuiltinBundleName=Ht;var qp=t("i",o.assetManager=new Yp);o.AssetManager=Yp;var Xp=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],Zp=[".mp3",".ogg",".wav",".m4a"];function $p(){return!0}var Jp={transformURL:function(t){var e=te(t);if(!e)return t;var i=Lt.find((function(t){return!!t.getAssetInfo(e)}));if(!i)return t;var r,n=i.getAssetInfo(e);if(!(r=t.startsWith(i.base+i.config.nativeBase)?n.nativeVer||"":n.ver||"")||-1!==t.indexOf(r))return t;var s=!1;if(".ttf"===G(t)&&(s=!0),s){var o=ee(t),a=jt(t);t=o+"."+r+"/"+a}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(t){return t+"."+r}));return t}},Kp=t("C",function(){function t(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=Gl}var e=t.prototype;return e.load=function(t,e,i){void 0===i&&void 0!==e&&(i=e,e=null);for(var r=Array.isArray(t)?t:[t],n=0;n<r.length;n++){var s=r[n];"string"==typeof s?r[n]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var o=[],a=[];qp.loadAny(r,null,(function(t,i,r){r.content&&(Xp.includes(r.ext)?o.push(r.content):Zp.includes(r.ext)&&a.push(r.content)),e&&e(t,i,r)}),(function(t,e){var n=null;if(!t){e=Array.isArray(e)?e:[e];for(var s=function(t){var i=e[t];if(!(i instanceof M)){var n=i,s=r[t].url;o.includes(n)?Ip.create(s,i,".png",{},(function(i,r){n=e[t]=r})):a.includes(n)&&Ip.create(s,i,".mp3",{},(function(i,r){n=e[t]=r})),Ft.add(s,n)}},u=0;u<e.length;u++)s(u);if(e.length>1){var c=Object.create(null);e.forEach((function(t){c[t._uuid]=t})),n={isCompleted:$p,_map:c}}else n=e[0]}i&&i(t,n)}))},e.getXMLHttpRequest=function(){return new XMLHttpRequest},e.getItem=function(t){return qp.assets.has(t)?{content:qp.assets.get(t)}:null},e.loadRes=function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=n.type,o=n.onProgress,a=n.onComplete,u=G(t);u&&!Xl.getInfoWithPath(t,s)&&(t=t.slice(0,-u.length)),Xl.load(t,s,o,a)},e.loadResArray=function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=n.type,o=n.onProgress,a=n.onComplete;t.forEach((function(e,i){var r=G(e);r&&!Xl.getInfoWithPath(e,s)&&(t[i]=e.slice(0,-r.length))})),Xl.load(t,s,o,a)},e.loadResDir=function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=n.type,o=n.onProgress,a=n.onComplete;Xl.loadDir(t,s,o,(function(e,i){var r=[];e||(r=Xl.getDirWithPath(t,s).map((function(t){return t.path}))),a&&a(e,i,r)}))},e.getRes=function(t,e){return Ft.has(t)?Ft.get(t):Xl.get(t,e)},e.getResCount=function(){return Ft.count},e.getDependsRecursively=function(t){if(!t)return[];var e="string"==typeof t?t:t._uuid;return Pl.getDepsRecursively(e).concat([e])},e.addDownloadHandlers=function(t){var e=Object.create(null),i=function(i){var r=t[i];e["."+i]=function(t,e,i){r({url:t},i)}};for(var r in t)i(r);yp.register(e)},e.addLoadHandlers=function(t){var e=Object.create(null),i=function(i){var r=t[i];e["."+i]=function(t,e,i){r({content:t},i)}};for(var r in t)i(r);Lp.register(e)},e.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];"string"==typeof i&&(i=Ft.get(i)),qp.releaseAsset(i)}else t&&("string"==typeof t&&(t=Ft.get(t)),qp.releaseAsset(t))},e.releaseAsset=function(t){qp.releaseAsset(t)},e.releaseRes=function(t,e){Xl.release(t,e)},e.releaseAll=function(){qp.releaseAll(),Ft.clear()},e.removeItem=function(t){return!!Ft.remove(t)},e.setAutoRelease=function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},e.setAutoReleaseRecursively=function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var i=Pl.getDepsRecursively(t),r=0;r<i.length;r++)this._autoReleaseSetting[i[r]]=e},e.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},x(t,[{key:"onProgress",set:function(t){Ll=t}},{key:"_cache",get:function(){return Ft._map}},{key:"md5Pipe",get:function(){return Jp}},{key:"downloader",get:function(){return yp}},{key:"loader",get:function(){return qp.parser}}]),t}()),Qp=t("l",new Kp),t_=t("j",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,qp.init(t),t.rawAssets&&Xl.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Ht.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets)})},loadAsset:function(t,e){qp.loadAny(t,e)}}),e_=t("u",{});Z(e_,"url",[{name:"normalize",target:qp.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?Ut({path:Kt(t.substr(10)),bundle:Ht.RESOURCES,__isNative__:!0,ext:G(t)}):""}}]),$(t_,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),$(Qp,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),Z(o,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return Qp}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return t_}},{name:"Pipeline",target:Yp,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return e_}}]),$(o,"cc",[{name:"LoadingItems",suggest:T(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),Z(Qt,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:yp,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),Z(Ol,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var e;return qp.main?null===(e=qp.main.getSceneInfo(t))||void 0===e?void 0:e.uuid:""}}]),Z(xe,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return qp.main&&qp.main.config.scenes.forEach((function(e){t.push(e)})),t}}]);var i_=Ml._autoRelease;Ml._autoRelease=function(t,e,i){i_.call(Ml,t,e,i);for(var r=Qp._autoReleaseSetting,n=Object.keys(r),s=0;s<n.length;s++){var o=n[s];if(!0===r[o]){var a=Ft.get(o);a&&Ml.tryRelease(a)}}}}}}));
